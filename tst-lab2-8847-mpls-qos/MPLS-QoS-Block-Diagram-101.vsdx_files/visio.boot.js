var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Visio=function(i){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return i[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=i,t.c=e,t.d=function(i,e,n){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:n})},t.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var o in i)t.d(n,o,function(e){return i[e]}.bind(null,o));return n},t.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="",t(t.s=17)}({17:function(i,e,t){"use strict";var n,o;t.r(e),function(i){i[i.u=0]="msoulscat_ES_EWAJS",i[i.h=1]="msoulscat_ES_EWAJSGrid",i[i.v=6]="msoulscat_ES_EWAJSChart",i[i.g=202]="msoulscat_MSOSP_FileMenuCommands",i[i.A=225]="msoulscat_MSOSP_OTelJS",i[i._=227]="msoulscat_MSOSP_OTelJSInWebWoker",i[i.F=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",i[i.R=301]="msoulscat_Wac_WordViewer",i[i.O=306]="msoulscat_Wac_BrowserGeneral",i[i.P=320]="msoulscat_Wac_TaskPane",i[i.U=339]="msoulscat_Wac_OneNoteGeneral",i[i.k=340]="msoulscat_Wac_Ribbon",i[i.N=356]="msoulscat_Wac_WacFeedback",i[i.B=379]="msoulscat_Wac_WopiPendingApplication",i[i.H=383]="msoulscat_Wac_Telemetry",i[i.J=391]="msoulscat_Wac_WacCatchUpActivities",i[i.j=394]="msoulscat_Wac_Dictation",i[i.q=395]="msoulscat_Wac_OneNoteSync",i[i.K=700]="msoulscat_Wac_VisioApp",i[i.X=1601]="msoulscat_OneNoteOnline_EditableCache",i[i.$=800]="msoulscat_Wac_PptAnimation",i[i.Z=833]="msoulscat_Wac_PptLive",i[i.Y=834]="msoulscat_Wac_PptMWeb",i[i.ii=844]="msoulscat_Wac_PptDataSync",i[i.ei=848]="msoulscat_Wac_PptFluidRuntime",i[i.ti=815]="msoulscat_Wac_PptShape",i[i.ni=817]="msoulscat_Wac_PptSession",i[i.oi=830]="msoulscat_Wac_PptSlideshow",i[i.ri=822]="msoulscat_Wac_PptView",i[i.si=846]="msoulscat_Wac_PptVideos",i[i.ai=1303]="msoulscat_Uci_Insights",i[i.ci=2300]="msoulscat_Wac_VersionHistory",i[i.di=302]="msoulscat_Wac_WordPresence",i[i.li=3e3]="msoulscat_Wac_OAuth",i[i.hi=3005]="msoulscat_Wac_WordVersionHistory",i[i.fi=3006]="msoulscat_Wac_LivePersonaCard",i[i.pi=3012]="msoulscat_Wac_CatchUpFlyout",i[i.vi=3016]="msoulscat_Wac_WordDesigner",i[i.mi=3021]="msoulscat_Wac_ModernFontPicker",i[i.wi=3027]="msoulscat_Wac_UnifiedUiHost",i[i.gi=3033]="msoulscat_Wac_EquationTools",i[i.Si=1401]="msoulscat_Osf_Latency",i[i.Ii=1402]="msoulscat_Osf_Notification",i[i.bi=1403]="msoulscat_Osf_Runtime",i[i.Ti=3041]="msoulscat_Wac_AiMaker",i[i.yi=3043]="msoulscat_Wac_AiRewrite",i[i.Ci=3044]="msoulscat_Wac_AiInsert",i[i.Ai=3047]="msoulscat_Wac_AiSummarize",i[i._i=3048]="msoulscat_Wac_CopilotCompose",i[i.Fi=3049]="msoulscat_Wac_Skittles"}(n||(n={})),function(i){i[i.Error=10]="Error",i[i.Warning=15]="Warning",i[i.Important=20]="Important",i[i.Info=50]="Info",i[i.Verbose=100]="Verbose",i[i.Spam=200]="Spam"}(o||(o={}));var r=["eurppc"];function s(i){return 8===i.toLowerCase().indexOf("ffc")}function a(i){return 8===i.toLowerCase().indexOf("ppc")}function c(i){var e=i.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return e&&e[1]?e[1]:"public"}function u(i){var e=i.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}function d(i,e){var t=i.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!t)throw new Error("Invalid URL");var n=t[2];if(void 0===e)return n;if(e<0)throw new Error("subDomainParts should be at least 1");return n.split(".").slice(-(e+1)).join(".")}function l(i,e,t){t&&(i[e.toLowerCase()]=t)}function h(i,e){i[e.toLowerCase()]=""}function f(i,e){var t=i.toLowerCase(),n=e.toLowerCase(),o=t.indexOf("&"+n+"=");if(-1===o&&(o=t.indexOf("?"+n+"=")),-1===o)return"";var r=o+(e.length+2),s=i.indexOf("&",r);return i.substring(r,-1===s?void 0:s)}function p(i,e,t,n){if(!t)return i;var o=i,r=o.indexOf("?"),s="&";r===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?s="":-1===r&&(s="?");var a=e.toLowerCase()+"=",c=new RegExp("\\W"+a,"i").exec(o);if("?"!==s&&c){if(n){var u=c.index+1,d=o.indexOf("&",u);o=o.substring(0,u)+a+t+(-1===d?"":o.substring(d))}return o}return o.concat(s,a,t)}function v(i){var e={},t=i.indexOf("?");return-1===t||t===i.length-1||i.substring(t+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(i){if(i){var t=i.indexOf("=");-1!==t&&t!==i.length-1&&(e[i.substring(0,t).toLowerCase()]=i.substring(t+1))}})),e}function m(i,e){if(!i)return i;var t=i,n=t.indexOf("?"),o=e.toLowerCase()+"=",r=t.toLowerCase().indexOf(o,n);if(r>=0){var s=t.indexOf("&",r);return"&"===(t=t.substring(0,r)+(-1===s?"":t.substring(s+1))).slice(-1)&&(t=t.slice(0,-1)),t}return i}function w(i){var e=new RegExp("(c[1-5])h?(-)");return i.replace(e,"$1h$2")}function g(i,e,t){var n=new RegExp("[?&]"+e+"=("+(t||"1")+")\\b","i"),o=i.match(n);return!!o&&(!t||o[1]===t)}function S(i,e){var t=f(i,e);return t?decodeURI(t):t}function I(i){return i?i.indexOf("://")>-1?i.split("/")[2]:i.split("/")[0]:""}var b={BUILD_NUMBER: "16.0.17106.40601"};function T(){try{return "16.0.17106.40601"}catch(i){return b.BUILD_NUMBER}}function y(){return function(i){if(!i)throw new Error("Build number not available");var e=i.split(".");if(4!==e.length)throw new Error("Build number has incorrect format");return e[0]+e[2]+e[3]}(T())}function C(i){if(i){var e=i.lastIndexOf(".");if(-1!==e)return i.substring(e+1).toLowerCase()}return""}function A(i){return JSON.stringify(i,Object.getOwnPropertyNames(i))}var _,F,E=function(){try{var i=window.performance;return i&&i.now&&i.now()!==1/0}catch(i){return!1}}();function V(){return E?window.performance.now():Date.now()}function R(){if(!_){var i=window.performance;_=E&&i.timing&&i.timing.navigationStart?function(){return Math.round(i.now()+i.timing.navigationStart)}:Date.now?Date.now:function(){return(new Date).getTime()}}return _()}function O(){var i=new Uint8Array(31),e=function(i){var e={crypto:!1,perfNow:!1,exceptions:[]},t=window.crypto||window.msCrypto;if(t){e.crypto=!0;try{return t.getRandomValues(i),e}catch(i){e.exceptions.push("crypto: ".concat(A(i)))}}e.perfNow=E;for(var n=0;n<i.length;n+=1){try{if(E){var o=Math.floor(100*window.performance.now())%10;(o<0||o>9)&&(o=0);for(var r=0;r<o;r+=1)Math.random()}}catch(i){e.exceptions.push("Math.random: ".concat(A(i)))}i[n]=Math.floor(16*Math.random())}return e}(i),t=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=15&i[t];return t+=1,("x"===e?n:3&n|8).toString(16)})),e]}function x(i,e,t){if(e){var n=window.navigator;if(n&&n.sendBeacon)try{return void n.sendBeacon(e,i)}catch(i){}!function(i,e,t){var n=new XMLHttpRequest;n.readyState!==XMLHttpRequest.UNSENT&&n.readyState!==XMLHttpRequest.DONE||(n.open("POST",e,t),n.send(i))}(i,e,t)}}function P(i,e,t){!function(i,e,t,n){void 0===n&&(n=!0);var o={type:e,payloadJson:JSON.stringify(t)};x(JSON.stringify(o),i,n)}(i,"JSAPI_STATE",{application:e,build:T(),state:t})}function U(i,e,t,n){var o=[],r=i.map((function(i){return function(i,e,t){var n={};if(n.G=i.tag,n.T=i.timestamp-e,n.M=i.message,n.C=i.category,i.correlationId){var o=t.findIndex((function(e){return e===i.correlationId}));o<0&&(o=t.push(i.correlationId)-1),n.I=o}var r=1e3*i.type+i.level;return n.D=r,n}(i,n,o)})),s=function(i,e,t,n,o){var r={};r.T=i,r.L=e,r.S=t,r.I=n,o&&o.length>0&&(r.W=o);return r.V=1,r}(n,r,e,t,o);return JSON.stringify(s)}!function(i){i[i.Trace=0]="Trace",i[i.Assert=1]="Assert"}(F||(F={}));var D,k,W=function(){function i(i){var e=this;this.Ei=3e4,this.Vi=30,this.Ri=0,this.Oi=[],this.xi=R(),this.Pi=[],this.Ui="",this.Di=0,this.flushOnClose=function(){e.ki(!1,!1)},this.flush=function(){e.Wi()},this.flushAndSetNewEndpoint=function(i,t){var n,o=e.Ni(i);o.localeCompare(null!==(n=e.Bi)&&void 0!==n?n:"",void 0,{sensitivity:"accent"})&&(e.Pi.push((function(){e.Bi=o,t&&t()})),e.ki(!0,!0))},this.Ni=function(i){return i+"?usid="+e.Ui+"&officeserverversion="+T()},this.Wi=function(){window.setTimeout((function(){return e.ki(!0,!0)}),0)},this.ki=function(i,t){var n=V();if(window.clearTimeout(e.Mi),e.Bi){if(e.Oi.length>0)e.Ri+=1,x(U(e.Oi.splice(0,i?e.Vi:e.Oi.length),e.Ui,e.Ri,e.xi),e.Bi,t),e.xi=R();0===e.Oi.length&&e.Pi.length>0&&(e.Pi.forEach((function(i){"requestIdleCallback"in window?window.requestIdleCallback(i):window.setTimeout(i,0)})),e.Pi=[]),i&&(e.Mi=window.setTimeout((function(){e.Wi()}),e.Oi.length>e.Vi||e.Pi.length>0?1e3:e.Ei)),e.Di+=V()-n}},i&&this.configure(i)}return i.prototype.getTimeSpentLogging=function(){return this.Di},i.prototype.addLoggingTime=function(i){this.Di+=i},i.prototype.configure=function(i){var e=this,t=V();if(i.uploadCadenceInMs&&(this.Ei=i.uploadCadenceInMs),i.uploadTriggerSize&&(this.Vi=i.uploadTriggerSize),i.sessionId&&(this.Ui=i.sessionId),i.remoteUlsEndpoint){if(!i.sessionId&&this.Bi)throw new Error("Remote ULS endpoint is already set");this.Bi=this.Ni(i.remoteUlsEndpoint),this.xi=R(),window.setTimeout((function(){return e.ki(!0,!0)}),0)}this.Di+=V()-t},i.prototype.handleTrace=function(i){var e=V();i.message.length>3072&&(i.message=i.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.Oi.push(i),(this.Oi.length>this.Vi||i.level===o.Error)&&this.Wi(),this.Di+=V()-e},i.prototype.getUserSessionId=function(){return this.Ui},i}(),N=[];!function(i){i.Hi="BootstrapperMaxUlsHeartbeatTime",i.Li="BootstrapperNoCompleteWarning1Time",i.Ji="BootstrapperNoCompleteWarning2Time",i.ji="RemoteUlsETag",i.Gi="RemoteUlsSuppressions",i.zi="BootstrapperSettingsFetchPeriod",i.qi="timestamp",i.Ki="BootstrapperUlsHeartbeatIntervalMs",i.Xi="BootstrapperUlsHeartBeatIsEnabled",i.$i="BootstrapperUlsUploadCadenceMs",i.Zi="WordConsumptionViewToEditRedirectIsEnabled",i.Yi="RequestedCallThrottlingDefaultToViewMinimumValue",i.Qi="BulsEndpointUrl",i.ie="EnableCommonHostDiagnosticsParams",i.ee="EnableICNForWord"}(k||(k={}));function B(i){var e=new W(i);function t(i,t,n,o){var r=V();if(!function(i){return 1===N[i]}(i)){var s={timestamp:R(),category:t,tag:i,level:n,type:F.Trace,message:o,correlationId:""};e.addLoggingTime(V()-r),e.handleTrace(s)}}return{ULS:{te:function(i,e,n,o){t(i,e,n,o)},shipAssertTag:function(i,e,n,r){n&&t(i,e,o.Error,r)},debugAssertTag:function(i,e,t,n){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:e.flush,flushOnClose:e.flushOnClose,setCorrelationId:function(){}},configure:function(i){e.configure(i)},settingsChangeHandler:function(i){var t,n;t=i.ne.getValue(k.Gi,""),n=i.ne.getValue(k.ji,""),D&&n===D||(N=[],D=n,t&&t.split(",").forEach((function(i){var e=parseInt(i,10);e&&(N[e]=1)}))),e.configure({uploadCadenceInMs:i.ne.getValue(k.$i,6e4)});var o=i.ne.getValue(k.Qi,"").toString();""!==o&&e.flushAndSetNewEndpoint(o)},getTimeSpentLogging:function(){return e.getTimeSpentLogging()},getUserSessionId:function(){return e.getUserSessionId()},flushAndSetNewEndpoint:function(i,t){e.flushAndSetNewEndpoint(i,t)}}}var M=function(){return(M=Object.assign||function(i){for(var e,t=1,n=arguments.length;t<n;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i}).apply(this,arguments)};function H(i,e,t,n){return new(t||(t=Promise))((function(o,r){function s(i){try{c(n.next(i))}catch(i){r(i)}}function a(i){try{c(n.throw(i))}catch(i){r(i)}}function c(i){var e;i.done?o(i.value):(e=i.value,e instanceof t?e:new t((function(i){i(e)}))).then(s,a)}c((n=n.apply(i,e||[])).next())}))}function L(i,e){var t,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(i,s)}catch(i){a=[6,i],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;var J;Object.create;!function(i){i[i.Firefox=0]="Firefox",i[i.Opera=1]="Opera",i[i.IE=2]="IE",i[i.Edge=3]="Edge",i[i.Chrome=4]="Chrome",i[i.Safari=5]="Safari",i[i.TeamsElectron=6]="TeamsElectron",i[i.Unknown=7]="Unknown"}(J||(J={}));var j=window.navigator,G=j?j.userAgent:void 0;function z(){if(G){if(G.indexOf("Firefox")>-1)return J.Firefox;if(G.indexOf("Opera")>-1||G.indexOf("OPR")>-1)return J.Opera;if(G.indexOf("Trident")>-1)return J.IE;if(G.indexOf("Electron")>-1&&G.indexOf("Teams")>-1)return J.TeamsElectron;if(G.indexOf("Edg")>-1)return J.Edge;if(G.indexOf("Chrome")>-1)return J.Chrome;if(G.indexOf("Safari")>-1)return J.Safari}return J.Unknown}function q(){try{return!!G&&G.indexOf("iPad")>=0||!!G&&G.indexOf("Macintosh")>=0&&Y()&&!Z()||!!G&&G.indexOf("Android")>=0||Y()}catch(i){return!1}}function K(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(i){return!1}}function X(){return z()===J.IE&&!function(){if(z()!==J.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function $(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(i){return!1}}function Z(){return!!G&&G.indexOf("iPhone")>=0}function Y(){return!!j&&j.maxTouchPoints>0}function Q(i,e){e&&Object.keys(e).forEach((function(t){i[t]=e[t]}))}function ii(i,e){try{if(void 0===window.performance)return void e.ULS.te(595948609,n.B,o.Info,"Performance not supported");var t=window.performance.getEntriesByType("resource");if(void 0===t||t.length<=0)return void e.ULS.te(595948610,n.B,o.Info,"No resources under performance");for(var r=new RegExp(i+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i"),s=t.length-1;s>=0;s-=1){var a=t[s],c=a.name.match(r);if(c){var u=JSON.stringify(a);return u=u.replace(new RegExp(a.name,"g"),c[0]),void e.ULS.te(595948616,n.B,o.Info,u)}}e.ULS.te(595948484,n.B,o.Info,"Could not find JSAPI resource timing entry")}catch(i){e.ULS.te(595948617,n.B,o.Info,"Could not trace the resource timing: ".concat(A(i)))}}function ei(i){var e,t,n=M(M({},i.host),{sessionId:i.hostSessionId,domain:location?location.host:void 0});delete n.siteId,delete n.webId,delete n.uiHostTabId;var o={};if(i.wdParams){var r=JSON.parse(JSON.stringify(i.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(i){r[i]&&(o[i]=r[i])}));var s=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;o.wdprevioussession&&!s.test(o.wdprevioussession)&&delete o.wdprevioussession,o.wdpreviouscorrelation&&!s.test(o.wdpreviouscorrelation)&&delete o.wdpreviouscorrelation}var a=M({},i.rebootOverride);delete a.ackExpected,delete a["ui-language"],delete a.wdUserSession,delete a.rebootMode,delete a.documentUrl;var u=i.wopi;return{accessToken:u?{length:u.accessToken.length,expiry:u.expiry}:"N/A",wacToken:u&&u.wacToken?{length:u.wacToken.length}:void 0,bootParams:i.bootParams,build:T(),host:n,intent:i.intent,jsApiVersion:"v2",rebootOverride:a,region:c(i.appBaseUrl),sessionOrigin:i.hostInitDiagnostics?i.hostInitDiagnostics.entryPoint:void 0,sessionContext:i.sessionContext,throttling:i.throttling,ui:i.ui,viewMode:i.viewMode,meeting:i.meeting?{id:null===(e=i.meeting)||void 0===e?void 0:e.id,isPresenter:null===(t=i.meeting)||void 0===t?void 0:t.isPresenter}:void 0,wdParams:o}}function ti(){var i={perfNowSupported:E,browser:J[z()],touchMode:q(),highContrast:K(),windows10x:$()};try{var e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection;t&&(i.netDownlink=t.downlink,i.netDownlinkMax=t.downlinkMax,i.netEffectiveType=t.effectiveType,i.netRtt=t.rtt,i.netSaveData=t.saveData,i.netType=t.type),i.deviceMemory=e.deviceMemory,i.logicalProcessors=e.hardwareConcurrency}catch(i){}return i}var ni,oi;function ri(i){var e=window.performance.timing;e&&(i.hostPageNavigationStartTime||(i.hostPageNavigationStartTime=e.navigationStart),i.hostPageFetchStartTime||(i.hostPageFetchStartTime=e.fetchStart),i.hostPageRequestStartTime||(i.hostPageRequestStartTime=e.requestStart),i.hostPageResponseStartTime||(i.hostPageResponseStartTime=e.responseStart),i.hostPageResponseEndTime||(i.hostPageResponseEndTime=e.responseEnd),i.hostPageDomCompleteTime||(i.hostPageDomCompleteTime=e.domComplete));var t=window.performance.navigation;if(t&&(void 0===i.hostPageRedirectCount&&(i.hostPageRedirectCount=t.redirectCount),!i.hostPageNavigationType)){var n="UNKNOWN";switch(t.type){case 0:n="NAVIGATE";break;case 1:n="RELOAD";break;case 2:n="BACK_FORWARD";break;case 255:n="RESERVED"}i.hostPageNavigationType=n}}function si(i){var e=document.createElement("link");e.rel="preconnect",e.href=i,e.crossOrigin="anonymous",document.head.appendChild(e)}function ai(i,e){return void 0===i&&(i=!1),{shouldPreconnect:function(i){return ui&&(!e||e(i))},preconnect:function(e){return si(i?w(e):e)}}}!function(i){i[i.Unknown=0]="Unknown",i[i.Normal=1]="Normal",i[i.Minor=2]="Minor",i[i.Medium=3]="Medium",i[i.Major=4]="Major",i[i.Critical=5]="Critical"}(ni||(ni={})),function(i){i.oe="App_AccessibilityLoopComplete",i.re="Wac_ActionComplete",i.se="WacInitialize_Ready",i.ae="Wac_AppFailed",i.ce="Wac_AppBootState",i.ue="Wac_AppCompleted",i.de="BrowserEvent",i.le="UI_Close",i.he="App_CloseTab",i.fe="UI_Conversation",i.pe="UI_CopyAndEdit",i.ve="App_CreateNewDocument",i.me="Wac_AppDataSavedStatus",i.we="UI_Download",i.ge="UI_Edit",i.Se="Error",i.Ie="UI_FileEmbed",i.be="UI_FileProperties",i.Te="File_Rename",i.ye="File_RenameFailed",i.Ce="UI_FileVersions",i.Ae="StateChanged",i._e="App_IsFrameTrusted",i.Fe="GetAccessToken",i.Ee="App_GetAuthToken",i.Ve="App_GetCustomAuthConfig",i.Re="App_GetHostKeyValue",i.Oe="App_WopiInfoFromUrl",i.xe="App_DavUrlFromIds",i.Pe="App_LoadingStatus",i.Ue="App_SwitchMode",i.De="App_MoveToFolder",i.ke="UI_OpenInMobileApp",i.We="UI_OpenInBrowser",i.Ne="UI_OpenInClient",i.Be="PageChanged",i.Me="App_PushCommentContext",i.He="App_PushState",i.Le="App_DocReboot",i.Je="UI_RedeemForCommenting",i.je="App_RefreshSessionInfo",i.Ge="UI_ReplyWithChanges",i.ze="UI_ReportAbuse",i.qe="App_FilePicker",i.Ke="UI_SaveStatus",i.Xe="WopiSession_Complete_Ack",i.$e="SetOverlayContent",i.Ze="UI_Sharing",i.Ye="UI_ShareForm",i.Qe="UI_SignIn",i.it="App_StoreHostKeyValue",i.et="App_Unloaded",i.tt="App_UlsLog",i.nt="Wac_UnloadingApp",i.ot="App_UpdateBootComplete",i.rt="PageCount",i.st="UI_CheckUserAccessAndGrantPermissions",i.ct="User_Activity",i.ut="Edit_Notification",i.dt="UI_Workflow",i.lt="ZoomChanged",i.ht="CAAEMessage",i.ft="Excel_HostFrameCacheSave",i.pt="Excel_HostFrameCacheEvict",i.vt="Excel_RegenerateFileBundle",i.wt="App_SwitchToWacFrame",i.gt="App_SaveSSRData",i.St="App_PurgeDataInHostCache",i.It="App_SaveHostRenderingV2Data",i.bt="App_SaveHostUtilsData",i.Tt="AcquireOAuthTokenTeams",i.yt="App_SwitchNotebook",i.Ct="FailedBoot_CheckFileInfo",i.At="GetTeamsUsers",i._t="SendTeamsUserMention",i.Ft="NavigateBackToHost",i.Et="App_GetClientUrlComplete",i.Vt="App_GetWebUrlComplete",i.Rt="App_CopyLinkComplete",i.Ot="App_SendConversationId",i.xt="CloseTeamsConversation",i.Pt="PageLoaded",i.Ut="Visio_BRS",i.Dt="Visio_SendLicenseInfo",i.kt="Visio_Consumption_CLTComplete",i.Wt="Visio_SwitchMode_FromViewFrame",i.Nt="Visio_ModeSwitch_ToHost_Ack",i.Bt="Visio_UpdateEditUrl",i.Mt="Visio_PageViewLoaded",i.Ht="Visio_ActiveAppFrameLoadFailed",i.Lt="Visio_DisposeBkgFrame",i.Jt="Visio_ReadyToReceiveDocData",i.jt="Visio_DocReboot_HostNav",i.Gt="Visio_SwitchToVisioFrame",i.zt="WacAppPerfMetric",i.qt="App_ModifyURLState"}(oi||(oi={}));var ci,ui=!0,di=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://nleditor.osi.office.net/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com"],li=function(){function i(i){var e=this;this.Kt={},this.Xt=[],this.$t=function(i){if(i&&i.origin)try{var t=i.data;if("string"==typeof t&&t.includes("AddinTrustedOrigin")){var r=JSON.parse(t),s=r.AddinTrustId;s&&"AddinTrustedOrigin"===r.MessageId&&(e.Zt.ULS.te(560754784,n.B,o.Info,"didReceiveMessage addinTrustId ".concat(s)),e.Kt[s]=i.origin,e.Xt.forEach((function(e){e(s,i.origin)})))}}catch(i){e.Zt.ULS.te(560754785,n.B,o.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.Zt=i,window.addEventListener("message",this.$t)}return i.prototype.isResourceTrustedForMessage=function(i){return H(this,void 0,void 0,(function(){var e,t,r,s,a,c,u,d,l=this;return L(this,(function(h){switch(h.label){case 0:return i&&i.Resource?(e=i.Resource,t=i.AddinTrustId,(r=function(i){if(!i)return!1;for(var e=i.toLowerCase(),t=0,n=di;t<n.length;t++){var o=n[t];if(o===e||"".concat(o,"/")===e)return!0}return!1}(e))||!t?[2,r]:this.Kt[t]?[2,hi(e,this.Kt[t])]:(a=new Promise((function(i){s=function(n,o){t===n&&i(hi(e,o))},l.Xt.push(s)})),c=-1,2e3,u=new Promise((function(i){c=window.setTimeout((function(){l.Zt.ULS.te(560754786,n.B,o.Warning,"isResourceTrustedForMessage - timeout waiting for addinTrustId: ".concat(t)),i(!1)}),2e3)})),[4,Promise.race([a,u])])):[2,!1];case 1:return d=h.sent(),this.Xt=this.Xt.filter((function(i){return i!==s})),window.clearTimeout(c),[2,d]}}))}))},i.prototype.dispose=function(){this.Kt={},this.Xt=[],window.removeEventListener("message",this.$t)},i}();function hi(i,e){try{if(!i||!e)return!1;for(var t=/[?&#%\\]/,n=0;n<i.length;n+=1){var o=i.charCodeAt(n);if(o<33||o>126)return!1;var r=i.charAt(n);if(t.test(r))return!1}var s=i;"api:"===s.substring(0,"api:".length).toLowerCase()&&(s="".concat("https:").concat(s.substring("api:".length)));var a=new URL(s);return"https:"===a.protocol&&e.toLowerCase()===a.origin.toLowerCase()}catch(i){return!1}}!function(i){i.AppInitError="AppInitError",i.ApiDisabledError="ApiDisabledError",i.CannotLoadFirstPage="CannotLoadFirstPage",i.InvalidWopiInfo="InvalidWopiInfo",i.TimeoutWacReady="TimeoutWacReady",i.WacFailed="WacFailed"}(ci||(ci={}));var fi,pi=function(){function i(){this.Yt=[]}return i.prototype.add=function(i){i&&this.Yt.push(i)},i.prototype.remove=function(i){if(i){var e=this.Yt.indexOf(i);e>-1&&this.Yt.splice(e,1)}},i.prototype.removeAll=function(){this.Yt=[]},i.prototype.dispatch=function(i,e){this.Yt.forEach((function(t){try{t(i)}catch(i){e&&e(i)}}))},i}(),vi=function(){function i(i,e){var t=this;this.Qt=0,this.in=function(){try{if(!window||!window.localStorage)return;var i=window.localStorage.getItem(t.en);if(!i)return;var e=JSON.parse(i);t.tn(e)}catch(i){t.Zt.ULS.te(592836768,n.B,o.Warning,"Failed to get settings from localStorage: "+A(i))}},this.tn=function(i){return!!t.nn(i)&&(t.on=i,t.rn.dispatch({ne:t},(function(i){t.Zt.ULS.te(592836769,n.B,o.Error,"Settings listener error: "+A(i))})),!0)},this.nn=function(i){if(i&&"object"==typeof i){if(i.hasOwnProperty(k.qi)&&!isNaN(i.timestamp))return!0;t.Zt.ULS.te(592836770,n.B,o.Error,"Received invalid settings")}return!1},this.sn=function(){if(t.an){var i=new XMLHttpRequest;i.open("GET",t.an),i.responseType="json",i.timeout=5e3,i.send(),i.onload=function(){if(200===i.status&&i.response?(t.cn(i.response),t.Qt=0):(t.Zt.ULS.te(592836771,n.B,o.Error,"Fetch settings error. Status: ".concat(i.status,", curErrors: ").concat(t.Qt)),t.Qt+=1),!(t.Qt>7)){var e=t.getValue(k.zi,3e5);t.Qt>3&&(e+=(t.Qt-3+1)*(e/2)),t.un=window.setTimeout(t.sn,e)}}}},this.cn=function(i){"requestIdleCallback"in window?(t.dn&&self.cancelIdleCallback(t.dn),t.dn=window.requestIdleCallback((function(){return t.ln(i)}),{timeout:1e4})):window.setTimeout((function(){return t.ln(i)}),0)},this.ln=function(i){if(t.tn(i)&&window&&window.localStorage){var e=JSON.stringify(i);try{window.localStorage.setItem(t.en,e)}catch(i){t.Zt.ULS.te(592836800,n.B,o.Warning,"Failed to set localStorage: "+A(i))}}},this.hn=i,this.en="Prod"+i+"Settings",this.Zt=e,this.rn=new pi,this.in()}return i.prototype.initializePeriodicFetch=function(i,e){this.en=(s(i)?"FF":"Prod")+this.hn+"Settings",this.in(),this.an=i+"AppSettingsHandler.ashx?app="+this.hn+"&usid="+e+"&build="+T(),this.un||(this.un=window.setTimeout(this.sn,3e4))},i.prototype.getValue=function(i,e){if(this.on||this.in(),!this.on||!this.on.hasOwnProperty(i))return e;var t=this.on[i],n=typeof e;if(typeof t===n)return t;if("string"==typeof t){if("number"===n)return parseInt(t,10);if("boolean"===n)return"true"===t}return e},i.prototype.addSettingsChangeListener=function(i){this.rn.add(i)},i.prototype.removeSettingsChangeListener=function(i){this.rn.remove(i)},i.prototype.dispose=function(){this.un&&window.clearTimeout(this.un),this.dn&&self.cancelIdleCallback(this.dn),this.un=void 0,this.dn=void 0,this.on=void 0,this.rn.removeAll()},i}();function mi(i,e){return{isFeatureEnabled:function(t){return function(i,e,t){if(!e)return;try{return e(i)}catch(i){t&&t.ULS.te(594883024,n.B,o.Error,"IsFeatureEnabled callback error: "+A(i))}return}(t,i,e)}}}function wi(i,e){var t={};if(Object.keys(fi).forEach((function(e){var n=i.isFeatureEnabled(fi[e]);void 0!==n&&(t[fi[e]]=n?"1":"0")})),e&&e.wdFlights)for(var n=0,o=e.wdFlights.toLowerCase().split(",");n<o.length;n++){var r=o[n];"et-treatment"!==r&&"et-control"!==r||(t[fi.fn]="et-treatment"===r?"1":"0")}return JSON.stringify(t)}!function(i){i.fn="EnterpriseTemplates",i.pn="ExcelAdaptiveLayoutDownload",i.vn="ExcelLandingPageOfflineTelemetry",i.mn="ExcelLandingPageObserverRetry",i.wn="H2StaticContent",i.gn="HashedUrl",i.Sn="ODCShareLinkPreload",i.In="OfficeComExcelJsApiV2",i.bn="OfficeComPptJsApiV2",i.Tn="OfficeComUiHost",i.yn="OfficeComWordJsApiV2",i.Cn="OfficeHwaUiHost",i.An="OfficeUnifiedUiHostTeams",i._n="WordViewToUnifiedRead",i.Fn="FrameSizeFixForUiHostTeams"}(fi||(fi={}));var gi=function(){function i(i,e){this.En=function(){return Si(i,"OnBeforeUnload",e)},this.Vn=function(){return Si(i,"OnPageHide",e)},this.Rn=function(){return Si(i,"VisibilityChange_"+document.visibilityState,e)},this.On=function(){return Si(i,"OnUnload",e)},window.addEventListener("beforeunload",this.En,{capture:!0,once:!0}),window.addEventListener("pagehide",this.Vn,{capture:!0}),window.addEventListener("visibilitychange",this.Rn,{capture:!0}),window.addEventListener("unload",this.On,{capture:!0,once:!0})}return i.prototype.dispose=function(){window.removeEventListener("beforeunload",this.En,{capture:!0}),window.removeEventListener("pagehide",this.Vn,{capture:!0}),window.removeEventListener("visibilitychange",this.Rn,{capture:!0}),window.removeEventListener("unload",this.On,{capture:!0})},i}();function Si(i,e,t){i.ULS.te(595957843,n.B,o.Info,"Page lifecycle: ".concat(e," fired")+(t?", flushing logger":"")),t&&i.ULS.flush()}var Ii;function bi(i,e){return i+"RemoteTelemetry.ashx"+(e?"?usid="+e:"")}function Ti(i,e){return bi(yi(i),e)}function yi(i){var e=i.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!e)throw new Error("Invalid URL");return e[1]}!function(i){i.xn="access_token",i.Pn="access_token_ttl",i.Un="wac_token",i.Dn="bundleSrc",i.kn="bundleStaleness",i.Wn="DocID",i.Nn="SiteID",i.Bn="WebID",i.Mn="ETag",i.Hn="feature_status",i.Ln="fileExtension",i.Jn="fileGetUrl",i.jn="customFontCatalogUrl",i.Gn="fileName",i.zn="fileSize",i.qn="forceSLR",i.Kn="frameHeightPx",i.Xn="frameWidthtPx",i.$n="highContrast",i.Zn="highDpi",i.Yn="host_diagnostics",i.Qn="hostName",i.io="huictrls",i.eo="owner_id",i.to="sc",i.no="softBlockedBrowser",i.oo="templateUrl",i.ro="touchMode",i.so="user_id",i.ao="hfck",i.co="hfcv",i.uo="timeZoneId",i.do="darkCssMedia",i.lo="caae",i.ho="meetingId",i.fo="meetingTitle",i.po="meetingType",i.vo="scheduledStartTime",i.mo="scheduledEndTime",i.wo="isPresenter",i.So="meetingOrganizerId",i.Io="meetingJoinUrl",i.bo="isMeetingTeamsRoom",i.To="jsapibuild",i.yo="owlver",i.Co="owlro",i.Ao="caaemode"}(Ii||(Ii={}));var Ci;function Ai(i,e){z()===J.Safari?i.style.display=e?"none":"block":i.style.visibility=e?"hidden":"visible"}function _i(i,e,t){l(e,Ii.Kn,String(t?window.outerHeight:i.offsetHeight)),l(e,Ii.Xn,String(t?window.outerWidth:i.offsetWidth)),l(e,Ii.ro,String(q())),l(e,Ii.$n,String(K())),l(e,Ii.qn,String($())),l(e,Ii.do,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(i){return!1}}()))}function Fi(i){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(e){return i&&i.ULS.te(591525084,n.B,o.Info,"Trust check error: ".concat(A(e))),!1}}function Ei(i){var e=window.navigator;if(e&&e.virtualKeyboard&&void 0!==e.virtualKeyboard.overlaysContent&&window===top)return e.virtualKeyboard.overlaysContent=i}!function(i){i._o="Ack",i.Fo="WacInitialize_Ready_Ack",i.Eo="Wac_BeforeUnloadApp",i.Vo="Blur_Focus",i.Ro="Wac_AppFailed_Ack",i.Oo="Wac_AppCompleted_Ack",i.xo="WopiStartSession_Complete",i.Po="WopiPendingSession_Complete",i.Uo="Host_AccessibilityLoopComplete",i._e="Host_IsFrameTrusted",i.Do="Grab_Focus",i.ko="HostCacheDiagnostic",i.Wo="Host_KeyValue",i.No="JsApiDiagnostics",i.De="Host_MoveToFolder",i.Bo="PageChanged_Ack",i.Mo="App_PopState",i.Ho="Host_SendChannelId",i.Lo="Host_SendConversationId",i.Jo="GetTeamsUsers_Reply",i.jo="SendTeamsUserMention_Reply",i.Go="Host_BackButtonPressed",i.zo="Host_GetClientUrl",i.qo="Host_GetWebUrl",i.Ko="OwlFrameDiagnostics",i.Xo="File_Rename",i.qe="Host_FilePicker",i.$o="PostAccessToken",i.Zo="Host_SetAuthToken",i.Yo="Host_SetCustomAuthConfig",i.Qo="App_PushCommentContext",i.ir="CanEmbed",i.er="Host_RefreshSessionInfo",i.tr="CheckUserAccessAndGrantPermissions_Result",i.nr="Host_WopiInfoFromUrl",i.or="Host_DavUrlFromIds",i.rr="SetCurrentPage",i.sr="SetZoomLevel",i.ar="WopiPendingSession_Fail",i.cr="SetOverlayContent",i.ur="WopiPendingApplicationComplete_Received",i.dr="Host_SwitchMode",i.lr="Host_Unload",i.hr="PageCount_Ack",i.pr="ZoomChanged_Ack",i.vr="Host_ShareUI",i.mr="Host_Telemetry",i.wr="Visio_ConsumptionCLTComplete_Ack",i.gr="Visio_SwitchMode_FromHF_Ack",i.Sr="Visio_SwitchMode_FromHostFrame",i.Ir="Visio_FallbackToLegacySwitch",i.br="Visio_DocumentData"}(Ci||(Ci={}));var Vi=function(i,e,t,n,o){return i!==oi.$e?Promise.reject("Wrong flow"):new Promise((function(i){Ei(e.overlayContent),t.container&&t.container.postMessage(Ci.cr,void 0),i({completion:"success"})}))};function Ri(i,e){e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach((function(t){return i[t]=e.Diagnostics[t]}))}function Oi(i,e){var t=M({},e);delete t.UserId,delete t.OwnerId,delete t.SiteId,delete t.WebId,delete t.Upn,delete t.TenantId,delete t.UiHostTabId,delete t.OriginalWdParam,delete t.WdParams;var n=t,o=e.WdParams?JSON.parse(JSON.stringify(e.WdParams).toLowerCase()):{};n.WdParams={};["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(i){o[i]&&(n.WdParams[i]=o[i])}));var r=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return n.WdParams.wdprevioussession&&!r.test(n.WdParams.wdprevioussession)&&delete n.WdParams.wdprevioussession,n.WdParams.wdpreviouscorrelation&&!r.test(n.WdParams.wdpreviouscorrelation)&&delete n.WdParams.wdpreviouscorrelation,n.UiEmbedMode=g(i,"uiembed"),n.UiHostName=f(i,"uih")||"N/A",n.HostDomain=location?location.hostname:"",n}function xi(i,e,t,n){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{n&&n(o)}finally{null!=o&&(o.onreadystatechange=function(){})}}},o.open("POST",i),t)o.setRequestHeader(r,t[r]);o.send(e)}var Pi=!1,Ui=!1;function Di(){Pi=!1}function ki(i,e,t,r,s,a,c){if(e.ULS.te(595714433,n.B,o.Info,"Starting disposing the application. unloadApp:".concat(i,"; disposed:").concat(Pi,"; unloading:").concat(Ui)),Pi||Ui&&i)e.ULS.te(595714908,n.B,o.Info,"Application is already disposed or unloading");else{var u,d={logger:e,postMessenger:t,innerApplicationFrame:r,onDisposed:s,onFrameRemoved:a,unloadTimeoutInMs:c||1e3,forceAppUnload:!1,disposeStartTime:R(),appUnloadTimedOut:!1};if(i&&r)return Ui=!0,d.forceAppUnload=!0,(u=d).forceAppUnloadStartTime=R(),u.logger.ULS.te(595855490,n.B,o.Info,"Sending postmessage to unload app"),u.logger.ULS.flush(),u.postMessenger.registerMessagePayloadHandler(oi.et,(function(i){return function(i,e){i.forceAppUnloadEndTime=R(),i.appUnloadedMessageValues=e,i.logger.ULS.te(595855491,n.B,o.Info,"AppUnloaded received from app"),Wi(i)}(u,i)})),u.postMessenger.sendPostMessage(u.innerApplicationFrame,Ci.lr,{}),void window.setTimeout((function(){return function(i){!Ui&&Pi||(i.appUnloadTimedOut=!0,i.logger.ULS.te(595855492,n.B,o.Info,"ApplicationUnload timed out, forcing dispose"),Wi(i))}(u)}),u.unloadTimeoutInMs);Wi(d)}}function Wi(i){if(!Pi)try{Pi=!0,Ui=!1,function(i){if(!i.innerApplicationFrame)return;i.innerApplicationFrame.src="about:blank",window.setTimeout((function(){i.innerApplicationFrame&&i.innerApplicationFrame.parentElement&&i.innerApplicationFrame.parentElement.removeChild(i.innerApplicationFrame),i.onFrameRemoved&&i.onFrameRemoved()}),0)}(i),function(i){var e={disposeStartTime:i.disposeStartTime,disposeEndTime:R(),forceAppUnload:i.forceAppUnload,appUnloadTimedOut:i.appUnloadTimedOut};i.forceAppUnloadStartTime&&(e.appUnloadStartTime=i.forceAppUnloadStartTime);i.forceAppUnloadEndTime&&(e.appUnloadEndTime=i.forceAppUnloadEndTime);if(i.appUnloadedMessageValues){var t=i.appUnloadedMessageValues,r=Number(t.hostMessageReceived);i.forceAppUnloadStartTime&&!isNaN(r)&&(e.hostToAppPostMessageLatency=r-i.forceAppUnloadStartTime);var s=Number(t.appMessageSent);!isNaN(s)&&i.forceAppUnloadEndTime&&(e.appToHostPostMessageLatency=i.forceAppUnloadEndTime-s);var a=Number(t.appUnloadStart),c=Number(t.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),t.serverTimings){var u=t.serverTimings;for(var d in u)e["st-"+d.toString()]=u[d]}}i.logger.ULS.te(595855436,n.B,o.Info,"App disposed "+JSON.stringify(e)),i.logger.ULS.flushOnClose()}(i),i.onDisposed&&i.onDisposed()}catch(e){i.logger.ULS.te(595714434,n.B,o.Error,"Error disposing: ".concat(A(e)))}}var Ni="WebApplicationFrame";function Bi(i,e,t,n,o,r,s){return function(i,e,t,n){_i(i,n);var o=e.ownerDocument,r=o.createElement("form");for(var s in r.id="office_form",r.name="office_form",r.action=t,r.target=i.name,r.method="POST",n){var a=o.createElement("input");a.type="hidden",a.name=s,a.value=n[s],r.appendChild(a)}return e.appendChild(r),r.submit(),i}(function(i,e,t){var n=i.ownerDocument.createElement("iframe");n.name=t||Ni,n.id=Ni,n.src="",n.title="Office Online Frame",n.width="100%",n.height="100%",n.marginWidth="0",n.marginHeight="0",n.style.left="0",n.style.top="0",n.style.right="0",n.style.bottom="0",n.style.display="block",n.style.position="absolute",n.style.backgroundColor="transparent",n.style.border="none",n.frameBorder="0",n.setAttribute("allowfullscreen","true"),n.setAttribute("allowTransparency","true");var o=u(e);return n.setAttribute("allow","microphone ".concat(o,"; autoplay ").concat(o,"; camera ").concat(o,"; clipboard-read ").concat(o,"; clipboard-write ").concat(o,"; keyboard-map ").concat(o,"; display-capture ").concat(o)),i.appendChild(n),n}(i,e,s),i,e,t)}function Mi(i,e){var t={};if(i.wopiInfo&&(t[Ii.xn]=i.wopiInfo.AccessToken,t[Ii.Pn]=Ji(i.wopiInfo),i.wopiInfo.WacToken&&(t[Ii.Un]=i.wopiInfo.WacToken)),i.wopiPrecheckInfo.BundleInfo&&i.wopiPrecheckInfo.BundleInfo.Url&&i.wopiPrecheckInfo.BundleInfo.Url.length>0)if(t[Ii.Dn]=i.wopiPrecheckInfo.BundleInfo.Url,null!=i.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==i.wopiPrecheckInfo.BundleInfo.BundleStaleness){var r=i.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();e.ULS.te(593503580,n.B,o.Info,"Content bundle staleness - "+r),t[Ii.kn]=r}else e.ULS.te(593503581,n.B,o.Info,"Content bundle staleness does not exist");if(i.wopiPrecheckInfo.FileGetUrl&&(t[Ii.Jn]=i.wopiPrecheckInfo.FileGetUrl),i.wopiPrecheckInfo.CustomFontCatalogUrl&&(t[Ii.jn]=i.wopiPrecheckInfo.CustomFontCatalogUrl),i.wopiPrecheckInfo.FileName){var s=C(i.wopiPrecheckInfo.FileName);s&&(t[Ii.Ln]=s),t[Ii.Gn]=i.wopiPrecheckInfo.FileName}i.newFileTemplateSource&&i.newFileTemplateSource.FileSize?t[Ii.zn]=i.newFileTemplateSource.FileSize.toString():i.wopiPrecheckInfo.FileSize&&(t[Ii.zn]=i.wopiPrecheckInfo.FileSize.toString()),i.sessionInformation.UserId&&(t[Ii.so]=i.sessionInformation.UserId),i.sessionInformation.OwnerId&&(t[Ii.eo]=i.sessionInformation.OwnerId),i.sessionInformation.SessionContext&&(t[Ii.to]=i.sessionInformation.SessionContext),i.diagnostics.HostInitDiagnostics&&(t[Ii.Yn]=JSON.stringify({HostInitializeDiagnostics:i.diagnostics.HostInitDiagnostics,ClientDiagnostics:i.diagnostics.ClientDiagnostics})),t[Ii.Hn]=wi(i.featureManager,i.sessionInformation.WdParams),i.applicationCustomSettings&&i.applicationCustomSettings.HostUIControls&&(t[Ii.io]=JSON.stringify(i.applicationCustomSettings.HostUIControls)),t[Ii.Zn]=String(window.devicePixelRatio>1.24),t[Ii.no]=String(X()),t[Ii.Qn]=i.sessionInformation.HostName;var a=i.newFileTemplateSource;a&&a.FileGetUrl&&(t[Ii.oo]=a.FileGetUrl),a&&a.DocUniqueId?t[Ii.Wn]=a.DocUniqueId:i.wopiPrecheckInfo.DocUniqueId&&(t[Ii.Wn]=i.wopiPrecheckInfo.DocUniqueId),a&&a.ETag?t[Ii.Mn]=a.ETag:i.wopiPrecheckInfo.ETag&&(t[Ii.Mn]=i.wopiPrecheckInfo.ETag),"Templatization"!==i.sessionInformation.ContentAssemblyMode&&"DocGen"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==i.sessionInformation.ContentAssemblyMode||(t[Ii.lo]="1"),i.sessionInformation.ContentAssemblyMode&&(t[Ii.Ao]=i.sessionInformation.ContentAssemblyMode);var c=i.sessionInformation.Meeting;c&&(c.id&&(t[Ii.ho]=c.id),c.title&&(t[Ii.fo]=c.title),c.type&&(t[Ii.po]=c.type),c.scheduledStartTime&&(t[Ii.mo]=c.scheduledStartTime),c.scheduledEndTime&&(t[Ii.mo]=c.scheduledEndTime),c.joinUrl&&(t[Ii.Io]=encodeURIComponent(c.joinUrl)),c.organizerId&&(t[Ii.So]=c.organizerId),c.isPresenter&&(t[Ii.wo]=c.isPresenter.toString()),c.isMeetingTeamsRoom&&(t[Ii.bo]=c.isMeetingTeamsRoom.toString()));var u=i.sessionInformation.OwlVersion;u&&(t[Ii.yo]=u);var d=i.sessionInformation.OwlRollout;return d&&(t[Ii.Co]=d),t[Ii.To]=T(),t}function Hi(i,e,t){void 0===t&&(t=!1);var n=i.applicationUrl;var o={jsApi:"1",jsapiver:"v1"};if(t&&(o.NewSession="1"),o.corrid=i.sessionId,o.usid=i.sessionId,o.sftc="1",(i.applicationCustomSettings&&i.applicationCustomSettings.IsCore||i.sessionInformation.IsCore)&&(o.core="1"),i.sessionInformation.HideViewerToolbar&&(o.hvt="1"),i.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),i.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(i.sessionInformation.HighContrastMode)),i.sessionInformation.SupportsAtMentions&&(o.sams="1"),i.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),i.sessionInformation.SupportsDocReboot){var r=i.sessionInformation.SupportsDocReboot;o.sdr=!0===r?"1":r.toString()}return i.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),i.sessionInformation.SupportsAuthToken&&(o.sat="1"),i.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),i.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),i.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),i.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),i.sessionInformation.UseDarkTheme&&(o.udt="1"),(i.sessionInformation.HideHeader||"DocGen"===i.sessionInformation.ContentAssemblyMode||"Templatization"===i.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===i.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===i.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),i.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),i.sessionInformation.HideChatInHeader&&(o.hch="1"),i.sessionInformation.HideMeInHeader&&(o.hmh="1"),i.sessionInformation.HideSearchInHeader&&(o.hsh="1"),i.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),i.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),i.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),i.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),i.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),i.sessionInformation.HideTitleInViewer&&(o.htv="1"),i.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),i.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),i.applicationCustomSettings&&i.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),i.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1"),"DocGen"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==i.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),i.sessionInformation.UIEmbed&&(o.uiEmbed="1"),i.sessionInformation.IsSynthetic&&(o.syn="1"),i.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),i.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),i.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(i.sessionInformation.UiHostIntegrationType)),i.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(i.sessionInformation.MetaUiHostVersion)),i.applicationCustomSettings&&i.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),i.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(i.wopiPrecheckInfo.PreseededSessionKey)),i.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(i.wopiPrecheckInfo.PreseededWacSessionId)),i.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=i.wopiPrecheckInfo.RequestedCallThrottling),i.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=i.wopiPrecheckInfo.ClientThrottlingProtection),i.applicationCustomSettings&&i.applicationCustomSettings.additionalApplicationParameters&&(o=M(M({},i.applicationCustomSettings.additionalApplicationParameters),o)),i.rebootOverrideData&&i.rebootOverrideData.queryOverrides&&(o=M(M({},o),i.rebootOverrideData.queryOverrides)),Li(n,i.sessionInformation,i.wopiInfo,i.diagnostics.HostInitDiagnostics,o)}function Li(i,e,t,n,o){var r=v(i);("teams"===r.uih&&"UnifiedUiHostTeams"!==e.UiHostIntegrationType&&"TeamsModern"!==e.UiHostIntegrationType||"owa"===r.uih)&&(r.hhdr="1");var s=i.indexOf("?"),a=-1===s?i.concat("?"):i.substring(0,s+1);e.UiLocale&&(r.ui=encodeURIComponent(e.UiLocale)),e.DataLocale&&(r.rs=encodeURIComponent(e.DataLocale)),e.HostSessionId&&(r.hid=encodeURIComponent(e.HostSessionId)),e.DisableChat&&(r.dchat="1"),e.SessionContext&&(r.sc=encodeURIComponent(e.SessionContext)),t&&t.WopiSrc&&(r.wopisrc=encodeURIComponent(t.WopiSrc)),e.CookieCompliant&&(r.mscc="1"),n&&(n.entryPoint&&(r.wdorigin=encodeURI(n.entryPoint)),n.userClickTime&&(r.wdhostclicktime=n.userClickTime.toString())),r=M(M(M({},r),e.WdParams),o);var c={};for(var u in r)c[u.toLowerCase()]=r[u];var d=[];for(var u in c)c[u]&&d.push(u.concat("=",c[u]));return a.concat(d.join("&"))}function Ji(i){return i.AccessTokenExpiry?i.AccessTokenExpiry.getTime().toString():"0"}var ji=function(){function i(i,e,t,n,o){this.Tr=0,this.yr=[],this.Cr=!1,this.Cr=i,this.Ar=e,this.Zt=t,this._r=n,this.Fr=o,this.restart()}return i.prototype.restart=function(){var i=this,e=this.Ar.getValue(k.Xi,!1);this.Tr=V()+(this.Fr?this.Fr:this.Ar.getValue(k.Hi,6e5));var t=this.Cr?3e3:5e3;this.Er=window.setInterval((function(){e&&i.Zt.ULS.te(595724178,n.B,o.Info,"Boot_HeartBeat"),V()>i.Tr&&(i.stop(),Gi(i.Zt),i._r&&i._r())}),this.Ar.getValue(k.Ki,t)),this.yr.push(window.setTimeout(Gi,this.Ar.getValue(k.Li,6e4),this.Zt,1)),this.yr.push(window.setTimeout(Gi,this.Ar.getValue(k.Ji,18e4),this.Zt,2))},i.prototype.stop=function(){this.Tr=0,this.Er&&(window.clearInterval(this.Er),this.Er=void 0),this.yr.forEach((function(i){window.clearTimeout(i)})),this.yr=[]},i}();function Gi(i,e){i.ULS.te(594901218,n.B,o.Warning,"Boot_NotComplete_".concat(e||"Final")),i.ULS.flush()}var zi;function qi(i){if(!i)return"";var e=""+document.cookie,t=new RegExp("(?:^|; )"+i+"=([^;]*)"),n=e.match(t);return!n||n.length<2?"":n[1]}function Ki(i,e,t,n,o){void 0===n&&(n=zi.none);var r=i+"="+e,s="",a=new Date;a.setTime(a.getTime()+31536e6);var c=new Date;c.setTime(c.getTime()+864e5*t),c>a&&(c=a),c&&(s=";expires="+c.toUTCString());var u=r+s+(";SameSite="+zi[n]);return document.cookie=o?u+"; Secure":u,!(!document.cookie||-1===document.cookie.indexOf(r))||n===zi.none&&Ki(i,e,t,zi.doNotSet,o)}function Xi(i){return qi(i.hostKey)}!function(i){i[i.doNotSet=0]="doNotSet",i[i.none=1]="none",i[i.lax=2]="lax",i[i.strict=3]="strict"}(zi||(zi={}));function $i(i){Ki(i.hostKey,i.hostValue,365)}var Zi=function(){function i(i,e,t,r,s,a){var c=this;if(this.Vr=!1,this.Rr=function(i,e){c.Or.officeFrameCreateTime=R(),c.xr.frameCreateStartTime=c.Or.officeFrameCreateTime;var t=c.Pr.applicationCustomSettings&&c.Pr.applicationCustomSettings.appFrameName;c.Ur=Bi(c.Pr.container,i,e,c.Pr.featureManager,c.Zt,c.Pr.sessionId,t),c.Dr.activate(c.Ur)},this.kr=function(i){c.Dr.registerMessagePayloadHandler(oi.ue,c.Wr),c.Dr.registerMessagePayloadHandler(oi.ae,c.Nr),c.Mi=window.setTimeout(c.Br,15e3),c.Mr=new ji(i,c.Pr.ne,c.Zt,(function(){P(c.Pr.remoteTelemetryUrl,"Visio","bootTimeout")}))},this.Hr=function(i){var e=i&&i.state?i.state:"unknown";c.Zt.ULS.te(595714271,n.B,o.Info,"WAC Boot App state:[".concat(e,"]"))},this.Lr=function(i){var e=Fi(c.Zt);c.Zt.ULS.te(595653903,n.B,o.Info,"Top frame is trusted: ".concat(e)),c.Jr(Ci._e,{isTopFrameTrusted:e})},this.jr=function(i){var e=Ei(i&&i.overlayContent);c.Zt.ULS.te(587487432,n.B,o.Info,"Overlay content: ".concat(e)),c.Jr(Ci.cr,void 0)},this.Wr=function(i){if(c.Zt.ULS.te(595986314,n.B,o.Info,"Received wac complete message"),c.Zt.ULS.flush(),window.clearTimeout(c.Mi),c.Mr&&c.Mr.stop(),c.Vr)c.Zt.ULS.te(596444234,n.B,o.Info,"Received multiple wac complete or failure messages");else{c.Vr=!0,c.Jr(Ci.Oo,{}),Ri(c.Or,i);var e=c.Gr();c.zr(e),c.Pr.ne.getValue(k.ie,!1)&&(c.Pr.diagnostics.HostInitDiagnostics||(c.Pr.diagnostics.HostInitDiagnostics={}),ri(c.Pr.diagnostics.HostInitDiagnostics)),c.qr(c.Pr.diagnostics)}},this.Kr=function(){c.Zt.ULS.te(579342464,n.B,o.Info,"Received close tab message");try{window.close()}catch(i){c.Zt.ULS.te(579213188,n.B,o.Warning,"Failed to close the browser tab")}},this.Gr=function(){return{innerApplicationFrame:c.Ur}},this.Nr=function(i){if(c.Zt.ULS.te(595986315,n.B,o.Error,"Received wac failed message"),c.Zt.ULS.flush(),window.clearTimeout(c.Mi),c.Mr&&c.Mr.stop(),c.Vr)c.Zt.ULS.te(596444235,n.B,o.Info,"Received multiple wac complete or failure messages");else{c.Vr=!0,c.Jr(Ci.Ro,{});var e={errorType:ci.WacFailed,errorObject:{}};i&&(e.errorObject=i.Error,c.xr.error=e),c.Xr(e)}},this.$r=function(i){var e=i.hostKey;c.Zt.ULS.te(574433173,n.B,o.Info,"GetHostKeyValue ".concat(e));var t=Xi(i);null!=t&&c.Jr(Ci.Wo,{hostKey:e,hostValue:t})},this.Zr=function(i){var e=i.hostKey,t=i.hostValue;c.Zt.ULS.te(574433174,n.B,o.Info,"storeHostKeyValue ".concat(e,": ").concat(t)),$i(i)},this.Br=function(){c.Vr||c.Zt.ULS.te(596444236,n.B,o.Warning,"Timeout. SessionTraces:"+JSON.stringify(c.xr))},this.qr=function(i){c.Jr(Ci.No,{HostInitializeDiagnostics:i.HostInitDiagnostics,ClientDiagnostics:i.ClientDiagnostics})},this.Jr=function(i,e){c.Ur&&c.Ur.contentWindow?c.Dr.sendPostMessage(c.Ur,i,e):c.Zt.ULS.te(595955718,n.B,o.Info,"Attempted to send postmessage: "+i)},void 0===e)throw new TypeError("bootFlowInfo");if(e.isSingleStepBoot&&void 0===i.wopiInfo)throw new TypeError("wopiInfo");this.Pr=i,this.Yr=e,this.Zt=t,this.Dr=r,this.zr=s,this.Xr=a,this.Or=i.diagnostics.AppInitDiagnostics,this.xr=i.diagnostics.SessionTraces,this.xr.wopiInitializeTime=R()}return i.prototype.Boot=function(){this.Zt.ULS.te(596444241,n.B,o.Info,"Initializing WAC frame");var i=Hi(this.Pr,this.Yr,!0),e=Mi(this.Pr,this.Zt);if(this.Dr.registerMessagePayloadHandler(oi.ce,this.Hr),this.Dr.registerMessagePayloadHandler(oi.he,this.Kr),this.Pr.sessionInformation.SupportsFrameTrustCheck||this.Dr.registerMessagePayloadHandler(oi._e,this.Lr),this.Dr.registerMessagePayloadHandler(oi.$e,this.jr),this.Dr.registerMessagePayloadHandler(oi.Re,this.$r),this.Dr.registerMessagePayloadHandler(oi.it,this.Zr),this.Yr.ignoreWacFramePostMessages||this.kr(s(i)),this.Rr(i,e),this.Yr.ignoreWacFramePostMessages){var t=this.Gr();this.zr(t)}return this.Zt.ULS.te(595661019,n.B,o.Info,"Created Wac Frame"),this.Ur},i}();!function(){function i(i,e,t,r,s,a,c){var u=this;this.Qr=!1,this.es=!1,this.ts=!1,this.ns=null,this.os=!0,this.ss=!1,this.as=!1,this.cs=function(){u.Zt.ULS.te(596444231,n.B,o.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout(u.us,5e3),u.Dr.registerMessagePayloadHandler(oi.se,u.ds),u.Dr.registerMessagePayloadHandler(oi.Xe,u.ls);var i=new Zi(u.Pr,u.Yr,u.Zt,u.Dr,u.zr,u.Xr);u.Ur=i.Boot()},this.hs=function(){var i={ParallelizeStartSession:u.os,WacFrameIsLoaded:u.Qr,WacAcceptsStartSessionComplete:u.ss};u.Zt.ULS.te(596444232,n.B,o.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(i)),!u.os||u.Qr&&!u.ss?u.Qr&&u.fs():u.ps()},this.vs=function(){u.Zt.ULS.te(596444233,n.B,o.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),u.Pr.wopiInfo=u.ms;var i=new Zi(u.Pr,u.Yr,u.Zt,u.Dr,u.zr,u.Xr);u.Ur=i.Boot()},this.ws=function(i){u.Qr?(u.Zt.ULS.te(595968481,n.B,o.Warning,"Fail called and wacframe is able to accept postmessages"),u.gs(i)):(u.Zt.ULS.te(595968482,n.B,o.Warning,"Fail was called on the session prior to WacReady."),u.ns=i)},this.gs=function(i){u.Zt.ULS.te(596444189,n.B,o.Warning,"Fail called, sending the failure postmessage to IFrame"),u.Jr(Ci.ar,i)},this.Ss=function(){u.Zt.ULS.te(596444190,n.B,o.Warning,"Fail called during single step boot, calling host failure callback..."),u.Xr({errorType:ci.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},this.us=function(){u.Qr||(u.Zt.ULS.te(596444191,n.B,o.Warning,"Timeout Wac Ready"),u.Xr({errorType:ci.TimeoutWacReady,errorObject:void 0}))},this.Is=function(){u.ts||(u.xr.timeoutCompleteOrFail=R(),u.Zt.ULS.te(596444192,n.B,o.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(u.xr)))},this.bs=function(i,e,t){u.as||(u.Zt.ULS.te(596444193,n.B,o.Info,"SessionCompletion timed out with no ack."),u.Ts(i,e,t+1))},this.ds=function(i){if(u.xr.readyMessageReceiveTime=R(),u.Jr(Ci.Fo,{}),u.Qr)u.Zt.ULS.te(596444194,n.B,o.Info,"Received multiple ready messages - frame is already loaded.");else{u.Qr=!0,u.ss=i&&i.CanAcceptStartSessionComplete;var e={AcceptStartSessionComplete:u.ss,ParallelizeStartSession:u.os,StartSessionResponseAvailable:!!u.ys,WopiInfoAvailable:!!u.ms};u.Zt.ULS.te(596444195,n.B,o.Info,"HandleWacReadyMessage - "+JSON.stringify(e)),u.ts&&(u.ns?u.gs(u.ns):u.Jr(Ci.ur,{})),u.os&&u.ss?u.ys&&u.Cs():u.ms&&u.fs(),Ri(u.Or,i)}},this.ls=function(i){u.as=!0,u.xr.sessionCompleteAckReceivedTime=R()},this.Jr=function(i,e){u.Dr.sendPostMessage(u.Ur,i,e)},this.As=function(i,e){u.Ts(i,e,1)},this.Ts=function(i,e,t){if(t>3)u.Zt.ULS.te(596444224,n.B,o.Error,"Attempted to call complete, but received no ack from the frame. Time: ".concat(R()));else{u.Zt.ULS.te(596444225,n.B,o.Info,"Sending completion message to frame. Attempt number: ".concat(t,", Time: ").concat(R()));var r=R();1===t&&(u.ys&&u.ys.Diagnostics&&(u.ys.Diagnostics.completeMessageCreateTime=r),u.xr.completeMessageCreateTime=r),e.Diagnostics.completeMessageSendTime=r,u.xr.completeMessageSendTime=r,u.Jr(i,e),window.setTimeout((function(){return u.bs(i,e,t)}),1e3)}},this.ps=function(){u.Zt.ULS.te(596444226,n.B,o.Info,"Making parallelized startSession request.");var i=u._s(u.ms),e={"Content-Type":"application/x-www-form-urlencoded"},t="access_token="+encodeURIComponent(u.ms.AccessToken)+"&access_token_ttl="+encodeURIComponent(Ji(u.ms));u.xr.startSessionStartTime=R(),xi(i,t,e,u.Fs)},this.Fs=function(i){if(u.xr.startSessionCompleteTime=R(),u.xr.startSessionResponseStatus=i.status,u.ys={StartSessionResponse:{RequestStatus:i.status,ResponseText:i.responseText},Diagnostics:{wopiPendingInitializeTime:u.xr.wopiPendingInitializeTime,wopiPendingCompleteTime:u.xr.wopiPendingCompleteTime,startSessionStartTime:u.xr.startSessionStartTime,startSessionCompleteTime:u.xr.startSessionCompleteTime,readyMessageReceiveTime:u.xr.readyMessageReceiveTime}},u.Zt.ULS.te(596444227,n.B,o.Info,"StartSession request completed with status code: ".concat(u.ys.StartSessionResponse.RequestStatus,", Time: ").concat(R())),u.Qr&&u.ss)u.Cs();else{var e={WacFrameIsLoaded:u.Qr,InitializeCompleted:u.es};u.Zt.ULS.te(596444228,n.B,o.Info,"StartSessionCompleted not called - "+JSON.stringify(e))}},this.fs=function(){var i;if(!u.es){u.es=!0,u.Zt.ULS.te(596444229,n.B,o.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:u.ms.WopiSrc,AccessToken:u.ms.AccessToken,AccessTokenTtl:Ji(u.ms)},Diagnostics:{wopiPendingInitializeTime:u.xr.wopiPendingInitializeTime,wopiPendingCompleteTime:u.xr.wopiPendingCompleteTime,readyMessageReceiveTime:u.xr.readyMessageReceiveTime}};(null===(i=u.ms)||void 0===i?void 0:i.WacToken)&&(e.WopiDetails.WacToken=u.ms.WacToken),u.As(Ci.Po,e)}},this.Cs=function(){200===u.ys.StartSessionResponse.RequestStatus?u.es||(u.es=!0,u.As(Ci.xo,u.ys)):u.fs()},this._s=function(i){var e=u.Pr.applicationBasePath+"wordeditorstartsession.ashx",t=Hi(u.Pr,u.Yr,!1);return e=p(e+="?"+t.substring(t.indexOf("?")+1),"WOPISrc",encodeURIComponent(i.WopiSrc)),e=p(e,"build",encodeURIComponent(T())),e=p(e,"WacUserType",encodeURIComponent("WOPI")),u.Pr.wopiPrecheckInfo.FileGetUrl&&(e=p(e,"fileGetUrlPresent","1")),e},this.Es=function(i){if(u.Pr.isCreateNew){if(!i||!i.NewFilePath)return void u.Zt.ULS.te(596444230,n.B,o.Info,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",i.NewFilePath),i.UpdatedPageTitle&&(document.title=i.UpdatedPageTitle)}},this.Pr=i,this.Yr=e,this.Or=i.diagnostics.AppInitDiagnostics,this.Zt=t,this.Dr=r,this.zr=a,this.Xr=c,this.xr=i.diagnostics.SessionTraces,this.xr.wopiPendingInitializeTime=R(),this.Vs=s,Di(),window.setTimeout(this.Is,5e3)}i.prototype.Complete=function(i,e){if(this.ts)this.Zt.ULS.te(596444184,n.B,o.Warning,"Complete called after Complete/Fail already called");else{this.Zt.ULS.te(596444185,n.B,o.Info,"Complete called."),this.Pr.diagnostics.HostInitDiagnostics&&(this.Pr.diagnostics.HostInitDiagnostics.hostCompleteCallTime=R()),this.ts=!0,this.ms=i,this.xr.wopiPendingCompleteTime=R();try{this.Yr.isSingleStepBoot?this.vs():this.hs(),this.Qr&&this.Jr(Ci.ur,{}),this.Es(e)}catch(i){this.Zt.ULS.te(596444186,n.B,o.Error,"Unexpected script error: ".concat(A(i))),P(this.Pr.remoteTelemetryUrl,"Visio","bootException")}finally{this.Zt.ULS.flush()}}},i.prototype.Fail=function(i){this.ts?this.Zt.ULS.te(596444187,n.B,o.Warning,"Fail called after Complete/Fail already called"):(this.Zt.ULS.te(596444188,n.B,o.Warning,"Fail called. Reason: "+(i?JSON.stringify(i):"N/A")),this.ts=!0,this.Yr.isSingleStepBoot?this.Ss():this.ws(i),this.Zt.ULS.flush())},i.prototype.Dispose=function(i,e,t){var n=this;ki(i||!1,this.Zt,this.Dr,this.Ur,(function(){delete n.Ur,e&&e(),n.Vs(),n.Dr.dispose()}),void 0,t)},i.prototype.Boot=function(){this.Yr.isSingleStepBoot||this.cs(),this.Zt.ULS.flush()}}();var Yi,Qi=function(){function i(e,t,n,o){this.Rs="AES-GCM",this.Os=256,this.xs=12,this.Ps=null,this.Us=i.Ds+e,this.ks=t,this.Ws=n,this.Zt=o,this.loadCache()}return i.Create=function(e,t,n,o){if(i.Ns(e,t,n)){var r=e+"_"+t,s=i.getHashCode(t),a=i.getHashCode(n);i.Bs=new i(s,a,r,o)}return i.Bs},i.dispose=function(){i.Bs=null},i.prototype.SaveDocument=function(i,e){var t=this;try{if(!e||e.length<=0||!i||i.length<=0)return this.Zt.ULS.te(595903506,n.K,o.Warning,"Unexpected data provided to save document in cache. Removing the item."),void localStorage.removeItem(this.Us);var r=R(),s={ImageData:e,DocView:i,DocVersion:this.ks},a=JSON.stringify(s);this.encrypt(a,this.Ws,this.Rs,this.Os,this.xs).then((function(i){try{i.DocVersion=t.ks,i.LastAccessTime=R(),localStorage.setItem(t.Us,JSON.stringify(i));var e=R();t.Zt.ULS.te(595903646,n.K,o.Info,"[VO_Perf] Save Document Cache Time Taken: ".concat(e-r))}catch(i){t.Zt.ULS.te(595910981,n.K,o.Warning,"Failure trying to save data in localStorage: ".concat(A(i)))}}),(function(i){t.Zt.ULS.te(595907478,n.K,o.Warning,"Failure to encrypt: ".concat(A(i)))}))}catch(i){this.Zt.ULS.te(595907479,n.K,o.Warning,"Failure to SaveDocument: ".concat(A(i)))}},i.prototype.DeleteDocument=function(){try{localStorage.removeItem(this.Us)}catch(i){this.Zt.ULS.te(595904288,n.K,o.Warning,"Failure to DeleteDocument: ".concat(A(i)))}},i.prototype.IsCacheAvailable=function(){return null!=this.Ps},i.EvictStaleCache=function(i,e,t){try{if(!window.localStorage)return void t.ULS.te(595903507,n.K,o.Info,"localStorage is not supported by Browser. Skipping Eviction.");for(var r=R(),s=[],a=0;a<localStorage.length;a+=1){var c=localStorage.key(a);if(c.substring(0,this.Ds.length)===this.Ds){var u=localStorage.getItem(c);if(u){var d=JSON.parse(u);if(d){var l=d.LastAccessTime;l?s.push({key:c,lastAccessTime:l,data:u}):localStorage.removeItem(c)}else localStorage.removeItem(c)}else localStorage.removeItem(c)}}s.sort((function(i,e){return e.lastAccessTime-i.lastAccessTime}));var h=[],f=0,p=0;for(a=0;a<s.length;a+=1)(f+=2*s[a].data.length)>i&&R()-s[a].lastAccessTime>e?(localStorage.removeItem(s[a].key),p+=1,f-=2*s[a].data.length):h.push(s[a]);h.sort((function(i,e){return i.lastAccessTime-e.lastAccessTime})),f=0;var v=0;for(a=0;a<h.length;a+=1)(f+=2*h[a].data.length)>i&&(localStorage.removeItem(h[a].key),v+=1,f-=2*h[a].data.length);var m=R();t.ULS.te(595903508,n.K,o.Info,"[VO_Perf] Evict Stale Cache Time Taken: ".concat(m-r,", Ist iteration evicted items: ").concat(p,", 2nd iteration evicted items: ").concat(v))}catch(i){t.ULS.te(595904090,n.K,o.Warning,"Failure to Evict Stale Cache: ".concat(A(i)))}},i.prototype.GetDocVersion=function(){return this.IsCacheAvailable()?this.ks:""},i.prototype.DecryptAndValidate=function(i,e){var t=this;try{var r=R();this.decrypt(this.Ps,this.Ws,this.Rs,this.Os).then((function(s){try{var a;a=JSON.parse(s);var c=R();t.Zt.ULS.te(595903648,n.K,o.Info,"[VO_Perf] Decrypt and validate cache Time Taken: ".concat(c-r)),a.DocVersion===t.ks?i(a.DocView,a.ImageData):(t.Zt.ULS.te(595907480,n.K,o.Warning,"Document version unexpected mismatch."),e())}catch(i){t.Zt.ULS.te(595907481,n.K,o.Warning,"Failure to deserialize the decrypted text: ".concat(A(i))),e()}}),(function(i){t.Zt.ULS.te(595907482,n.K,o.Warning,"Failure to decrypt: ".concat(A(i))),e()}))}catch(i){this.Zt.ULS.te(595907483,n.K,o.Warning,"Failure to DecryptAndValidate: ".concat(A(i))),e()}},i.prototype.loadCache=function(){try{var i=localStorage.getItem(this.Us);if(i){var e;(e=JSON.parse(i)).DocVersion===this.ks&&(this.Ps=e)}}catch(i){this.Zt.ULS.te(595910982,n.K,o.Warning,"Failure trying to load data from localStorage: ".concat(i))}},i.prototype.encode64=function(i){return btoa(new Uint8Array(i).reduce((function(i,e){return i+String.fromCharCode(e)}),""))},i.prototype.decode64=function(i){for(var e=window.atob(i),t=e.length,n=new Uint8Array(new ArrayBuffer(t)),o=0;o<t;o+=1)n[o]=e.charCodeAt(o);return n},i.prototype.genEncryptionKey=function(i,e,t){return H(this,void 0,void 0,(function(){var n,o,r,s;return L(this,(function(a){switch(a.label){case 0:return n={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},o={name:e,length:t},r=(new TextEncoder).encode(i),[4,crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveKey"])];case 1:return s=a.sent(),[2,crypto.subtle.deriveKey(n,s,o,!1,["encrypt","decrypt"])]}}))}))},i.prototype.encrypt=function(i,e,t,n,o){return H(this,void 0,void 0,(function(){var r,s,a,c;return L(this,(function(u){switch(u.label){case 0:return r={name:t,length:n,iv:crypto.getRandomValues(new Uint8Array(o))},[4,this.genEncryptionKey(e,t,n)];case 1:return s=u.sent(),c={},a=this.encode64,[4,crypto.subtle.encrypt(r,s,(new TextEncoder).encode(i))];case 2:return c.DocumentData=a.apply(this,[u.sent()]),c.DocVersion=void 0,c.DataHash=void 0,c.IV=r.iv,c.LastAccessTime=void 0,[2,c]}}))}))},i.prototype.decrypt=function(i,e,t,n){return H(this,void 0,void 0,(function(){var o,r,s,a;return L(this,(function(c){switch(c.label){case 0:for(o={name:t,length:n,iv:new Uint8Array(this.xs)},r=0;r<this.xs;r+=1)o.iv[r]=i.IV[r];return[4,this.genEncryptionKey(e,t,n)];case 1:return s=c.sent(),[4,crypto.subtle.decrypt(o,s,this.decode64(i.DocumentData))];case 2:return a=c.sent(),[2,(new TextDecoder).decode(a)]}}))}))},i.getHashCode=function(i){var e=0,t=i.length,n=0;if(t>0)for(;n<t;)e=(e<<5)-e+i.charCodeAt(n)|0,n+=1;return e},i.cachedDocumentVersionData="cacheDocVersion",i.documentSaveIdleTimeInMs=4e3,i.cacheEvictIdleTimeInMs=8e3,i.maxStorageQuotaSettingName="BrowserCacheMaxQuotaInMB",i.minEvictTimePeriodSettingName="BrowserCacheMinEvictTimePeriodInDays",i.Ds="VisioCachedView_",i.Bs=null,i.Ns=function(e,t,n){if(null!=i.Bs&&e&&n&&t){var o=e+"_"+t,r=i.getHashCode(n);if(i.Bs.Ws===o&&i.Bs.ks===r)return!1}return!!(window.crypto&&crypto.subtle&&window.localStorage)&&"TextEncoder"in window&&!!n&&!!t&&!!e&&n.length>0&&e.length>0&&t.length>0},i}();!function(i){i[i.Fastfood=0]="Fastfood",i[i.MSITandFastfood=1]="MSITandFastfood",i[i.AllRings=2]="AllRings",i[i.None=3]="None"}(Yi||(Yi={}));var ie,ee,te=function(){function i(){}return i.initialize=function(e,t){i.Ms=e,i.Zt=t,void 0===i.Ms&&i.Zt&&i.Zt.ULS.te(592975122,n.K,o.Warning,"Environment is undefined")},i.getIntegerBRSValue=function(e,t){var n=i.Hs[e];return n&&!isNaN(parseInt(n,10))?parseInt(n,10):window.localStorage&&(n=localStorage.getItem(e))&&!isNaN(parseInt(n,10))?(i.Hs[e]=n,parseInt(n,10)):t},i.getBRSValue=function(e,t){void 0===t&&(t=!1);try{var r=i.Hs[e];if(r)return"true"===r.toLowerCase();if(!window.localStorage)return!1;var s=localStorage.getItem(e);if(s)return i.Hs[e]=s,t&&localStorage.removeItem(e),"true"===s.toLowerCase();if(s="false",i.Ls.has(e))switch(i.Ls.get(e)){case Yi.Fastfood:this.Ms===Ve.Fastfood&&(s="true");break;case Yi.MSITandFastfood:this.Ms!==Ve.Fastfood&&this.Ms!==Ve.MSIT||(s="true");break;case Yi.AllRings:s="true";break;default:s="false",i.Zt&&i.Zt.ULS.te(592975123,n.K,o.Warning,e+" set to false due EnabledEnvironment=None")}return i.Hs[e]=s,"true"===s.toLowerCase()}catch(i){return!1}},i.dispose=function(){i.Hs={}},i.fromWacVisioFrameBRS="Visio_BRS",i.instantCreateNewLocalStorageKey="BRS_IsInstantCreateNewEnabled",i.backgroundEditSessionEnabledKey="BRS_IsUnifiedBackgroundEditAppEnabled",i.hostCacheForEmbedViewEnabledBRSKey="BRS_HostCacheForEmbedViewEnabled",i.InstantForAllTemplatesEnabledBRSKey="BRS_InstantForAllTemplatesEnabled",i.AppShellPrebootEnabledBRSKey="BRS_AppShellPrebootEnabled",i.FastViewForMRUFixEnabledBRSKey="BRS_FastViewForMRUFixEnabled",i.ReloadOnScriptFailMaxLimitBRSKey="BRS_ReloadOnScriptFailMaxLimit",i.CoCommentingAcrossViewAndEditEnabled="BRS_CoCommentingAcrossViewAndEditEnabled",i.WOPITokenRefreshIsEnabledForViewer="BRS_WOPITokenRefreshIsEnabledForViewer",i.IsToastUserFixEnabledBRSKey="BRS_IsToastUserFixEnabled",i.IsContextAppRefreshFixEnabledBRSKey="BRS_IsContextAppRefreshFixEnabled",i.IsAtMentionsEnabled="BRS_IsAtMentionsEnabled",i.IsFormulaeSerializationRollbackEnabled="BRS_IsFormulaeSerializationRollbackEnabled",i.IsFastViewCacheInTeamsDisabled="BRS_IsFastViewCacheInTeamsDisabled",i.IsSaveAndCloseRequestInvokedInTeamsEnabled="BRS_IsSaveAndCloseRequestInvokedInTeamsEnabled",i.IsTeamsBackgroundFrameFixEnabled="BRS_IsTeamsBackgroundFrameFixEnabled",i.TypeScriptLocalStorageEnabled="BRS_TypeScriptLocalStorageEnabled",i.JsapiV1DiagnosticFixEnabled="BRS_JsapiV1DiagnosticFixEnabled",i.DTEEnabledBRSKey="BRS_DTEEnabled",i.IsLongPoleInfraEnabled="BRS_IsLongPoleInfraEnabled",i.Fluent2StyleIsEnabled="BRS_Fluent2StyleIsEnabled",i.VisioWebVsdEditEnabled="BRS_VisioWebVsdEditEnabled",i.Ms=void 0,i.Zt=void 0,i.Hs={},i.Ls=new Map([[i.instantCreateNewLocalStorageKey,Yi.AllRings],[i.backgroundEditSessionEnabledKey,Yi.AllRings],[i.InstantForAllTemplatesEnabledBRSKey,Yi.Fastfood],[i.IsToastUserFixEnabledBRSKey,Yi.AllRings],[i.IsContextAppRefreshFixEnabledBRSKey,Yi.Fastfood],[i.IsAtMentionsEnabled,Yi.AllRings],[i.JsapiV1DiagnosticFixEnabled,Yi.AllRings],[i.Fluent2StyleIsEnabled,Yi.Fastfood]]),i.handleVisioBRS=function(e,t){if(window.localStorage&&e){var r=!!e.IsInstantCreateNewEnabled;localStorage.setItem(i.instantCreateNewLocalStorageKey,r.toString());var s=!!e.IsUnifiedBackgroundEditAppEnabled;localStorage.setItem(i.backgroundEditSessionEnabledKey,s.toString());var a=!!e.IsToastUserFixEnabled;localStorage.setItem(i.IsToastUserFixEnabledBRSKey,a.toString());var c=!!e.IsContextAppRefreshFixEnabled;localStorage.setItem(i.IsContextAppRefreshFixEnabledBRSKey,c.toString());var u=!!e.HostCacheForEmbedViewEnabled;localStorage.setItem(i.hostCacheForEmbedViewEnabledBRSKey,u.toString());var d=!!e.InstantForAllTemplatesEnabled;localStorage.setItem(i.InstantForAllTemplatesEnabledBRSKey,d.toString());var l=!!e.AppShellPrebootEnabled;localStorage.setItem(i.AppShellPrebootEnabledBRSKey,l.toString());var h=e.VisioReloadOnScriptFailMaxLimit?e.VisioReloadOnScriptFailMaxLimit:0;localStorage.setItem(i.ReloadOnScriptFailMaxLimitBRSKey,h.toString());var f=!!e.CoCommentingAcrossViewAndEditEnabled;localStorage.setItem(i.CoCommentingAcrossViewAndEditEnabled,f.toString());var p=!!e.DTEEnabled;localStorage.setItem(i.DTEEnabledBRSKey,p.toString());var v=!!e.WOPITokenRefreshIsEnabledForViewer;localStorage.setItem(i.WOPITokenRefreshIsEnabledForViewer,v.toString());var m=!!e.IsAtMentionsEnabled;localStorage.setItem(i.IsAtMentionsEnabled,m.toString());var w=!!e.IsFastViewCacheInTeamsDisabled;localStorage.setItem(i.IsFastViewCacheInTeamsDisabled,w.toString());var g=!!e.IsSaveAndCloseRequestInvokedInTeamsEnabled;localStorage.setItem(i.IsSaveAndCloseRequestInvokedInTeamsEnabled,g.toString());var S=!!e.IsTeamsBackgroundFrameFixEnabled;localStorage.setItem(i.IsTeamsBackgroundFrameFixEnabled,S.toString());var I=!!e.IsFormulaeSerializationRollbackEnabled;localStorage.setItem(i.IsFormulaeSerializationRollbackEnabled,I.toString());var b=!!e.TypeScriptLocalStorageEnabled;localStorage.setItem(i.TypeScriptLocalStorageEnabled,b.toString());var T=!!e.JsapiV1DiagnosticFixEnabled;localStorage.setItem(i.JsapiV1DiagnosticFixEnabled,T.toString());var y=!!e.IsLongPoleInfraEnabled;localStorage.setItem(i.IsLongPoleInfraEnabled,y.toString());var C=!!e.Fluent2StyleIsEnabled;localStorage.setItem(i.Fluent2StyleIsEnabled,C.toString());var A=!!e.VisioWebVsdEditEnabled;localStorage.setItem(i.VisioWebVsdEditEnabled,A.toString()),t.ULS.te(595691654,n.K,o.Info,"Received BRS settings from visio frame and storing it in local storage. BRS values:".concat(e))}else t.ULS.te(595691671,n.K,o.Info,"Received BRS settings from visio frame but local storage is not supported or values are null.")},i}();!function(i){i.BrowserEvent="BrowserEvent",i.PageChanged="PageChanged",i.ZoomChanged="ZoomChanged",i.ContentRefreshBegin="ContentRefreshBegin",i.ContentRefreshEnd="ContentRefreshEnd",i.AppClosed="UI_Close",i.UserEdit="Edit_Notification",i.FileRename="File_Rename",i.FileShare="UI_Sharing",i.ShowFileVersions="UI_FileVersions",i.UIWorkflow="UI_Workflow",i.IsDisabled="IsDisabled",i.AccessibilityLoopComplete="App_AccessibilityLoopComplete",i.Unloaded="Unloaded",i.Disposed="Disposed",i.SwitchMode="App_SwitchMode",i.DocumentReboot="DocReboot",i.WopiInfoFromUrl="WopiInfoFromUrl",i.DavUrlFromIds="DavUrlFromIds",i.ModeSwitched="ModeSwitched",i.CreateNewDocument="App_CreateNewDocument",i.GetAuthToken="GetAuthToken",i.GetCustomAuthConfig="GetCustomAuthConfig",i.SetOverlayContent="SetOverlayContent",i.MoveToFolder="MoveToFolder",i.SharedFilePicker="SharedFilePicker"}(ie||(ie={})),function(i){i.bootWithoutWopiInfo="",i.unifiedSingleFlush="Unified_SingleFlush",i.unifiedIrmEnabled="Unified_IrmEnabled",i.unifiedViewActionUrl="Unified_ViewActionUrl",i.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",i.forceSingleStepBoot="Force_SingleStepBoot",i.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",i.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",i.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(ee||(ee={}));var ne,oe,re,se=function(){function i(){}return i.HeaderHeight=50,i.ToolbarHeightConsumption=40,i.ToolbarLowerHeightEdit=46,i.ToolbarUpperHeightEdit=26,i.StatusbarHeight=50,i.StatusbarBorderTop=1,i.ProgressImageHeight=4,i.FishbowlBorderTop=1,i.FishbowlMarginInches=.4,i.RibbonHeightConsumption=i.HeaderHeight+i.ToolbarHeightConsumption,i.RibbonHeightEdit=i.HeaderHeight+i.ToolbarLowerHeightEdit+i.ToolbarUpperHeightEdit,i.RibbonHeightNoChrome=i.ToolbarLowerHeightEdit+i.ToolbarUpperHeightEdit,i.ShapePanelBorderWidth=1,i.ShapePanelWidthWithoutBorder=312,i.ShapePanelWidthWithBorder=i.ShapePanelWidthWithoutBorder+2*i.ShapePanelBorderWidth,i}(),ae=function(){function i(){}return i.FastViewImage="fpd.png",i.FastViewJson="fv.json",i.docInfoNormal="di2.json",i.docInfoHighDpi="di4.json",i}();!function(i){i[i.INVALID=0]="INVALID",i[i.VIEW=1]="VIEW",i[i.EMBED_VIEW=2]="EMBED_VIEW",i[i.INTERACTIVE_PREVIEW=3]="INTERACTIVE_PREVIEW",i[i.EDIT=4]="EDIT",i[i.EDIT_NEW=5]="EDIT_NEW"}(ne||(ne={})),function(i){i.BOOTSTART="BOOTSTART",i.BACKGROUND_MODESWITCH_BOOTSTART="BACKGROUND_MODESWITCH_BOOTSTART",i.BOOTSUCCESS="BOOTSUCCESS",i.BOOTFAILED="BOOTFAILED",i.BOOTEXCEPTION="BOOTEXCEPTION",i.BOOTTIMEOUT="BOOTTIMEOUT"}(oe||(oe={})),function(i){i.JSAPIV2="JSAPIV2"}(re||(re={}));var ce,ue=function(){function i(e,t,r,s,a,c,d,l,h,f,p,m,w,g){var S=this;this.Js=!1,this.js=!1,this.Gs=!1,this.zs=!1,this.es=!1,this.qs=!1,this.as=!1,this.Ks=!1,this.Xs={},this.Jr=function(i,e){S.Ur&&S.Ur.contentWindow?S.$s.sendPostMessage(S.Ur,i,e):S.Zt.ULS.te(595706831,n.B,o.Warning,"Attempted to send postmessage: "+i)},this.Zs=function(e,t,r){void 0===e&&(e=!1),S.Zt.ULS.te(596464673,n.K,o.Info,"VisioWopiApplication.createInnerFrame()"),S.Ur=document.createElement("iframe"),S.Ur.id=e?i.Ys:Ni,S.Ur.name=Ni,S.Ur.width="100%",S.Ur.height="100%",S.Ur.src="",S.Ur.frameBorder="0",S.Ur.marginWidth="0",S.Ur.marginHeight="0",S.Ur.allowFullscreen=!0,S.Ur.style.left="0",S.Ur.style.top="0",S.Ur.style.right="0",S.Ur.style.bottom="0",S.Qs(e),S.Ur.style.position="absolute",S.Ur.style.backgroundColor="transparent",S.Ur.setAttribute("allowTransparency","true"),S.Ur.setAttribute("loading","eager"),S.Ur.title="Office Online Frame",S.Ur.style.zIndex="1000",S.Ur.style.setProperty("will-change","opacity"),S.Ur.onload=r,S.Or.officeFrameCreateTime=R(),t.insertBefore(S.Ur,t.firstChild)},this.Qs=function(i){z()===J.Safari?S.Ur.style.display=i?"none":"block":S.Ur.style.visibility=i?"hidden":"visible"},this.ia=function(e){if(void 0===e&&(e=!1),S.Ur.onload=function(){},S.Zt.ULS.te(596464674,n.K,o.Info,"VisioWopiApplication.internalBootFromWac() isBackground:".concat(e)),null!=S.Ur.contentWindow){S.ea=S.Ur.contentWindow,S.ta=S.ea.document,S.ta.body.style.margin="0",S.ta.body.style.padding="0",S.ta.body.style.overflow="hidden",S.ta.body.style.msContentZooming="none";var t=S.ta.createElement("meta");t.charset="utf-8",S.ta.head.appendChild(t);var r=S.ta.createElement("meta");r.httpEquiv="x-ua-compatible",S.ta.head.appendChild(r);var s=S.ta.createElement("meta");s.name="viewport",s.content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no",S.ta.head.appendChild(s);var a=S.ta.createElement("form");a.id="office_form",a.name="office_form",a.target=e?"_self":Ni,a.action=S.na,a.method="POST";var c=Mi(S.Pr,S.Zt);for(var u in Ae.isInstantBootMode(S.oa,S.ra)&&(c.hasOwnProperty(Ii.xn)&&delete c[Ii.xn],c.hasOwnProperty(Ii.Pn)&&delete c[Ii.Pn],c.hasOwnProperty(Ii.Un)&&delete c[Ii.Un]),c.hasOwnProperty(Ii.to)&&delete c[Ii.to],c)S.sa(a,u,c[u]);if(te.getBRSValue(te.DTEEnabledBRSKey)&&S.sa(a,i.aa,S.qs.toString()),!S.ca.MetaUiHostVersion){if(S.ca.HighContrastMode&&S.sa(a,"hcm",encodeURIComponent(S.ca.HighContrastMode)),S.ca.SupportsAccessibilityLoop&&S.sa(a,"accloop","1"),S.ca.SupportsDocReboot){var d=S.ca.SupportsDocReboot;S.sa(a,"sdr",!0===d?"1":d.toString())}S.ca.SupportsCreateNewDocument&&S.sa(a,"scnd","1"),S.ca.SupportsAuthToken&&S.sa(a,"sat","1"),S.ca.SupportsCustomAuthConfig&&S.sa(a,"cac","1"),S.ca.SupportsMoveToFolder&&S.sa(a,"mtf","1"),S.ca.SupportsCommonFilePicker&&S.sa(a,"sfp","1"),S.ca.SupportsDirectPrint&&S.sa(a,"sdp","1"),S.ca.SupportsDirectDownload&&S.sa(a,"sdd","1"),S.ca.HideHeader&&S.sa(a,"hhdr","1"),S.ca.MetaUiHostVersion&&S.sa(a,"muv",S.ca.MetaUiHostVersion),S.ca.HideWACOneDriveFileLocationPicker&&S.sa(a,"hodflp","1"),S.ca.OpenLinksInNewWindow&&S.sa(a,"onw","1"),S.ca.UseDarkTheme&&S.sa(a,"udt","1"),te.getBRSValue(te.IsAtMentionsEnabled)&&S.ca.SupportsAtMentions&&S.sa(a,"sams","1")}if(S.ua&&S.oa===ne.VIEW){var l=decodeURIComponent(S.ua);S.sa(a,"nav",l)}S.sa(a,i.da,"true"),S.sa(a,i.la,"true"),S.ha&&S.sa(a,Qi.cachedDocumentVersionData,S.ha.GetDocVersion()),S.sa(a,Ii.Zn,String(window.devicePixelRatio>i.highDpiThreshold)),S.fa&&S.sa(a,i.pa,S.fa.getTime().toString()),S.ta.body.appendChild(a),a.submit()}},this.sa=function(i,e,t){var n=S.ta.createElement("input");n.name=e,n.value=t,n.type="hidden",i.appendChild(n)},this.va=function(){var i;i=S.ca.MetaUiHostVersion?Hi(S.Pr,function(i,e){var t={isSingleStepBoot:i.forceSingleStepBoot,bootFlowType:i.forceSingleStepBoot?ee.forceSingleStepBoot:ee.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(i.forceSingleStepBoot,t.isSingleStepBoot){var r={singleStepBootIsRequired:!0,singleStepBootReason:t.bootFlowType,irmEnabled:i.wopiPrecheckInfo.IrmEnabled,readOnly:i.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:t.ignoreWacFramePostMessages};e.ULS.te(596444182,n.B,r.irmEnabled?o.Warning:o.Info,JSON.stringify(r))}else e.ULS.te(596444183,n.B,o.Info,"Received input valid for two step flow")}(S.Pr,S.Zt)):S.ra;var e={};return e.usid=S.ma,e.sftc="1",e.fileSrc=S.ca.HostName,e.pmOrigin=encodeURIComponent(u(window.location.href)),e.fastPreview=S.zs?"true":"false",Ae.isInstantBootMode(S.oa,S.ra)&&(e.instantedit="1"),S.ca.MetaUiHostVersion||(S.wa.RequestedCallThrottling&&(e.rct=S.wa.RequestedCallThrottling),S.wa.ClientThrottlingProtection&&(e.ctp=S.wa.ClientThrottlingProtection)),"DocGen"!==S.ca.ContentAssemblyMode&&"ContentAssemblyView"!==S.ca.ContentAssemblyMode||(e.readOnly="1"),"DocGen"!==S.ca.ContentAssemblyMode&&"Templatization"!==S.ca.ContentAssemblyMode&&"ContentAssemblyView"!==S.ca.ContentAssemblyMode&&"ContentAssemblyEdit"!==S.ca.ContentAssemblyMode||(e.hhdr="1"),Li(i,S.ca,S.ms,S.ga,e)},this.ds=function(i){S.Jr(Ci.Fo,{}),S.Js||(S.Js=!0,Ri(S.Or,i),Ae.isInstantBootMode(S.oa,S.ra)&&S.ms&&S.fs())},this.fs=function(){if(!S.es){S.es=!0,S.Zt.ULS.te(595706832,n.B,o.Info,"Sending wopi info to the frame.");var i="";te.getBRSValue(te.AppShellPrebootEnabledBRSKey)&&void 0!==S.Sa&&void 0!==S.Sa.TemplateSource&&void 0!==S.Sa.TemplateSource.DocUniqueId&&(i=S.Sa.TemplateSource.DocUniqueId);var e={WopiDetails:{WopiSrc:S.ms.WopiSrc,AccessToken:S.ms.AccessToken,AccessTokenTtl:Ji(S.ms),CreateNewTemplateId:i}};S.ms.WacToken&&(e.WopiDetails.WacToken=S.ms.WacToken),S.As(Ci.Po,e)}},this.As=function(i,e){S.Ts(i,e,1)},this.Ia=function(){if(S.Zt.ULS.te(589611397,n.B,o.Info,"Sending comment context message to frame"),void 0!==S.ba){var i=S.ba;S.Jr(Ci.Qo,i),S.ba=void 0}},this.Ta=function(i){S.ba=i},this.Ts=function(i,e,t){t>3?S.Zt.ULS.te(595706833,n.B,o.Error,"Attempted to call complete, but received no ack from the frame. Time: ".concat(R())):(S.Zt.ULS.te(595706834,n.B,o.Info,"Sending completion message to frame. Attempt number: ".concat(t,", Time: ").concat(R())),S.Jr(i,e),window.setTimeout((function(){return S.bs(i,e,t)}),1e3))},this.bs=function(i,e,t){S.as||(S.Zt.ULS.te(595706835,n.B,o.Info,"SessionCompletion timed out with no ack."),S.Ts(i,e,t+1))},this.ls=function(i){S.as=!0},this.ya=function(i){S.oa===ne.VIEW&&te.getBRSValue(te.CoCommentingAcrossViewAndEditEnabled)&&S.Ia(),S.Gs||(S.Gs=!0,S.Zt.ULS.te(596457678,n.K,o.Info,"Switched to Visio Frame at Time: ".concat(R())),Ri(S.Or,i),S.Or.webAppFrameReinitialized=S.Ks,S.Or&&S.Zt.ULS.te(596464400,n.K,o.Info,"AppInitializeDiagnostics:"+JSON.stringify(S.Or)),S.Zt.ULS.te(596464675,n.K,o.Info,"".concat(JSON.stringify(i))),S.Ca(S.Or,i&&i.Settings?i.Settings:null),S.$s.sendPostMessage(S.Ur,Ci.No,{HostInitializeDiagnostics:S.Pr.diagnostics.HostInitDiagnostics,ClientDiagnostics:S.Pr.diagnostics.ClientDiagnostics}))},this.Nr=function(i){var e;S.Gs=!0,i&&(e=i.Error),void 0===e&&(S.Zt.ULS.te(596453597,n.K,o.Warning,"No error information passed by the WAC Frame"),e={errorType:ci.AppInitError,errorObject:new TypeError("WacFrame")}),S.Aa(e,S.Or)},this._a=function(i){S.js||(S.js=!0,S.Zt.ULS.te(595969242,n.K,o.Info,"Page View loaded on WAC Frame"),Ri(S.Or,i))},this.Fa=function(i){S.raiseEvent(ie.DocumentReboot,i)},this.Ea=function(i){S.raiseEvent(ie.CreateNewDocument,i)},this.Va=function(i){Promise?S.Ra.isResourceTrustedForMessage(i).then((function(e){e?S.raiseEvent(ie.GetAuthToken,i):S.$s.sendPostMessage(S.Ur,Ci.Zo,{AuthToken:"",Error:"accessDenied",RequestId:i.RequestId,IdentityType:i.IdentityType})}),(function(){S.$s.sendPostMessage(S.Ur,Ci.Zo,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:i.RequestId,IdentityType:i.IdentityType})})):S.$s.sendPostMessage(S.Ur,Ci.Zo,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:i.RequestId,IdentityType:i.IdentityType})},this.Oa=function(i){S.raiseEvent(ie.GetCustomAuthConfig,i)},this.xa=function(i){S.raiseEvent(ie.MoveToFolder,i)},this.Pa=function(i){S.raiseEvent(ie.SharedFilePicker,i)},this.Lr=function(i){var e=Fi();S.Zt.ULS.te(595642328,n.K,o.Info,"Top frame is trusted: ".concat(e)),S.$s.sendPostMessage(S.Ur,Ci._e,{isTopFrameTrusted:e})},this.Ua=function(i){var e=Ei(i&&i.overlayContent);S.Zt.ULS.te(587487433,n.B,o.Info,"Overlay content: ".concat(e)),S.$s.sendPostMessage(S.Ur,Ci.cr,void 0)},this.ms=e,this.Pr=t,this.wa=t.wopiPrecheckInfo,this.Da=t.container,this.ca=t.sessionInformation,this.ma=t.sessionId,this.ra=t.applicationUrl,this.ga=t.diagnostics.HostInitDiagnostics,this.Zt=r,this.Ca=s,this.Aa=a,this.ka=c,this.zs=d,this.ha=l,this.$s=f,this.Ra=p,this.oa=m,this.Ks=w,this.qs=g,this.Xs=h,this.Or={officeSessionId:this.ma,officeBootstrapperVersion:T()};var I=v(window.location.href);(this.ua="",te.getBRSValue(te.IsAtMentionsEnabled)&&(this.ua=I.nav),void 0!==this.ga)?(I.teamsvisiomode&&(this.Zt.ULS.te(576074626,n.K,o.Warning,"Resetting user click for Teams reboot scenarios"),this.ga.userClickTime=(new Date).getTime()),this.fa=this.ga.userClickTime?new Date(this.ga.userClickTime):void 0,this.Wa=this.ga.officeInitializationTime?new Date(this.ga.officeInitializationTime):void 0):(this.fa=void 0!==this.ca&&void 0!==this.ca.DocumentClickTime?this.ca.DocumentClickTime:void 0,this.Wa=void 0!==this.ca&&void 0!==this.ca.HostInitTime?this.ca.HostInitTime:void 0);this.fa?this.Zt.ULS.te(596459904,n.K,o.Info,"DocumentClickTime: ".concat(this.fa.getTime())):(this.fa=new Date,this.Zt.ULS.te(595686562,n.K,o.Info,"Fallback DocumentClickTime: ".concat(this.fa.getTime()))),this.Wa&&this.Zt.ULS.te(596459905,n.K,o.Info,"hostInitTime: ".concat(this.Wa.getTime())),this.na=this.va(),w||this.registerPostMessageHandlers(),Di()}return i.prototype.registerPostMessageHandlers=function(){this.$s.registerMessagePayloadHandler(oi.se,this.ds),this.$s.registerMessagePayloadHandler(oi.ue,this.ya),this.$s.registerMessagePayloadHandler(oi.ae,this.Nr),this.$s.registerMessagePayloadHandler(i.Na,this._a),this.$s.registerMessagePayloadHandler(oi.Le,this.Fa),this.$s.registerMessagePayloadHandler(oi.ve,this.Ea),this.$s.registerMessagePayloadHandler(oi.Xe,this.ls),this.$s.registerMessagePayloadHandler(i.Ba,this.ka),te.getBRSValue(te.CoCommentingAcrossViewAndEditEnabled)&&this.$s.registerMessagePayloadHandler(oi.Me,this.Ta),this.ca.SupportsFrameTrustCheck||this.$s.registerMessagePayloadHandler(oi._e,this.Lr),this.$s.registerMessagePayloadHandler(oi.Ee,this.Va),this.$s.registerMessagePayloadHandler(oi.Ve,this.Oa),this.$s.registerMessagePayloadHandler(oi.$e,this.Ua),this.$s.registerMessagePayloadHandler(oi.De,this.xa),this.$s.registerMessagePayloadHandler(oi.qe,this.Pa)},i.prototype.unregisterPostMessageHandlers=function(){this.$s.removeMessageHandler(oi.se),this.$s.removeMessageHandler(oi.ue),this.$s.removeMessageHandler(oi.ae),this.$s.removeMessageHandler(i.Na),this.$s.removeMessageHandler(oi.Xe),this.$s.removeMessageHandler(i.Ba),te.getBRSValue(te.CoCommentingAcrossViewAndEditEnabled)&&this.$s.removeMessageHandler(oi.Me),this.$s.removeMessageHandler(oi._e),this.$s.removeMessageHandler(oi.Ee),this.$s.removeMessageHandler(oi.Ve),this.$s.removeMessageHandler(oi.$e),this.$s.removeMessageHandler(oi.De),this.$s.removeMessageHandler(oi.qe),this.$s.removeMessageHandler(oi.Le),this.$s.removeMessageHandler(oi.ve)},i.prototype.registerEventHandler=function(i,e){switch(i){case ie.Unloaded:case ie.DocumentReboot:case ie.CreateNewDocument:case ie.GetAuthToken:case ie.GetCustomAuthConfig:case ie.MoveToFolder:case ie.SharedFilePicker:case ie.SetOverlayContent:if(this.Xs[i])throw new Error("Duplicate registration for: "+i);this.Xs[i]=e;break;default:this.$s.registerMessagePayloadHandler(i,e)}},i.prototype.removeEventHandler=function(i,e){switch(i){case ie.Unloaded:case ie.DocumentReboot:case ie.CreateNewDocument:case ie.GetAuthToken:case ie.GetCustomAuthConfig:case ie.MoveToFolder:case ie.SharedFilePicker:case ie.SetOverlayContent:if(this.Xs[i]!==e)throw new Error("The handler requested to be removed does not exist for the eventType: "+i);delete this.Xs[i];break;default:this.$s.removeMessageHandler(i)}},i.prototype.showApplicationFrame=function(){this.Ur.style.opacity="1.0"},i.prototype.hideApplicationFrame=function(){this.Ur.style.opacity=i.Ma},i.prototype.Dispose=function(i,e){var t=this;this.Zt.ULS.te(595682585,n.K,o.Info,"VisioWopiApplication.Dispose() Entered"),i||this.Ur&&this.Ur.parentElement&&this.Ur.parentElement.removeChild(this.Ur),i?ki(i||!1,this.Zt,this.$s,this.Ur,(function(){delete t.ta,delete t.ea,delete t.Ur,t.raiseEvent(ie.Unloaded,{})}),void 0,e):(delete this.ta,delete this.ea,delete this.Ur)},i.prototype.raiseEvent=function(i,e){var t=this.Xs[i];t&&t(e||{})},i.prototype.activate=function(){this.Zt.ULS.te(595682586,n.K,o.Info,"VisioWopiApplication.Activate() Entered"),this.Qs(!1)},i.prototype.resetInnerApplicationFrameId=function(){this.Ur.id=Ni},i.prototype.getInnerApplicationFrame=function(){return this.Ur},i.prototype.completeTwoStepFlow=function(i,e){this.Zt.ULS.te(595706829,n.K,o.Info,"VisioWopiApplication.CompleteTwoStepFlow()");try{this.ms=i,void 0!==e&&(this.Sa=e),this.ms&&this.Js&&this.fs()}catch(i){this.Zt.ULS.te(595706830,n.K,o.Error,"VisioWopiApplication.CompleteTwoStepFlow() failed: ".concat(A(i)))}},i.prototype.Boot=function(i){var e=this;void 0===i&&(i=!1),this.Zt.ULS.te(596464402,n.K,o.Info,"VisioWopiApplication.Boot() isBackground:".concat(i)),Ae.validateAppModeForBackgroundBoot(i,this.oa);try{this.Zs(i,this.Da,(function(){try{e.ia(i)}catch(i){e.Aa(i,e.Or)}}))}catch(i){this.Aa(i,this.Or)}},i.prototype.notifyFastPreviewFailed=function(){this.zs?this.zs=!1:this.Zt.ULS.te(596459906,n.K,o.Info,"Fast boot container is not available")},i.prototype.sendCreateNewTemplateId=function(e){void 0!==e&&this.Jr(i.Ha,e)},i.prototype.sendWACDataPostMessage=function(e){this.$s.sendPostMessage(this.Ur,i.La,e),this.Zt.ULS.te(595935318,n.K,o.Info,"Document Data Sent with Post Message.")},i.prototype.sendPostMessageForCommand=function(i,e){this.$s.postMessageForCommand(this.Ur,i,e)},i.prototype.IsPageViewLoaded=function(){return this.js},i.prototype.IsBootComplete=function(){return this.Gs},i.prototype.UpdateLogger=function(i){this.Zt=i},i.Na="Visio_PageViewLoaded",i.La="Visio_DocumentData",i.Ha="TemplateInfo_Ready",i.Ba="Visio_ReadyToReceiveDocData",i.da="bsdpm",i.la="dpmdv",i.pa="dct",i.aa="wde",i.Ys="BkgWebApplicationFrame",i.highDpiThreshold=1.25,i.Ma="0.0000001",i}(),de=function(){function i(){}return i.sendXmlHttpRequest=function(i,e,t,r,s,a,c,u){if(void 0===u&&(u=!1),!i)throw new TypeError("method");if(!e)throw new TypeError("requestUrl");var d=R();if("GET"!==i)throw Error("Not Implemented");var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var i=R()-d;c.ULS.te(595985034,n.K,o.Info,"Success: ".concat(a,", time spent in getting XHR response: ").concat(i,"(ms)")),r&&r(l.responseText)}else c.ULS.te(595985035,n.K,o.Error,"Failed request: ".concat(a," with status code: ").concat(l.status.toString())),s&&s();u&&2===l.readyState&&l.abort()},l.open(i,e,t),l.send()},i}();function le(i){var e=i.toLocaleLowerCase();return e.indexOf("visioview=consumptionview&embed=1")>=0?ne.EMBED_VIEW:e.indexOf("visioview=consumptionview&interactivepreview=1")>=0?ne.INTERACTIVE_PREVIEW:e.indexOf("visioview=consumptionview")>=0?ne.VIEW:e.indexOf("visioview=editview&new=1")>=0?ne.EDIT_NEW:e.indexOf("visioview=editview")>=0?ne.EDIT:ne.INVALID}function he(i){return g(i,"backgroundsession","1")}function fe(i){return i.toLocaleLowerCase().indexOf("embed=1")>=0}function pe(i){i&&history.replaceState({},"",i)}function ve(i,e){return!!(i.sessionInformation&&i.sessionInformation.WdParams&&i.sessionInformation.WdParams[e])}function me(i,e){return i.sessionInformation&&i.sessionInformation.WdParams&&i.sessionInformation.WdParams[e]?i.sessionInformation.WdParams[e]:null}function we(i,e,t){var n=document.createElement("canvas");if(!n.getContext||!n.getContext("2d"))return"";n.width=e,n.height=t;var o=n.getContext("2d");return null==o?"":(o.drawImage(i,0,0),n.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""))}function ge(){return performance.timing?performance.timing.navigationStart:0}function Se(){return performance.navigation?performance.navigation.redirectCount:0}function Ie(){var i=window.location.href;i=m(i,"wdreloadsessionid"),i=m(i,"wdreloadcount"),te.getBRSValue(te.WOPITokenRefreshIsEnabledForViewer)&&i&&(i=m(i,"wdToastUser")),te.getBRSValue(te.DTEEnabledBRSKey)&&i&&(i=m(i,"wdToastForUnsupported"),i=m(i,"wdPreviousSessionDct")),te.getBRSValue(te.VisioWebVsdEditEnabled)&&(i=m(i,"wdvsdedit")),pe(i)}!function(i){i[i.TimerBegin=0]="TimerBegin",i[i.TimerEnd=1]="TimerEnd"}(ce||(ce={}));var be=function(){function i(){}return i.RecordTelemetryData=function(i,e,t,r,s,a){if(te.getBRSValue(te.IsLongPoleInfraEnabled)){var c={FeatureName:i,GUID:e,ComponentName:t,EventCategory:r===ce.TimerBegin?"BeginTimeStamp":"EndTimeStamp",MilliSecondsSinceEpoch:null!=s?s.getTime().toString():"-1",Value:null!=s?s.toUTCString():"-1"};a&&a.ULS.te(523375501,n.K,o.Info,JSON.stringify(c))}},i}();function Te(i,e,t){var n=void 0;((null==i?void 0:i.userClickTime)?n=i.userClickTime:(null==i?void 0:i.hostPageFirstFlushTime)&&(n=i.hostPageFirstFlushTime),(null==i?void 0:i.officeBootstrapperStartTime)&&n)&&(Math.floor((i.officeBootstrapperStartTime-n)/1e3)<60&&(be.RecordTelemetryData("bootPerf","constGuid","hostDuration",ce.TimerBegin,new Date(n),t),be.RecordTelemetryData("bootPerf","constGuid","hostDuration",ce.TimerEnd,new Date(i.officeBootstrapperStartTime),t)));if((null==i?void 0:i.officeBootstrapperStartTime)&&be.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",ce.TimerBegin,new Date(i.officeBootstrapperStartTime),t),null==e?void 0:e.officeFrameCreateTime){var o=new Date(e.officeFrameCreateTime);be.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",ce.TimerBegin,o,t),be.RecordTelemetryData("bootPerf","constGuid","bootStrapperStartToVisioFrameCreateDuration",ce.TimerEnd,o,t)}if(null==e?void 0:e.appCompletedTime){var r=new Date(e.appCompletedTime);be.RecordTelemetryData("bootPerf","constGuid","visioFrameToAppCompleteDuration",ce.TimerEnd,r,t)}if(null==e?void 0:e.documentLoadedTime){var s=new Date(e.documentLoadedTime);be.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",ce.TimerEnd,s,t)}}var ye,Ce,Ae=function(){function i(e,t,r,s,a,c,u,d,l,h){void 0===l&&(l=Ee.Active),void 0===h&&(h=!1);var v,w=this;this.Ja=!1,this.ja=!1,this.Ga=!1,this.za=!1,this.qa=!1,this.Ka=!1,this.Xa=!1,this.$a=!1,this.Za=!1,this.Ya=!1,this.Qa=!1,this.ic=!1,this.ec=!1,this.tc=!1,this.nc=!1,this.qs=!1,this._ImageDataFormat="data:image/png;base64,{0}",this.Xs={},this.oc=function(){return"teams"===w.rc.toLowerCase()},this.ac=function(){w.Dr.registerMessagePayloadHandler(oi.Gt,w.cc),w.Dr.registerMessagePayloadHandler(oi.Bt,w.uc),w.Dr.registerMessagePayloadHandler(oi.Ht,w.dc),w.Dr.registerMessagePayloadHandler(oi.jt,w.lc)},this.hc=function(){w.Dr.removeMessageHandler(oi.Gt),w.Dr.removeMessageHandler(oi.Bt),w.Dr.removeMessageHandler(oi.Ht),w.Dr.removeMessageHandler(oi.jt)},this.fc=function(i){if(!w.pc)throw new TypeError("VisioApplication:disposeWopiApplication() Visio wopi Application is null");w.pc.Dispose(i),i||(w.pc=void 0)},this.vc=function(){Qi.dispose()},this.mc=function(i){w.pc&&w.pc.IsBootComplete()||!w.isActive()||w.Zt.ULS.te(587580759,n.K,o.Warning,"Wopi Boot not completed even after ".concat(i," milliseconds"))},this.wc=function(){return w.oa===ne.EDIT||w.oa===ne.EDIT_NEW},this.Es=function(i){w.oa===ne.EDIT_NEW&&(i&&i.NewFilePath?(pe(i.NewFilePath),i.UpdatedPageTitle&&(document.title=i.UpdatedPageTitle)):w.Zt.ULS.te(595722523,n.B,w.gc?o.Warning:o.Info,"Either NewFileInfo or NewFilePath are not provided for a new file."))},this.uc=function(i){if(-1===w.Pr.applicationUrl.indexOf("embed")){var e="";i&&i.RefreshOrigin&&(e=i.RefreshOrigin);var t=window.location.href;te.getBRSValue(te.IsToastUserFixEnabledBRSKey)&&t&&(t=m(t,"wdToastUser")),te.getBRSValue(te.IsContextAppRefreshFixEnabledBRSKey)&&t&&(t=m(t,"wdActivePageId"),t=m(t,"wdPageScale"),t=m(t,"wdPageCenterX"),t=m(t,"wdPageCenterY")),w.oa===ne.EDIT?t&&(t=p(t,"action","edit",!0),e&&(t=p(t,"OR",e,!0)),pe(t)):w.oa===ne.EDIT_NEW&&t&&(t=p(t,"action","edit",!0),e&&(t=p(t,"OR",e,!0)),pe(t=p(t,"wdNewAndOpenCt","0",!0)))}},this.lc=function(i){var e=window.location.href;"VIEW"===i.toMode||"EDIT"===i.toMode?(e=p(e,"teamsvisiomode",i.toMode,!0),te.getBRSValue(te.IsFormulaeSerializationRollbackEnabled)&&w.oa===ne.EDIT&&"1"===i.wdDisableFormulae&&(e=p(e,"wdDisableFormulae","1",!0)),window.location.href=e):w.Zt.ULS.te(593622414,n.K,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")},this.dc=function(){var i=window.location.href;i=p(i,"wdreloadsessionid",w.Pr.sessionId,!0);var e=w.Pr.sessionId,t=1;ve(w.Pr,"wdreloadcount")&&(t=parseInt(me(w.Pr,"wdreloadcount"),10)+1),t>te.getIntegerBRSValue(te.ReloadOnScriptFailMaxLimitBRSKey,3)?w.Zt.ULS.te(590455010,n.K,o.Error,"Visio Boot failed for WACSessionID: "+e+" after"+t+"retries"):(i=p(i,"wdreloadcount",String(t),!0),w.Zt.ULS.te(590455011,n.K,o.Warning,"Refreshing VisioFrame for WACSessionID: "+e+", currentReloadCount: "+t+", UriLen: "+i.length),w.Zt.ULS.flush(),window.location.href=i)},this.Sc=function(i){w.pc=new ue(w.ms,w.Pr,w.Zt,w.Ic,w.bc,w.Tc,w.Ja,w.ha,w.Xs,w.Dr,w.Ra,w.oa,w.isBackground(),w.qs),w.Zt.ULS.te(596464071,n.K,o.Info,"Boot VisioWopiApplication"),w.pc.Boot(i),w.ja&&w.pc.hideApplicationFrame()},this.yc=function(){w.Zt.ULS.te(596464079,n.K,o.Info,"VisioApplication.ShowFirstPage()"),he(w.Pr.applicationUrl)||be.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",ce.TimerBegin,new Date,w.Zt);try{if(w.Cc(w.Ac),w.Ac.MajorVersion<i.GetMinContentVersion())return void w.Zt.ULS.te(596464080,n.K,o.Warning,"Content bundle version: ".concat(w.Ac.MajorVersion," is out of date"));w.Ya=!0,w._c(w.Pr.container),w.Fc()}catch(i){w.Zt.ULS.te(596464081,n.K,o.Error,"Failed to boot from the host cache: ".concat(A(i)))}},this.Ec=function(e){if(e){w.Zt.ULS.te(596121056,n.K,o.Info,"VisioApplication.TryPrefetchRemainingContent()");try{if(w.Cc(w.Ac),w.Ac.MajorVersion<i.GetMinContentVersion())return void w.Zt.ULS.te(596121057,n.K,o.Warning,"Content bundle version: ".concat(w.Ac.MajorVersion," is out of date"));w.Vc()}catch(i){w.Zt.ULS.te(596121058,n.K,o.Error,"Failed to pre fetch interactive content from host cache: ".concat(A(i)))}}},this.Cc=function(i){if(void 0===i)throw new TypeError("WopiPrecheckInfo.BundleInfo");if(void 0===i.Url)throw new TypeError("WopiPrecheckInfo.BundleInfo.Url");if(void 0===i.MajorVersion)throw new TypeError("WopiPrecheckInfo.BundleInfo.MajorVersion")},this.Rc=function(){return""},this.Oc=function(i){i.setAttribute("crossorigin","anonymous")},this.xc=function(i){var e=w.Pc;e.style.top=i+"px",e.style.position="absolute",e.style.height="auto",e.style.borderWidth=se.ShapePanelBorderWidth+"px",e.style.borderRightStyle="solid",e.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",e.style.borderColor="#e1e1e1",e.style.backgroundColor="#f2f2f2",e.style.width=se.ShapePanelWidthWithoutBorder+"px",e.style.bottom="0px",e.style.overflow="0";var t=document.createElement("div");t.style.top="50%",t.style.left="50%",t.style.position="absolute",t.style.transform="translateX(-50%) translateY(-50%)",t.style.fontSize="9pt",t.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',e.appendChild(t);var n=document.createElement("img");n.style.cssFloat="left",n.style.height="16px",n.style.width="16px",w.Oc(n),void 0!==w.Uc?n.src=w.Uc.getLoadingSpinnerGif():n.style.visibility="hidden",t.appendChild(n);var o=document.createElement("div");return o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText=w.Rc(),t.appendChild(o),e},this._c=function(i){w.Ja||(w.Dc=document.createElement("div"),w.Dc.id="VisioBootContainer",w.Dc.style.width="100%",w.Dc.style.height="100%",w.Dc.style.visibility="hidden",w.Dc.style.position="absolute",w.Dc.style.backgroundColor="#F3F2F1",w.Dc.style.display="block",w.Dc.style.touchAction="none",w.ja=!1,i.appendChild(w.Dc),w.kc=document.createElement("div"),w.kc.style.top=se.RibbonHeightConsumption+"px",w.kc.style.left="0px",w.kc.style.right="0px",w.kc.style.bottom=se.StatusbarHeight+"px",w.kc.style.position="absolute",w.kc.style.borderTopColor="#C6C6C6",w.kc.style.borderTopWidth=se.FishbowlBorderTop+"px",w.kc.style.borderTopStyle="solid",w.kc.style.backgroundColor="#F9F9F9",w.Dc.appendChild(w.kc),w.Wc=document.createElement("div"),w.Wc.id="backgroundPage",w.kc.appendChild(w.Wc),w.Nc=document.createElement("img"),w.Nc.id="foregroundPage",w.Nc.style.visibility="hidden",w.Oc(w.Nc),w.Wc.appendChild(w.Nc),w.Ga||(w.Bc=document.createElement("div"),w.Bc.style.top="0px",w.Bc.style.height=se.HeaderHeight+"px",w.Bc.style.left="0px",w.Bc.style.right="0px",w.Bc.style.position="absolute",te.getBRSValue(te.Fluent2StyleIsEnabled)?w.Bc.style.backgroundColor=w.oc()?"#F3F2F1":"#FFFFFF":w.Bc.style.backgroundColor=w.oc()?"#F3F2F1":"#3955A3",w.Dc.appendChild(w.Bc)),w.Ga&&!w.za||(w.Mc=document.createElement("div"),w.Mc.style.top=(w.za?0:se.HeaderHeight)+"px",w.Mc.style.height="0px",w.Mc.style.left="0px",w.Mc.style.right="0px",w.Mc.style.position="absolute",w.Mc.style.backgroundColor="#E1E1E1",w.Dc.appendChild(w.Mc),w.Hc=document.createElement("div"),w.Hc.style.top=(w.za?0:se.HeaderHeight)+"px",w.Hc.style.height=se.ToolbarHeightConsumption+"px",w.Hc.style.left="0px",w.Hc.style.right="0px",w.Hc.style.position="absolute",w.Hc.style.backgroundColor="#FFFFFF",w.Dc.appendChild(w.Hc)),w.Pc=document.createElement("div"),w.Dc.appendChild(w.Pc),w.Pc.style.height="0px",w.Lc=document.createElement("div"),w.Lc.style.top=se.RibbonHeightConsumption+se.FishbowlBorderTop+"px",w.Lc.style.height=se.ProgressImageHeight+"px",w.Lc.style.left="0px",w.Lc.style.right="0px",w.Lc.style.position="absolute",void 0!==w.Uc&&(w.Lc.style.backgroundImage="url(".concat(w.Uc.getDelayLoadingGif(),")"),w.Lc.style.backgroundRepeat="repeat-x"),w.Ga&&(w.kc.style.top=w.za?se.ToolbarHeightConsumption+"px":"0px",w.Lc.style.top=w.za?se.ToolbarHeightConsumption+"px":"0px"),w.Dc.appendChild(w.Lc),w.Jc=document.createElement("div"),w.Jc.style.bottom="0px",w.Jc.style.height=se.StatusbarHeight+"px",w.Jc.style.left="0px",w.Jc.style.right="0px",w.Jc.style.position="absolute",w.Jc.style.borderTopColor="#C6C6C6",w.Jc.style.borderTopWidth=se.StatusbarBorderTop+"px",w.Jc.style.borderTopStyle="solid",w.Jc.style.backgroundColor="#FFFFFF",w.Dc.appendChild(w.Jc),w.Ja=!0),w.wc()&&w.jc()},this.jc=function(){if(w.wc()){w.Zt.ULS.te(596456520,n.K,o.Info,"Adjusting Boot container for Edit View"),w.Ga&&w.Zt.ULS.te(596129762,n.K,o.Warning,"No chrome mode encountered in Edit App");var i=w.Ga?se.RibbonHeightNoChrome:se.RibbonHeightEdit;w.Ga?w.kc.style.top=se.RibbonHeightNoChrome+"px":(w.kc.style.top=se.RibbonHeightEdit+"px",w.Hc.style.height=se.ToolbarLowerHeightEdit+"px",w.Hc.style.top=se.HeaderHeight+se.ToolbarUpperHeightEdit+"px",w.Mc.style.height=se.ToolbarUpperHeightEdit+"px",w.Mc.style.backgroundColor="#F4F4F4",w.Hc.style.backgroundColor="#F4F4F4"),w.Lc.style.top=i+se.FishbowlBorderTop+"px",w.kc.style.left=se.ShapePanelWidthWithBorder+"px",w.Jc.style.left=se.ShapePanelWidthWithBorder+"px",w.xc(i)}},this.Gc=function(){w.Ja&&(w.Zt.ULS.te(596449229,n.K,o.Info,"Disabling boot container"),w.Ja=!1,w.pc&&w.pc.showApplicationFrame(),w.zc(),w.ec=!0,w.Zt.ULS.te(595935319,n.K,o.Info,"Ready to send doc data empty response."),w.tc&&w.pc&&w.pc.sendWACDataPostMessage(w.qc),w.pc&&w.pc.notifyFastPreviewFailed())},this.zc=function(){w.Dc&&(w.Dc.style.display="none",w.ja=!1)},this.Kc=function(i){if(w.Ja&&(w.Zt.ULS.te(596449230,n.K,o.Info,"Switching to Wopi App"),w.pc&&w.pc.showApplicationFrame(),window.setTimeout(w.zc,0)),i){var e=parseInt(i[Qi.maxStorageQuotaSettingName],10),t=parseInt(i[Qi.minEvictTimePeriodSettingName],10);e>0?w.ha&&(window.setTimeout((function(){return w.ha.SaveDocument(w.Xc,w.$c)}),Qi.documentSaveIdleTimeInMs),window.setTimeout((function(){return Qi.EvictStaleCache(1024*e*1024,24*t*60*60*1e3,w.Zt)}),Qi.cacheEvictIdleTimeInMs)):(w.Zt.ULS.te(595903509,n.K,o.Info,"Evicting all cache as per app settings."),Qi.EvictStaleCache(0,0,w.Zt))}},this.Fc=function(){var i=R(),e=w.Zc(w.Ac.Url,ae.FastViewJson),t=function(i){return w.Yc(i)};if(w.Nc.onload=function(){var e=R()-i;w.Zt.ULS.te(596464084,n.K,o.Info,"Time spent in getting Image response: ".concat(e,"(ms)")),w.Qc()},w.Nc.onerror=function(){w.Zt.ULS.te(596464085,n.K,o.Error,"Failed to download the first page image"),w.Ya=!1,w.Qa=!1,w.Gc()},(!te.getBRSValue(te.IsFastViewCacheInTeamsDisabled)||z()!==J.TeamsElectron)&&w.ha&&w.ha.IsCacheAvailable())return w.Qa=!0,w.iu=function(){return w.ha.DecryptAndValidate((function(i,e){w.$c=e,w.Nc.setAttribute("src",w._ImageDataFormat.replace("{0}",e)),t(i)}),(function(){w.Ya=!1,w.Qa=!1,w.ha.DeleteDocument(),w.Gc()}))},void(w.Za&&(w.eu=!0));de.sendXmlHttpRequest("GET",e,!0,(function(i){t(i),w.Zt.ULS.te(596464082,n.K,o.Info,"Successfully handled doc view response")}),(function(){w.Zt.ULS.te(596464083,n.K,o.Error,"Failed to get doc view response"),w.Ya=!1,w.Gc()}),ae.FastViewJson,w.Zt),w.Nc.src=w.Zc(w.Ac.Url,ae.FastViewImage),w.eu=!0},this.Vc=function(){var i=window.devicePixelRatio>ue.highDpiThreshold?ae.docInfoHighDpi:ae.docInfoNormal,e=w.Zc(w.Ac.Url,i);de.sendXmlHttpRequest("GET",e,!0,(function(i){w.Zt.ULS.te(596121059,n.K,o.Info,"Received doc info json response. Size: ".concat(i.length))}),(function(){w.Zt.ULS.te(596121088,n.K,o.Error,"Failed to get doc info response")}),i,w.Zt,!0)},this.Yc=function(i){try{w.Xc=i,w.tu=JSON.parse(i),null==w.tu.Width&&(w.Zt.ULS.te(596115793,n.K,o.Info,"New format of doc view. Filling the old params."),w.tu.Width=w.tu.Pages[0].PageImage.Width,w.tu.Height=w.tu.Pages[0].PageImage.Height,w.tu.OffsetX=w.tu.Pages[0].PageImage.OffsetX,w.tu.OffsetY=w.tu.Pages[0].PageImage.OffsetY,w.tu.Scale=w.tu.Pages[0].PageImage.Scale)}catch(i){return w.Zt.ULS.te(596464086,n.K,o.Error,"Unable to parse JSON response: ".concat(A(i))),void w.Gc()}w.nu=w.ou(w.tu.PageWidth,w.tu.PageHeight),w.ru(w.tu.PageWidth,w.tu.PageHeight,w.nu),w.su(w.tu.Height,w.tu.OffsetX,w.tu.OffsetY,w.nu)},this.Tc=function(i){return w.Zt.ULS.te(595935320,n.K,o.Info,"WAC is ready to receive Doc Data."),w.tc=!0,!w.ec&&w.eu||w.pc.sendWACDataPostMessage(w.qc),i},this.Qc=function(){w.qa=!0,w.Ka&&w.au()},this.ou=function(i,e){var t=96*se.FishbowlMarginInches,n=96*se.FishbowlMarginInches,o=(w.kc.offsetWidth-t)/(96*i),r=(w.kc.offsetHeight-n)/(96*e);return Math.min(o,r)},this.ru=function(i,e,t){var n=w.kc.offsetWidth-96*i*t,o=w.kc.offsetHeight-96*e*t;w.Wc.style.width=96*i*t+"px",w.Wc.style.height=96*e*t+"px",w.Wc.style.backgroundColor="white",w.Wc.style.borderColor="#C6C6C6",w.Wc.style.borderWidth="1px",w.Wc.style.borderStyle="solid",w.Wc.style.boxShadow="0px 0px 20px #C6C6C6",w.Wc.style.position="absolute",w.Wc.style.top=o/2+"px",w.Wc.style.left=n/2+"px"},this.su=function(i,e,t,n){w.Nc.style.position="absolute",w.Nc.style.left=96*e*n+"px",w.Nc.style.top=w.Wc.clientHeight-96*(i+t)*n+"px",w.Ka=!0,w.qa&&w.au()},this.au=function(){if(w.pc&&w.pc.IsBootComplete())w.Zt.ULS.te(596129763,n.K,o.Warning,"WOPI Boot already completed, not switching to Fast View");else if(w.pc&&w.pc.IsPageViewLoaded())w.Zt.ULS.te(595969243,n.K,o.Warning,"WOPI Page View already loaded, not switching to Fast View");else{if(te.getBRSValue(te.FastViewForMRUFixEnabledBRSKey)&&w.cu!==Ee.Active)return w.Zt.ULS.te(592470212,n.K,o.Info,"MakeFastViewVisible called in inactive VisioApplication, skipping it for now"),void(w.uu=!0);if(w.du=w.Nc.height,w.lu=w.Nc.width,w.Nc.width=96*w.tu.Width*w.nu,w.Nc.height=96*w.tu.Height*w.nu,w.Nc.style.visibility="visible",w.Dc.style.display="block",w.Dc.style.visibility="visible",w.ja=!0,w.pc&&w.pc.hideApplicationFrame(),w.hu=new Date,w.ic=!0,w.Zt.ULS.te(596453598,n.K,o.Info,"Fast View Visible (PLT) Time: ".concat(w.hu.getTime())),w.oa===ne.EDIT&&w.fu){var i=w.hu.getTime()-w.fu;w.Zt.ULS.te(596452765,n.K,o.Info,"Fast View Switch To Edit Visible (PLT) Time: ".concat(i))}window.setTimeout(w.pu,15e3),(!w.$c||w.$c.length<=0)&&(w.$c=we(w.Nc,w.lu,w.du)),w.qc[ae.FastViewImage]=w.$c,w.qc[ae.FastViewJson]=w.Xc,w.ec=!0,w.Zt.ULS.te(595935321,n.K,o.Info,"Doc Data is ready to send with Post Message."),w.tc&&w.pc.sendWACDataPostMessage(w.qc),w.Zt.ULS.te(595907484,n.K,o.Info,"Loaded from browser cache: ".concat(w.Qa))}},this.pu=function(){w.pc&&!w.pc.IsBootComplete()&&(w.Zt.ULS.te(596129792,n.K,o.Warning,"WOPI boot taking too long, time since FastView: ".concat(15e3)),w.Kc(null))},this.Ic=function(i,e){w.Zt.ULS.te(596457106,n.K,o.Info,"Initialization succeeded Time: ".concat(R())),e&&e.VisioEarlyToolbarEnabled&&"true"===e.VisioEarlyToolbarEnabled.toString().toLowerCase()?w.Zt.ULS.te(595654606,n.K,o.Verbose,"Early toolbar enabled, so skipping switching to visioframe here"):w.Kc(e),i.cacheAboutToExpire=!1,w.Ya&&!i.cacheHit&&(i.cacheAboutToExpire=!0),i.cacheHit=w.Ya,i.documentLoadedFromWopiPrecheckInfo=w.ic,w.ic&&(i.documentLoadedTime=w.hu.getTime()),w.vu.stop();var t=w.vu.getVisibilityChangeEvents();if(null!=t&&t.length>0){for(var r=0,s=t;r<s.length;r++){var a=s[r];if("hidden"===(null==a?void 0:a.visibility)){i.documentLoadedWithTabSwitch=!0;break}}w.Zt.ULS.te(596457107,n.K,o.Info,"Visibility Change Events:"+JSON.stringify(t))}w.Pr.pageStateObserver.dispose(),w.Pr.fnOnInitializeSuccess(w,i),w.mu(i),ii("visio",w.Zt),w.Zt.ULS.flush(),P(w.Pr.remoteTelemetryUrl,"Visio","bootSuccess")},this.bc=function(i,e){w.Zt.ULS.te(596464088,n.K,o.Error,"Initialize failed due to error ".concat(JSON.stringify(i))),w.Kc(null),e.cacheHit=w.Ya,e.documentLoadedFromWopiPrecheckInfo=w.ic,w.vu.stop(),w.Pr.pageStateObserver.dispose(),w.Pr.fnOnInitializeFailure({errorType:ci.AppInitError,errorObject:i},e),w.mu(e),w.Zt.ULS.flush(),P(w.Pr.remoteTelemetryUrl,"Visio","bootFailure")},this.Zc=function(i,e){if(!i||-1===i.indexOf("{0}"))throw new TypeError("invalid content URL");if(!e)throw new TypeError("invalid content id");return decodeURI(i).replace("{0}",e)},this.mu=function(i){i&&(he(w.Pr.applicationUrl)||Te(w.Pr.diagnostics.HostInitDiagnostics,i,w.Zt),w.Zt.ULS.te(595981388,n.K,o.Info,JSON.stringify({BootDiagnostics:i,hostDiagnostics:w.Pr.diagnostics.HostInitDiagnostics,navigationStartTime:ge(),isJSAPIV2:"false",localCacheHit:w.Qa?"true":"false",compressedView:w.tu&&w.tu.IsCompressed?"true":"false",backgroundBoot:he(w.Pr.applicationUrl),appMode:w.oa.toString()})))},this.cc=function(i){w.Zt.ULS.te(595654607,n.K,o.Info,"".concat(JSON.stringify(i))),(w.Xa&&w.oa===ne.EDIT||i&&i.Settings&&i.Settings.VisioEarlyToolbarEnabled&&"true"===i.Settings.VisioEarlyToolbarEnabled.toString().toLowerCase())&&w.Kc(i.Settings)},this.wu=new Date,this.Pr=e,this.Uc=s,this.vu=r,this.Zt=t,this.oa=a,this.Dr=u,this.Xs=c,this.cu=l,this.Ra=new li(t),this.rc=f(this.Pr.applicationUrl,"uih"),this.rc&&(this.rc=this.rc.toLowerCase()),this.uu=!1,this.qs=h,this.Zt.ULS.te(596457105,n.K,o.Info,"Created visio application Time: ".concat(this.wu.getTime())),this.qc={},this.eu=!1;var g=-1!==e.applicationUrl.indexOf("wdDisableBCache");e.sessionInformation&&e.sessionInformation.WdParams&&(g=void 0!==e.sessionInformation.WdParams.wdDisableBCache),g||(this.ha=Qi.Create(e.sessionInformation.UserId,null===(v=e.wopiInfo)||void 0===v?void 0:v.WopiSrc,e.wopiPrecheckInfo.ETag,t)),this.gc=i.isInstantBootMode(this.oa,this.Pr.applicationUrl),this.gu=d,this.isBackground()||this.ac()}return i.prototype.unregisterAppLevelPostMessageHandlers=function(){this.nc||(this.pc&&this.pc.unregisterPostMessageHandlers(),this.hc(),this.nc=!0)},i.prototype.registerAppLevelPostMessageHandlers=function(){this.Dr.activate(this.getInnerApplicationFrame()),this.ac(),this.pc&&this.pc.registerPostMessageHandlers()},i.prototype.isBackground=function(){return this.cu===Ee.Background},i.prototype.isActive=function(){return this.cu===Ee.Active},i.prototype.getWopiInfo=function(){return this.Pr.wopiInfo},i.prototype.getNewFileInfo=function(){return this.Sa},i.prototype.GetApplicationType=function(){return"Visio"},i.prototype.GetVersion=function(){return T()},i.prototype.GetSessionId=function(){return this.Pr.sessionId},i.prototype.RegisterEventHandler=function(i,e){this.pc&&this.pc.registerEventHandler(i,e)},i.prototype.RemoveEventHandler=function(i,e){this.pc&&this.pc.removeEventHandler(i,e)},i.prototype.RegisterErrorHandler=function(i){throw void 0!==i&&(this.Su=i),Error("Not Implemented")},i.prototype.RemoveErrorHandler=function(i){throw void 0!==i&&delete this.Su,Error("Not Implemented")},i.prototype.PostCommand=function(i,e){this.pc.sendPostMessageForCommand(i,e)},i.prototype.Dispose=function(i){if(this.Zt.ULS.te(595682625,n.K,o.Info,"VisioApplication.Dispose() Disposing Active Frame appMode:".concat(this.oa,", appState:").concat(this.cu)),this.cu===Ee.Disposed){if(!(te.getBRSValue(te.IsSaveAndCloseRequestInvokedInTeamsEnabled)&&i&&this.gu))throw new TypeError("Trying to Dispose application whose appState is Disposed");return this.Zt.ULS.te(529343379,n.K,o.Info,"Calling appUnloadCallback to dispose active application (Edit Background App) in appMode:".concat(this.oa,", appState:").concat(this.cu)),void this.gu({})}this.cu=Ee.Disposed,this.vc(),this.fc(i),this.Pr.sessionInformation.MetaUiHostVersion&&this.unregisterAppLevelPostMessageHandlers(),this.Zt.ULS.flushOnClose(),delete this.Nc,delete this.Dc},i.prototype.removeFastView=function(){this.Dc&&this.Pr.container&&this.Pr.container.contains(this.Dc)&&this.Pr.container.removeChild(this.Dc)},i.prototype.updateVisibilityMetrics=function(i){i&&(this.vu=i)},i.prototype.activate=function(){if(this.Zt.ULS.te(595682626,n.K,o.Info,"VisioApplication.activate() Activating Background Frame appMode:".concat(this.oa,", appState:").concat(this.cu)),this.cu!==Ee.Background)throw new TypeError("Trying to activate application whose appState is not Background");if(!this.pc)throw new TypeError("VisioApplication:activate() Visio wopi Application is null");this.cu=Ee.Active,this.uu&&(this.uu=!1,this.au()),this.pc.activate()},i.prototype.resetInnerApplicationFrameId=function(){this.pc.resetInnerApplicationFrameId()},i.prototype.getInnerApplicationFrame=function(){return this.pc.getInnerApplicationFrame()},i.prototype.Complete=function(i,e){var t=this;if(this.Zt.ULS.te(596464068,n.K,o.Info,"VisioApplication.Complete() isBackground:".concat(this.isBackground()," appMode:").concat(this.oa)),te.getBRSValue(te.JsapiV1DiagnosticFixEnabled)&&this.Pr.diagnostics.HostInitDiagnostics&&(this.Pr.diagnostics.HostInitDiagnostics.hostCompleteCallTime=R()),this.ms=i,this.Pr.wopiInfo=i,void 0!==e&&(this.Sa=e),this.ms&&this.ms.AccessToken&&this.ms.WopiSrc)if(this.Zt.ULS.te(596464070,n.K,o.Info,"Create VisioWopiApplication"),this.gc)this.pc.completeTwoStepFlow(i,e),this.Es(e);else try{this.Sc(this.isBackground()),this.iu&&(this.Zt.ULS.te(540922266,n.K,o.Info,"Document image/data are present in local cache"),window.setTimeout((function(){t.Zt.ULS.te(540922267,n.K,o.Info,"Loading the fast view from local cache"),t.iu()}))),this.Es(e)}catch(i){this.Zt.ULS.te(596464072,n.K,o.Error,"Failure trying to boot the WOPI application: ".concat(A(i))),this.Pr.fnOnInitializeFailure({errorType:ci.AppInitError,errorObject:i},void 0),P(this.Pr.remoteTelemetryUrl,"Visio","bootException")}else this.Zt.ULS.te(596464069,n.K,o.Error,"VisioApplication Invalid WopiInfo"),this.Pr.fnOnInitializeFailure({errorType:ci.AppInitError,errorObject:new TypeError("wopiInfo")},void 0)},i.prototype.Fail=function(i){this.Zt.ULS.te(596464073,n.K,o.Info,"VisioApplication.Fail() Reason: ".concat(JSON.stringify(i))),this.Zt.ULS.flush()},i.GetMinContentVersion=function(){return 1},i.validateAppModeForBackgroundBoot=function(i,e){if(i&&e!==ne.EDIT)throw new TypeError("Boot() isBackground can not be true in other than Edit Mode")},i.prototype.addTimerTagForBoot=function(i){var e=this;window.setTimeout((function(){return e.mc(i)}),i)},i.prototype.Boot=function(){(this.Zt.ULS.te(596464074,n.K,o.Info,"VisioApplication.Boot()"),this.Zt.ULS.te(596452560,n.K,o.Info,"Visio Application Mode: ".concat(this.oa," , isBackground: ").concat(this.isBackground())),i.validateAppModeForBackgroundBoot(this.isBackground(),this.oa),this.Za=te.getBRSValue(te.hostCacheForEmbedViewEnabledBRSKey,!0),this.oa===ne.VIEW?(this.Zt.ULS.te(596457682,n.K,o.Info,"Enabling fast boot since this is consumption mode"),this.Xa=!0,this.$a=!0):this.oa!==ne.EMBED_VIEW&&this.oa!==ne.INTERACTIVE_PREVIEW||!this.Za?this.oa===ne.EDIT&&-1===this.Pr.applicationUrl.indexOf("embed=1")&&(this.Xa=!0,this.Zt.ULS.te(594838688,n.K,o.Info,"Enabling wrs fast boot in edit mode")):(this.Zt.ULS.te(595198939,n.K,o.Info,"Enabling fast boot with no chrome mode for Embed View."),this.Xa=!0,this.Ga=!0),(this.Xa||this.$a)&&this.oc()&&this.Pr.sessionInformation.HideHeader&&(this.Ga=!0),this.Ga&&this.oc()&&(this.za=!0),this.Pr.sessionInformation&&this.Pr.sessionInformation.WdParams)&&(this.Pr.sessionInformation.WdParams.wdPBIView&&(this.Zt.ULS.te(596464075,n.K,o.Info,"No fast boot since the session is in PBI Mode"),this.Xa=!1,this.$a=!1),this.Pr.sessionInformation.WdParams.wdnc&&(this.Zt.ULS.te(596129760,n.K,o.Info,"Boot in no chrome mode"),this.Ga=!0));if(-1!==this.Pr.applicationUrl.indexOf("wdPBIView")&&(this.Zt.ULS.te(596457683,n.K,o.Info,"No fast boot since the session is in PBI Mode"),this.Xa=!1,this.$a=!1),-1!==this.Pr.applicationUrl.indexOf("wdnc")&&(this.Zt.ULS.te(596129761,n.K,o.Info,"Boot in no chrome mode"),this.Ga=!0),-1!==this.Pr.applicationUrl.indexOf("wdFastView")&&(this.Xa=!0,this.$a=!0),window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(this.Zt.ULS.te(596452935,n.K,o.Info,"Running in High Contrast Mode, disable fast view"),this.Xa=!1,this.$a=!1),this.Xa?this.Pr.wopiPrecheckInfo.BundleInfo?(this.Zt.ULS.te(596464076,n.K,o.Info,"Bundle is cached in host, try rendering the first page"),this.Ac=this.Pr.wopiPrecheckInfo.BundleInfo,this.yc(),this.Ec(!1)):this.Zt.ULS.te(596464077,n.K,o.Info,"Did not find the bundle information"):this.Zt.ULS.te(596464078,n.K,o.Info,"Fast View is disabled via configuration"),this.gc)try{this.Sc(this.isBackground()),this.Zt.ULS.te(595706836,n.K,o.Info,"VisioWopiApplication created in case of instant create-new")}catch(i){this.Zt.ULS.te(595706837,n.K,o.Error,"Failure trying to boot the WOPI application in instant create-new: ".concat(A(i))),this.Pr.fnOnInitializeFailure({errorType:ci.AppInitError,errorObject:i},void 0)}},i.prototype.updateModeSwitchClickTime=function(){this.Pr.diagnostics.AppInitDiagnostics.modeSwitchClickTime=R()},i.prototype.showFasttViewForEditApp=function(){this.oa===ne.EDIT?this.Pr.wopiPrecheckInfo.BundleInfo?(this.Zt.ULS.te(595648647,n.K,o.Info,"showFasttViewForDirectToEdit(): Bundle is cached in host, try rendering the first page"),this.Ac=this.Pr.wopiPrecheckInfo.BundleInfo,this.yc(),this.iu&&this.iu()):this.Zt.ULS.te(595648648,n.K,o.Info,"showFasttViewForDirectToEdit(): Did not find the bundle information"):this.Zt.ULS.te(595648649,n.K,o.Info,"showFasttViewForDirectToEdit() called for non edit app mode")},i.isInstantBootMode=function(i,e){if(!te.getBRSValue(te.instantCreateNewLocalStorageKey)||void 0===e)return!1;var t=e.toLowerCase();return-1===t.indexOf("wopisrc")&&(!(i!==ne.EDIT_NEW||!te.getBRSValue(te.InstantForAllTemplatesEnabledBRSKey)&&-1!==t.indexOf("wdtpl"))||te.getBRSValue(te.AppShellPrebootEnabledBRSKey)&&-1!==t.indexOf("wdasp"))},i.prototype.updateCreateNewTemplateInfo=function(i){void 0!==this.pc&&this.pc.sendCreateNewTemplateId(i)},i}(),_e=function(){function i(i,e){this.Iu=!!e&&function(i){return!!i.includes("wise")}(e),this.bu=u(this.Iu&&e?e:i),this.Tu=this.Iu?"":y()}return i.prototype.getDelayLoadingGif=function(){return this.Iu?"".concat(this.bu,"/wise/owl/delay.gif"):"".concat(this.bu).concat("/v/","s/").concat(this.Tu,"_resources/1033/delay.gif")},i.prototype.getLoadingSpinnerGif=function(){return this.Iu?"".concat(this.bu,"/wise/owl/progress.gif"):"".concat(this.bu).concat("/v/","s/").concat(this.Tu,"_resources/1033/progress16.gif")},i}(),Fe=function(){function i(){var i=this;if(this.yu=[],this.Xs=[],this.Cu=function(){var e={visibility:document.visibilityState,time:R(),initialState:!1};i.yu.push(e);for(var t=0,n=i.Xs;t<n.length;t++){var o=n[t];o&&o(e)}},"hidden"===document.visibilityState){var e={visibility:document.visibilityState,time:R(),initialState:!0};this.yu.push(e)}document.addEventListener("visibilitychange",this.Cu)}return i.prototype.registerEventHandler=function(i){this.Xs.push(i)},i.prototype.removeEventHandler=function(i){if(i){var e=this.Xs.indexOf(i);this.Xs.splice(e,1)}},i.prototype.stop=function(){document.removeEventListener("visibilitychange",this.Cu)},i.prototype.getVisibilityChangeEvents=function(){return this.yu},i.prototype.dispose=function(){this.stop(),this.Xs=[],this.yu=[]},i}();!function(i){i.blurFocus="blurFocus",i.boot="boot",i.completeCreateNew="completeCreateNew",i.continueAccessibilityLoop="continueAccessibilityLoop",i.createNew="createNew",i.dispose="dispose",i.grabFocus="grabFocus",i.moveToFolder="moveToFolder",i.popState="popState",i.sendChannelId="sendChannelId",i.sendConvId="sendConvId",i.teamsUsersReply="teamsUsersReply",i.teamsUserMentionReply="teamsUserMentionReply",i.backButtonPressed="backButtonPressed",i.getClientUrl="getClientUrl",i.getWebUrl="getWebUrl",i.sendOwlFrameDiagnostics="sendOwlFrameDiagnostics",i.rename="rename",i.completeSharedFilePicker="completeSharedFilePicker",i.sendAccessToken="sendAccessToken",i.sendAuthToken="sendAuthToken",i.sendCustomAuthConfig="sendCustomAuthConfig",i.sendEmbeddedViewUrl="sendEmbeddedViewUrl",i.sendFrameTrustResult="sendFrameTrustResult",i.sendHWRTelemetry="sendHWRTelemetry",i.sendSessionInfo="sendSessionInfo",i.sendUserAccessAndPermissions="sendUserAccessAndPermissions",i.sendWopiInfo="sendWopiInfo",i.sendDavUrl="sendDavUrl",i.switchMode="switchMode",i.signalShared="signalShared"}(ye||(ye={}));var Ee,Ve,Re=((Ce={})[ye.blurFocus]=Ci.Vo,Ce[ye.continueAccessibilityLoop]=Ci.Uo,Ce[ye.grabFocus]=Ci.Do,Ce[ye.moveToFolder]=Ci.De,Ce[ye.popState]=Ci.Mo,Ce[ye.rename]=Ci.Xo,Ce[ye.sendAccessToken]=Ci.$o,Ce[ye.sendAuthToken]=Ci.Zo,Ce[ye.sendCustomAuthConfig]=Ci.Yo,Ce[ye.sendEmbeddedViewUrl]=Ci.ir,Ce[ye.sendSessionInfo]=Ci.er,Ce[ye.sendUserAccessAndPermissions]=Ci.tr,Ce[ye.sendWopiInfo]=Ci.nr,Ce[ye.sendDavUrl]=Ci.or,Ce[ye.completeSharedFilePicker]=Ci.qe,Ce[ye.switchMode]=Ci.dr,Ce[ye.signalShared]=Ci.vr,Ce),Oe=function(){function i(i,e){var t,r,c=this;if(this.Au=!1,this.Xs={},this._u="",this.Fu="",this.Eu=!1,this.Cr=!1,this.Vu=!1,this.Ru=!1,this.Ou=[],this.xu=!0,this.Pu=function(i,e,t){if(i){var r={MessageId:Ci._o,CorrelationId:t,SendTime:R()};c.Zt.ULS.te(595732176,n.B,o.Info,"Sending Ack back"),i.postMessage(JSON.stringify(r),e)}else c.Zt.ULS.te(595736136,n.B,o.Info,"Missing target to send Ack back")},this.Uu=function(i){var e,t=!1,r=!0,s="",a=!1;if(c.Ur&&c.Ur.contentWindow&&(t=!0,r=i.source===c.Ur.contentWindow),i.origin&&(a=(s=d(i.origin,2).toLowerCase())===c.Fu),!c.Cr&&(!c.Vu||a&&r)||c.Zt.ULS.te(595730526,n.B,o.Info,"Window is available: ".concat(t,", window is valid: ").concat(r,", origin is valid: ").concat(a,", expected origin: ").concat(c.Fu,", actual origin: ").concat(s)),a&&(!c.Eu||r)){var u;try{u=JSON.parse(i.data)}catch(i){return void c.Zt.ULS.te(596464282,n.B,o.Info,"Failed to parse event data: ".concat(A(i),"."))}var l=u.MessageId;if(l){if(c.Zt.ULS.te(595714715,n.B,o.Info,"Received messageId: ".concat(l,", correlation: ").concat(u.CorrelationId)),l!==oi.ue&&l!==oi.Pe||c.Du(i.origin),c.Ru&&l===oi.zt)return window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},void(window._pageTimings[u.Values.name]=u.Values.time);u.Values&&u.Values.ackExpected&&c.Pu(i.source,i.origin,u.CorrelationId);var h=c.Xs[l];if(!h)return c.Zt.ULS.te(596464289,n.B,o.Info,"No handler found for message id: ".concat(l)),void(c.xu&&l===oi.Ee&&(c.Ou.push(u),c.Zt.ULS.te(543207888,n.B,o.Info,"Kept for later process: ".concat(l))));c.Zt.ULS.te(596464288,n.B,o.Info,"Processing message: ".concat(l));try{h(u.Values||{})}catch(i){c.Zt.ULS.te(593773704,n.B,o.Error,"Handler error: ".concat(A(i)))}c.xu&&l===oi.ue&&c.ku()}else(c.Cr||c.Vu)&&c.Zt.ULS.te(595730520,n.B,o.Info,"Could not find message id")}},this.ku=function(){c.xu=!1,c.Ou.forEach((function(i){var e=i.MessageId,t=c.Xs[e];if(t){c.Zt.ULS.te(543207890,n.B,o.Info,"Processing message after boot complete: ".concat(e));try{t(i.Values||{})}catch(i){c.Zt.ULS.te(543207891,n.B,o.Error,"Handler error: ".concat(A(i)))}}else c.Zt.ULS.te(543207889,n.B,o.Info,"No handler found after boot complete: ".concat(e))})),c.Ou=[]},this.Wu=function(i,e,t){i.postMessage(e,t)},this.Du=function(i){var e=i.toLowerCase();c._u&&c._u!==e&&c.Zt.ULS.te(596128131,n.B,o.Warning,"Updating origin: [".concat(I(c._u),"]->[").concat(I(e),"]")),c._u=e,c.Fu=d(e,2),c.Cr=s(e),c.Vu=a(e)},!i)throw new Error("Missing origin for PostMessageHandler");this.Cr=s(i),this.Vu=a(i),this.Zt=e,this.Du(i),this.Ru=!!(null===(r=null===(t=window.location)||void 0===t?void 0:t.search)||void 0===r?void 0:r.match(/wdpa=1/gi))}return i.prototype.registerMessagePayloadHandler=function(i,e){if(this.Xs[i])throw new Error("Duplicate registration!");this.Xs[i]=e},i.prototype.removeMessageHandler=function(i){delete this.Xs[i]},i.prototype.sendPostMessage=function(i,e,t){if(i&&i.contentWindow){this.Zt.ULS.te(596464334,n.B,o.Info,"Sending message: "+e);var r={MessageId:e,SendTime:R(),Values:t};this.Wu(i.contentWindow,JSON.stringify(r),this._u)}else this.Zt.ULS.te(595948308,n.B,o.Info,"Missing target for SendPostMessage")},i.prototype.activate=function(i,e){this.Ur=i,this.Eu=!!e,this.Au||(window.addEventListener("message",this.Uu,!1),this.Au=!0)},i.prototype.postMessageForCommand=function(i,e,t){var r=Re[e];r?(this.Zt.ULS.te(595702598,n.B,o.Info,"Sending message ".concat(r," for command ").concat(e)),this.sendPostMessage(i,r,t)):this.Zt.ULS.te(595702599,n.B,o.Warning,"No mapping for command ".concat(e))},i.prototype.dispose=function(){this.Xs={},this.Au&&(window.removeEventListener("message",this.Uu,!1),this.Au=!1)},i}(),xe=function(){function i(e,t,r,s,a,c,u){var d=this;if(this.Nu=null,this.Bu=null,this.Mu=null,this.Hu=null,this.Lu=null,this.Xs={},this.Ju=function(){var i,e=d.ju,t=e.applicationUrl;if("consumptionview"!==f(t.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");t=p(t,"VisioView","EditView",!0),t=p(t,"backgroundsession","1",!0),e.applicationUrl=p(t,"wdIsModeSwitch","1",!0);var r=(i=O())[0],s=i[1];e.sessionId=r;var a=B({remoteUlsEndpoint:d.ju.applicationBasePath+"RemoteUls.ashx",sessionId:r,uploadCadenceInMs:We}),c=JSON.parse(JSON.stringify(e.sessionInformation));delete c.OwnerId,delete c.SiteId,delete c.TenantId,delete c.UserId,delete c.Upn,delete c.WebId,a.ULS.te(595682589,n.K,o.Info,"VisioApplicationManager - initializing background Edit session.\n      Init Time: ".concat(R(),",\n      newGuidLogging: ").concat(JSON.stringify(s),",\n      loggableSessionInfo: ").concat(JSON.stringify({hostSessionInformation:c}))),d.Mu=e,d.Hu=a,d.Lu=ne.EDIT},this.Gu=function(i){var e=i===Ee.Background;d.Zt.ULS.te(595682590,n.K,o.Info,"Visio Application Manager appMode: ".concat(d.oa,", isBackground: ").concat(e));var t=d.Zt,r=d.ju;try{var s=d.$s,a=d.oa;e&&(d.Ju(),r=d.Mu,t=d.Hu,a=d.Lu);var c=new Ae(r,t,d.vu,d.Uc,a,d.Xs,s,d.appUnloadHandler,i);return e?d.Bu=c:(d.Nu=c,d.Nu.addTimerTagForBoot(12e4)),c.Boot(),c}catch(i){return d.Zt.ULS.te(595682591,n.K,o.Error,"Background Edit App ".concat(ci.AppInitError,": ").concat(A(i))),t&&t.ULS.flushOnClose(),void r.fnOnInitializeFailure({errorType:ci.AppInitError,errorObject:i})}},this.appUnloadHandler=function(){d.Nu&&d.Nu.isActive()&&d.Nu.Dispose(!0)},this.zu=function(){if(d.qu(Ci.wr),d.Zt.ULS.te(595682592,n.K,o.Info,"ApplicationManager Visio ViewFrame CLTComplete PostMessage Received"),d.oa!==ne.VIEW)throw new TypeError("Active Visio Application mode is not view but received ConsumptionCLTCompletePost Message");var i=d.Nu.getWopiInfo();if(!i)throw new TypeError("ApplicationManager wopiInfo is null");if(d.Zt.ULS.te(595682593,n.K,o.Info,"Building Background Edit VisioApplication"),d.Gu(Ee.Background),!d.Bu)throw new TypeError("After BuildApplication backgroundEditApp is null");d.Bu.Complete(i,d.Nu.getNewFileInfo())},this.Ku=function(){d.Bu?d.Xu():d.Zt.ULS.te(595642373,n.K,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")},this.$u=function(i){if(d.qu(Ci.gr),d.Zt.ULS.te(595682594,n.K,o.Info,"ApplicationManager Received SwitchMode PostMessage from Visio View Frame appMode:".concat(d.oa)),!d.Bu)return d.Zt.ULS.te(595682466,n.K,o.Warning,"handleVisioViewFrameSwitchMode backgroundEditApp is null"),void d.qu(Ci.Ir);d.Hu?d.Bu.updateVisibilityMetrics(new Fe):d.Zt.ULS.te(595616995,n.K,o.Warning,"handleVisioViewFrameSwitchMode bgLogger is null"),d.Nu.unregisterAppLevelPostMessageHandlers(),d.Bu.registerAppLevelPostMessageHandlers(),d.Nu.removeFastView(),d.Bu.updateModeSwitchClickTime(),d.Bu.showFasttViewForEditApp(),d.Bu.resetInnerApplicationFrameId(),d.Bu.addTimerTagForBoot(12e4),d.$s.registerMessagePayloadHandler(oi.Nt,d.Zu),d.Yu(Ci.Sr,i)},this.Yu=function(i,e){d.Qu(i,e,1)},this.Qu=function(i,e,t){if(t>3)switch(d.Zt.ULS.te(595650624,n.B,o.Error,"Attempted to call mode switch, but received no ack from the frame. MessageId: ".concat(i,", Time: ").concat(R())),i){case Ci.Sr:if(!d.ed)return d.Zt.ULS.te(595650625,n.B,o.Error,"Falling back to legacy way of switching for message timeout. Message: ".concat(i)),void d.qu(Ci.Ir);break;default:return void d.Zt.ULS.te(595650626,n.B,o.Warning,"Invalid message. MessageId: ".concat(i))}d.Zt.ULS.te(595650627,n.B,o.Info,"Sending mode switch message to frame. MessageId: ".concat(i,", Attempt number: ").concat(t,", Time: ").concat(R())),d.td(i,e),window.setTimeout((function(){return d.nd(i,e,t)}),1e3)},this.nd=function(i,e,t){switch(i){case Ci.Sr:if(d.ed)return;break;default:return void d.Zt.ULS.te(595650628,n.B,o.Warning,"Invalid message. MessageId: ".concat(i))}d.Zt.ULS.te(595650629,n.B,o.Info,"Timed out with no ack. MessageId: ".concat(i)),d.Qu(i,e,t+1)},this.qu=function(i,e){if(void 0===e&&(e=null),!d.Nu)throw new TypeError("visio Active Application is null");if(!d.Nu.getInnerApplicationFrame())throw new TypeError("visio Active Application Frame is null");d.$s.sendPostMessage(d.Nu.getInnerApplicationFrame(),i,e)},this.td=function(i,e){if(void 0===e&&(e=null),!d.Bu)throw new TypeError("visio Background Edit Application is null");if(!d.Bu.getInnerApplicationFrame())throw new TypeError("visio Background Edit Application Frame is null");d.$s.sendPostMessage(d.Bu.getInnerApplicationFrame(),i,e)},this.od=function(){if(!d.Nu||!d.Bu)throw new TypeError("HandleEditILTCompletePostMessage visioApplicationActive or backgroundEditApp is null");d.Nu.Dispose(),d.Nu=null,d.Bu.activate(),d.Nu=d.Bu,d.Zt=d.Hu,d.oa=d.Lu,d.ju=d.Mu,d.Bu=null,d.Hu=null,d.Lu=null,d.Mu=null},this.Zu=function(i){if(d.Zt.ULS.te(595682624,n.K,o.Info,"ApplicationManager Visio_ACK_ModeSwitch_ToHost Received on ack to Visio_SwitchMode_FromHostFrame"),d.ed=!0,i){if(i.IsSuccess)return void d.od();d.Zt.ULS.te(595645409,n.K,o.Warning,"".concat(JSON.stringify(i)))}d.qu(Ci.Ir)},this.Xu=function(){d.Bu&&(d.Bu.Dispose(),d.Bu=null)},this.ju=e,this.Zt=t,this.vu=r,this.Uc=s,this.oa=a,this.$s=c,this.Xs=u,this.ed=!1,this.rc=f(this.ju.applicationUrl,"uih"),this.rc&&(this.rc=this.rc.toLowerCase()),a!==ne.VIEW)throw new TypeError("VisioApplicationManager appMode is not view");this.$s.registerMessagePayloadHandler(oi.kt,this.zu),this.$s.registerMessagePayloadHandler(oi.Wt,this.$u),this.$s.registerMessagePayloadHandler(i.rd,this.Ku)}return i.prototype.buildApplication=function(){return this.Gu(Ee.Active)},i.prototype.dispose=function(){this.Nu&&(this.Nu.Dispose(),this.Nu=null),this.Xu()},i.rd="Visio_DisposeBkgFrame",i}();!function(i){i[i.Active=0]="Active",i[i.Background=1]="Background",i[i.Disposed=2]="Disposed"}(Ee||(Ee={})),function(i){i[i.Fastfood=0]="Fastfood",i[i.MSIT=1]="MSIT",i[i.Production=2]="Production"}(Ve||(Ve={}));var Pe,Ue,De,ke,We=6e4,Ne=function(){function i(){var i=this;this.Xs={},this.sd=!1,this.ad=function(e,t){!function(i){return!(!ve(i,"wdreloadsessionid")||!ve(i,"wdreloadcount"))}(t)?e.ULS.te(596464066,n.K,o.Info,"VisioBootstrapper - initializing session. Build version: "+i.GetVersion()):e.ULS.te(590357217,n.K,o.Info,"VisioBootstrapper - Initializing reloaded session.  current Reload count: "+me(t,"wdreloadcount")+" Build version: "+i.GetVersion())},this.ud=function(i){i&&i.License&&("plan1"===i.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false"))},this.dd=function(i){return p(p(i,"jsApi","1"),"jsapiver","v1")}}return i.prototype.GetVersion=function(){return T()},i.prototype.GetMinContentVersion=function(){return Ae.GetMinContentVersion()},i.prototype.Prefetch=function(i){},i.prototype.InitializeWopiPending=function(i){var e=this,t=void 0,r=void 0,c=ne.INVALID;try{var d=O(),l=d[0],h=d[1];if(P(Ti(i.ApplicationUrl,l),"Visio","init"),te.getBRSValue(te.AppShellPrebootEnabledBRSKey)&&this.sd)return void 0!==this.ld&&void 0!==i.NewFileTemplateSource&&void 0!==i.NewFileTemplateSource.DocUniqueId&&this.ld.updateCreateNewTemplateInfo(i.NewFileTemplateSource.DocUniqueId),this.sd=!1,this.ld;i.ApplicationUrl.indexOf("wdasp=1")>=0&&(this.sd=!0),function(i){if(void 0===i)throw new TypeError("initParams");var e=i.Container;if(void 0===e||void 0===e.appendChild)throw new TypeError("Container");var t=i.SessionInformation;if(void 0===t||void 0===t.HostName||void 0===t.HostSessionId||void 0===t.UserId)throw new TypeError("SessionInformation");var n=i.ApplicationUrl;if(void 0===n||"string"!=typeof n)throw new TypeError("ApplicationUrl");var o=i.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===i.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===i.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(i);var m=f(window.location.href,"wdreloadsessionid"),w=f(window.location.href,"wdreloadcount");m&&w&&(l=m),t=B({remoteUlsEndpoint:yi(i.ApplicationUrl)+"RemoteUls.ashx",sessionId:l,uploadCadenceInMs:We});var S=s(i.ApplicationUrl)?Ve.Fastfood:a(i.ApplicationUrl)?Ve.MSIT:Ve.Production;te.initialize(S,t);var I=function(i,e,t,n,o,r){void 0===r&&(r=!1),i.SessionInformation.IsCore&&(i.SessionInformation.HideViewerToolbar=!0),function(i,e){var t=i.SessionInformation;t.WdParams||(t.WdParams={});if(t.WdParams.wd)return;e.substring(1).split("&").filter((function(i){if(0===i.indexOf("wd")){var e=i.split("=");e[0].length>2&&(t.WdParams[e[0]]=e[1])}}));var n=i.RebootOverrideData;n&&n.previousSessionId&&(t.WdParams.wdprevioussession=n.previousSessionId)}(i,window.location.search);var s=o||new vi("Visio",t),a=yi(i.ApplicationUrl),c={container:i.Container,sessionInformation:i.SessionInformation,applicationUrl:i.ApplicationUrl,wopiPrecheckInfo:i.WopiPrecheckInfo,applicationCustomSettings:i.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:i.Diagnostics,ClientDiagnostics:ti(),AppInitDiagnostics:{officeSessionId:e,officeBootstrapperVersion:T(),hostName:i.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:i.FnOnInitializeSuccess,fnOnInitializeFailure:i.FnOnInitializeFailure,sessionId:e,applicationBasePath:a,remoteTelemetryUrl:bi(a,e),wopiInfo:i.WopiInfo,forceSingleStepBoot:r,isCreateNew:i.WopiPrecheckInfo.IsNewFile||g(i.ApplicationUrl,"new"),featureManager:n||mi(i.FnIsFeatureEnabled,t),ne:s,newFileTemplateSource:i.NewFileTemplateSource,rebootOverrideData:i.RebootOverrideData,pageStateObserver:new gi(t,!0)};return c.fnOnAppModeSwitched=i.FnOnAppModeSwitched,c}(i,l,t),b=!1;this.hd=te.getBRSValue(te.DTEEnabledBRSKey),te.getBRSValue(te.IsTeamsBackgroundFrameFixEnabled)?this.fd=te.getBRSValue(te.backgroundEditSessionEnabledKey):this.fd=!i.SessionInformation.MetaUiHostVersion&&te.getBRSValue(te.backgroundEditSessionEnabledKey),i.SessionInformation.MetaUiHostVersion&&(this.Xs={}),this.ad(t,I),te.getBRSValue(te.JsapiV1DiagnosticFixEnabled)&&I.diagnostics.HostInitDiagnostics&&(I.diagnostics.HostInitDiagnostics.hostInitializeCallTime=R(),void 0===I.diagnostics.HostInitDiagnostics.hostPageRedirectCount&&(I.diagnostics.HostInitDiagnostics.hostPageRedirectCount=Se())),t.ULS.te(596457679,n.K,o.Info,"Bootstrapper Init Time: ".concat(R())),t.ULS.te(595937312,n.K,o.Info,JSON.stringify(h));var y=Oi(I.applicationUrl,I.sessionInformation);t.ULS.te(596457680,n.K,o.Info,JSON.stringify({hostSessionInformation:y,clientSignals:ti()})),t.ULS.te(596457681,n.K,o.Info,JSON.stringify({hostInitDiagnostics:I.diagnostics.HostInitDiagnostics?I.diagnostics.HostInitDiagnostics:"N/A"}));var C=u(i.ApplicationUrl),_=new Oe(C,t);_.activate(),_.registerMessagePayloadHandler(te.fromWacVisioFrameBRS,(function(i){te.handleVisioBRS(i,t)})),_.registerMessagePayloadHandler(oi.Dt,(function(i){e.ud(i)})),I.applicationUrl.indexOf("VisioView=ConsumptionView&embed=1")>=0?c=ne.EMBED_VIEW:I.applicationUrl.indexOf("VisioView=ConsumptionView&InteractivePreview=1")>=0?c=ne.INTERACTIVE_PREVIEW:I.applicationUrl.indexOf("VisioView=ConsumptionView")>=0?c=ne.VIEW:I.applicationUrl.indexOf("VisioView=EditView&New=1")>=0?c=ne.EDIT_NEW:I.applicationUrl.indexOf("VisioView=EditView")>=0?c=ne.EDIT:(c=ne.INVALID,t.ULS.te(596132872,n.K,o.Error,"Invalid Visio Frame Url")),te.getBRSValue(te.AppShellPrebootEnabledBRSKey)&&I.applicationUrl.indexOf("wdasp=1")>=0&&(c=ne.EDIT_NEW,I.applicationUrl=p(I.applicationUrl,"VisioView","EditView",!0),I.applicationUrl=p(I.applicationUrl,"New","1",!1));var F=v(window.location.href).teamsvisiomode;I.sessionInformation.MetaUiHostVersion&&!F&&I.rebootOverrideData&&I.rebootOverrideData.mode&&(F=I.rebootOverrideData.mode),F&&I.applicationUrl.indexOf("embed=1")<0&&("edit"===F.toLocaleLowerCase()&&c!==ne.EDIT&&(I.applicationUrl=p(I.applicationUrl,"VisioView","EditView",!0),I.applicationUrl=p(I.applicationUrl,"wdIsModeSwitch","1",!0),c=ne.EDIT),"view"===F.toLocaleLowerCase()&&c!==ne.VIEW&&(I.applicationUrl=p(I.applicationUrl,"VisioView","ConsumptionView",!0),c=ne.VIEW));var E=f(I.applicationUrl,"uih"),V=E&&"teams"===E.toLowerCase();if(this.hd){var x=f(window.location.href,"action"),U=!1;if(V){var D=v(window.location.href).teamsvisiomode;U=c===ne.VIEW&&!D}if("default"===x||U){"true"===localStorage.getItem("enableDTE")&&(I.applicationUrl=p(I.applicationUrl,"VisioView","EditView",!0),c=ne.EDIT,b=!0)}}if(V&&(t.ULS.te(545813153,n.K,o.Info,"Show Visio viewer react toolbar in Teams"),I.applicationUrl=p(I.applicationUrl,"enableToolbarInTeams","true")),te.getBRSValue(te.TypeScriptLocalStorageEnabled)){var k=localStorage.getItem("UseTypeScriptJS");k&&(I.applicationUrl=p(I.applicationUrl,"wdVisioTS",k))}I.applicationUrl=this.dd(I.applicationUrl);var W=new Fe;if(void 0!==i.BootstrapperUrl?r=new _e(i.BootstrapperUrl,i.BootstrapperUrl):t.ULS.te(596457563,n.K,o.Warning,"Could not determine visio resources URL"),Ie(),this.fd&&c===ne.VIEW){var N=new xe(I,t,W,r,c,_,this.Xs);return t.ULS.te(595682587,n.K,o.Info,"Building VisioApplication in appMode ".concat(c)),this.ld=N.buildApplication(),this.ld}return t.ULS.te(595682588,n.K,o.Info,"BRS isUnifiedBackgroundAppBRSEnabled: ".concat(this.fd,", appMode: ").concat(c)),void 0!==i.BootstrapperUrl&&this.Preconnect(i.BootstrapperUrl),this.ld=new Ae(I,t,W,r,c,this.Xs,_,void 0,Ee.Active,b),this.ld.addTimerTagForBoot(12e4),this.ld.Boot(),this.ld}catch(e){return t&&(t.ULS.te(596464067,n.K,o.Error,"".concat(ci.AppInitError,": ").concat(A(e))),t.ULS.flushOnClose()),void(i&&(i.ApplicationUrl&&P(Ti(i.ApplicationUrl,void 0),"Visio","bootException"),i.FnOnInitializeFailure&&i.FnOnInitializeFailure({errorType:ci.AppInitError,errorObject:e})))}},i.prototype.Preconnect=function(i){var e=ai();e.shouldPreconnect()&&e.preconnect(i)},i}();!function(i){i.Unknown="UNKNOWN",i.Initialized="INITIALIZED",i.Prebooted="PREBOOTED",i.Booting="BOOTING",i.Booted="BOOTED",i.Failed="FAILED",i.Disposing="DISPOSING",i.Disposed="DISPOSED"}(Pe||(Pe={})),function(i){i.appReboot="appReboot",i.boot="boot",i.closeTab="closeTab",i.createNew="createNew",i.dispose="dispose",i.frameTrust="frameTrust",i.getAuthToken="getAuthToken",i.getHostKeyValue="getHostKeyValue",i.handleBootState="handleBootState",i.rename="rename",i.setOverlayContent="setOverlayContent",i.storeHostKeyValue="storeHostKeyValue",i.switchMode="switchMode",i.updateBootComplete="updateBootComplete"}(Ue||(Ue={})),function(i){i.AccessibilityLoopCompleted="AccessibilityLoopCompleted",i.ActionCompleted="ActionCompleted",i.BrowserEvent="BrowserEvent",i.CAAEMessage="CAAEMessage",i.Close="Close",i.Conversation="Conversation",i.CopyAndEdit="CopyAndEdit",i.CreateNewDocument="CreateNewDocument",i.Download="Download",i.Edit="Edit",i.Error="Error",i.FileEmbed="FileEmbed",i.FileProperties="FileProperties",i.FileRenamed="FileRenamed",i.FileVersions="FileVersions",i.FrameStateChanged="FrameStateChanged",i.FrameTrust="FrameTrust",i.GetAccessToken="GetAccessToken",i.GetAuthToken="GetAuthToken",i.GetCustomAuthConfig="GetCustomAuthConfig",i.GetWopiInfoFromUrl="GetWopiInfoFromUrl",i.GetDavUrlFromIds="GetDavUrlFromIds",i.ModeSwitched="ModeSwitched",i.MoveToFolder="MoveToFolder",i.OpenInMobileApp="OpenInMobileApp",i.OpenInBrowser="OpenInBrowser",i.OpenInClient="OpenInClient",i.PageChanged="PageChanged",i.PushState="PushState",i.Reboot="Reboot",i.RedeemForCommenting="RedeemForCommenting",i.RefreshSessionInfo="RefreshSessionInfo",i.ReplyWithChanges="ReplyWithChanges",i.ReportAbuse="ReportAbuse",i.SharedFilePicker="SharedFilePicker",i.SaveStatus="SaveStatus",i.Share="Share",i.ShareForm="ShareForm",i.SignIn="SignIn",i.DismissSplashScreen="DismissSplashScreen",i.UserAccessAndPermissions="UserAccessAndPermissions",i.UserActivity="UserActivity",i.UserEditActivity="UserEditActivity",i.Workflow="Workflow",i.ZoomChanged="ZoomChanged",i.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",i.LoadingStatus="LoadingStatus",i.SwitchNotebook="SwitchNotebook",i.FailedBootCheckFileInfo="FailedBootCheckFileInfo",i.GetTeamsUsers="GetTeamsUsers",i.SendTeamsUserMention="SendTeamsUserMention",i.NavigateBackToHost="NavigateBackToHost",i.GetClientUrlComplete="GetClientUrlComplete",i.GetWebUrlComplete="GetWebUrlComplete",i.CopyLinkComplete="CopyLinkComplete",i.SendConversationId="SendConversationId",i.CloseTeamsConversation="CloseTeamsConversation",i.PageLoaded="PageLoaded",i.FrameChanged="FrameChanged"}(De||(De={}));var Be=((ke={})[ye.boot]={pd:Ue.boot},ke[ye.createNew]={pd:Ue.createNew},ke[ye.dispose]={pd:Ue.dispose},ke[ye.rename]={pd:Ue.rename},ke[ye.switchMode]={pd:Ue.switchMode},ke[oi.ce]={pd:Ue.handleBootState},ke[oi.he]={pd:Ue.closeTab},ke[oi._e]={pd:Ue.frameTrust},ke[oi.Ee]={pd:Ue.getAuthToken},ke[oi.Re]={pd:Ue.getHostKeyValue},ke[oi.Le]={pd:Ue.appReboot},ke[oi.$e]={pd:Ue.setOverlayContent},ke[oi.it]={pd:Ue.storeHostKeyValue},ke[oi.ot]={pd:Ue.updateBootComplete},ke[ye.blurFocus]={vd:Ci.Vo},ke[ye.continueAccessibilityLoop]={vd:Ci.Uo},ke[ye.grabFocus]={vd:Ci.Do},ke[ye.moveToFolder]={vd:Ci.De},ke[ye.popState]={vd:Ci.Mo},ke[ye.sendChannelId]={vd:Ci.Ho},ke[ye.sendConvId]={vd:Ci.Lo},ke[ye.teamsUsersReply]={vd:Ci.Jo},ke[ye.teamsUserMentionReply]={vd:Ci.jo},ke[ye.backButtonPressed]={vd:Ci.Go},ke[ye.getClientUrl]={vd:Ci.zo},ke[ye.getWebUrl]={vd:Ci.qo},ke[ye.sendAccessToken]={vd:Ci.$o},ke[ye.sendAuthToken]={vd:Ci.Zo},ke[ye.sendHWRTelemetry]={vd:Ci.mr},ke[ye.sendCustomAuthConfig]={vd:Ci.Yo},ke[ye.sendDavUrl]={vd:Ci.or},ke[ye.sendEmbeddedViewUrl]={vd:Ci.ir},ke[ye.sendFrameTrustResult]={vd:Ci._e},ke[ye.sendSessionInfo]={vd:Ci.er},ke[ye.sendUserAccessAndPermissions]={vd:Ci.tr},ke[ye.sendWopiInfo]={vd:Ci.nr},ke[ye.signalShared]={vd:Ci.vr},ke[ye.sendOwlFrameDiagnostics]={vd:Ci.Ko},ke[ye.completeSharedFilePicker]={vd:Ci.qe},ke[oi.oe]={md:De.AccessibilityLoopCompleted},ke[oi.re]={md:De.ActionCompleted},ke[oi.de]={md:De.BrowserEvent},ke[oi.ht]={md:De.CAAEMessage},ke[oi.le]={md:De.Close},ke[oi.fe]={md:De.Conversation},ke[oi.pe]={md:De.CopyAndEdit},ke[oi.ve]={md:De.CreateNewDocument},ke[oi.we]={md:De.Download},ke[oi.ge]={md:De.Edit},ke[oi.Se]={md:De.Error},ke[oi.Ie]={md:De.FileEmbed},ke[oi.be]={md:De.FileProperties},ke[oi.Te]={md:De.FileRenamed},ke[oi.Ce]={md:De.FileVersions},ke[oi.Fe]={md:De.GetAccessToken},ke[oi.xe]={md:De.GetDavUrlFromIds},ke[oi.Ve]={md:De.GetCustomAuthConfig},ke[oi.Oe]={md:De.GetWopiInfoFromUrl},ke[oi.Ae]={md:De.FrameStateChanged},ke[oi.Ue]={md:De.ModeSwitched},ke[oi.De]={md:De.MoveToFolder},ke[oi.ke]={md:De.OpenInMobileApp},ke[oi.We]={md:De.OpenInBrowser},ke[oi.Ne]={md:De.OpenInClient},ke[oi.Be]={md:De.PageChanged},ke[oi.He]={md:De.PushState},ke[oi.Je]={md:De.RedeemForCommenting},ke[oi.je]={md:De.RefreshSessionInfo},ke[oi.Ge]={md:De.ReplyWithChanges},ke[oi.qe]={md:De.SharedFilePicker},ke[oi.ze]={md:De.ReportAbuse},ke[oi.Ke]={md:De.SaveStatus},ke[oi.Ze]={md:De.Share},ke[oi.Ye]={md:De.ShareForm},ke[oi.Qe]={md:De.SignIn},ke[oi.st]={md:De.UserAccessAndPermissions},ke[oi.ct]={md:De.UserActivity},ke[oi.ut]={md:De.UserEditActivity},ke[oi.dt]={md:De.Workflow},ke[oi.lt]={md:De.ZoomChanged},ke[oi.Tt]={md:De.AcquireOAuthTokenTeams},ke[oi.Pe]={md:De.LoadingStatus},ke[oi.yt]={md:De.SwitchNotebook},ke[oi.Ct]={md:De.FailedBootCheckFileInfo},ke[oi.At]={md:De.GetTeamsUsers},ke[oi._t]={md:De.SendTeamsUserMention},ke[oi.Ft]={md:De.NavigateBackToHost},ke[oi.Et]={md:De.GetClientUrlComplete},ke[oi.Vt]={md:De.GetWebUrlComplete},ke[oi.Rt]={md:De.CopyLinkComplete},ke[oi.Ot]={md:De.SendConversationId},ke[oi.xt]={md:De.CloseTeamsConversation},ke[oi.Pt]={md:De.PageLoaded},ke),Me=function(){function i(i,e,t,r,s,a,c){var u,d=this;this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.pendingReboot=!1,this.skipWopiValidation=!1,this.appContext={},this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.gd={},this.onMessage=function(i){var e=i.MessageId,t=i.Values||{},r=d.gd[e];if(r&&r.length>0)d.Sd(e,t);else{var s=Be[e];if(s){var a=s.pd,c=s.md;a?(d.logger.ULS.te(574654543,n.B,o.Info,"Running flow: ".concat(a)),d.Id[a](e,t,d,d.bd[a]).catch((function(i){d.Td(a,i)}))):c&&d.raiseEvent(c,t)}}},this.Td=function(i,e){d.logger.ULS.te(596459925,n.B,o.Error,"".concat(i," flow error: ").concat(A(e))),d.remoteTelemetryUrl&&P(d.remoteTelemetryUrl,d.appInfo.name,"flowException")},this.Sd=function(i,e){d.logger.ULS.te(574654544,n.B,o.Info,"Dispatching action: ".concat(i));for(var t=d.gd[i].slice().reverse(),r=t.length-1;r>-1;r-=1)try{t[r](i,e)}catch(e){d.logger.ULS.te(596444186,n.B,o.Error,"".concat(i," action handler error: ").concat(A(e)))}return Promise.resolve({completion:"success"})},this.state=Pe.Unknown;var l=O(),h=l[0],f=l[1];this.logger=B(),this.logger.ULS.te(593506837,n.B,o.Info,JSON.stringify(f)),this.sessionId=h,this.hostSessionId=t.hostSessionId,this.host=i.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=i.user,this.bootstrapperUrl=i.bootstrapperUrl,this.ui=i.ui||{},this.viewMode=i.viewMode,this.application=r,this.appInfo=e,this.session=s,this.featureManager=mi(i.host.capabilities&&i.host.capabilities.isFeatureEnabledCallback,this.logger),this.ne=new vi(e.name,this.logger),this.preloader=e.preloader,u=a(this.featureManager),this.Id=u[0],this.bd=u[1],this.yd=c,this.ne.addSettingsChangeListener(this.logger.settingsChangeHandler),this.clientDiagnostics=ti(),this.pageStateObserver=new gi(this.logger,!0),this.authTokenTrustValidator=new li(this.logger)}return Object.defineProperty(i.prototype,"diagnostics",{get:function(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}},enumerable:!1,configurable:!0}),i.prototype.raiseEvent=function(i,e){this.logger.ULS.te(574654541,n.B,o.Info,"Raising event: ".concat(i));try{this.yd(i,e)}catch(i){this.logger.ULS.te(593506838,n.B,o.Error,"Event handler error: ".concat(A(i)))}},i.prototype.addActionHandler=function(i,e){this.gd[i]||(this.gd[i]=[]),this.gd[i].push(e)},i.prototype.removeActionHandler=function(i,e){var t=this.gd[i];if(t&&t.length>0){var n=t.indexOf(e);n>-1&&t.splice(n,1)}},i.prototype.run=function(i,e,t){var r=this;if(this.state===Pe.Disposed&&this.backgroundSession)return this.logger.ULS.te(525203609,n.B,o.Info,"Redirecting to background session: ".concat(i)),this.backgroundSession.run(i,e,t);var s=[],a=this.gd[i];if(a&&a.length>0)s.push(this.Sd(i,e));else{var c=Be[i];if(c){var u=c.pd,d=c.vd;if(u){this.logger.ULS.te(574654542,n.B,o.Info,"Running flow: ".concat(u));var l=this.Id[u](i,e,this,this.bd[u],t).catch((function(i){return r.Td(u,i),{completion:"failure",error:i}}));s.push(l)}else d&&(this.container&&this.container.postMessage(d,e),s.push(Promise.resolve({completion:"success"})))}else s.push(Promise.resolve({completion:"failure"})),this.logger.ULS.te(593500189,n.B,o.Warning,"Unhandled command: ".concat(i))}return Promise.race(s)},i.prototype.dispose=function(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.ne.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.gd={},!this.pendingReboot){var i=this.application.sessions,e=i.indexOf(this.session);e>-1&&i.splice(e,1)}},i}();var He=function(){function i(i,e,t,n,o,r){var s=this;!function(i){if(!i)throw new TypeError("SessionInitParams");if(!i.hostSessionId)throw new TypeError("HostSessionId")}(t);this.Cd=new Me(i,e,t,n,this,r,(function(i,e){return o({type:i,data:e,session:s})})),this.Cd.state=Pe.Initialized}return Object.defineProperty(i.prototype,"id",{get:function(){return this.Cd.sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"diagnostics",{get:function(){return this.Cd.diagnostics},enumerable:!1,configurable:!0}),i.prototype.run=function(i,e,t){return this.Cd.run(i,e,t)},i.prototype.boot=function(i,e){return this.Cd.run(ye.boot,i,e)},i.prototype.dispose=function(i){return this.Cd.run(ye.dispose,void 0,i)},i}(),Le=function(){function i(i,e,t){var r,s,a=this;this._u="",this.Fu="",this.Cr=!1,this.Vu=!1,this.Eu=!1,this.Ru=!1,this.Ad=function(i){var e,t=!1,r=!0,s="",c=!1;if(a._d&&a._d.contentWindow&&(t=!0,r=i.source===a._d.contentWindow),i.origin&&(c=(s=d(i.origin,2).toLowerCase())===a.Fu),!a.Cr&&(!a.Vu||c&&r)||a.Zt.ULS.te(593232850,n.B,o.Info,"Window: available["+t+"] valid["+r+"]; Origin: valid["+c+"] expected["+a.Fu+"] actual["+s+"]"),c&&(!a.Eu||r)){var u;try{u=JSON.parse(i.data)}catch(i){return void a.Zt.ULS.te(593232851,n.B,o.Info,"Failed to parse event data: ".concat(A(i)))}var l=u.MessageId;if(l){if(a.Zt.ULS.te(593232854,n.B,o.Info,"Received message: ".concat(l,", correlation: ").concat(u.CorrelationId)),l!==oi.ue&&l!==oi.Pe||a.setTargetOrigin(i.origin),u.Values&&u.Values.ackExpected&&a.postMessage(Ci._o,void 0,u.CorrelationId),a.Ru&&l===oi.zt)return window._pageTimings=null!==(e=window._pageTimings)&&void 0!==e?e:{},void(window._pageTimings[u.Values.name]=u.Values.time);if(a.Fd)try{a.Fd(u)}catch(i){a.Zt.ULS.te(594556386,n.B,o.Error,"Message handler error: ".concat(A(i)))}else a.Zt.ULS.te(591933923,n.B,o.Error,"No message handler")}else(a.Cr||a.Vu)&&a.Zt.ULS.te(593232853,n.B,o.Info,"Missing message id")}},this.Zt=e,this.setTargetOrigin(i),t&&this.setMessageHandler(t),this.Ru=!!(null===(s=null===(r=window.location)||void 0===r?void 0:r.search)||void 0===s?void 0:s.match(/wdpa=1/gi)),window.addEventListener("message",this.Ad,!1)}return i.prototype.setTargetOrigin=function(i){var e=u(i).toLowerCase();this._u&&this._u!==e&&this.Zt.ULS.te(593232847,n.B,o.Warning,"Updating origin: [".concat(I(this._u),"]->[").concat(I(e),"]")),this._u=e,this.Fu=d(e,2),this.Cr=s(e),this.Vu=a(e)},i.prototype.setTargetFrame=function(i,e){this._d=i,this.Eu=!!e},i.prototype.setMessageHandler=function(i){this.Fd=i},i.prototype.removeMessageHandler=function(){this.Fd=void 0},i.prototype.postMessage=function(i,e,t){if(this._d&&this._d.contentWindow){this.Zt.ULS.te(593232849,n.B,o.Info,"Sending message: "+i);var r={MessageId:i,SendTime:R(),CorrelationId:t,Values:e};this._d.contentWindow.postMessage(JSON.stringify(r),this._u)}else this.Zt.ULS.te(593232848,n.B,o.Error,"Missing target to send message: "+i)},i.prototype.dispose=function(){window.removeEventListener("message",this.Ad,!1),this.Fd=void 0},i}(),Je=function(){function i(i,e){!function(i){if(!i||!i.appendChild)throw TypeError("Container")}(i),this.Ed=i,this.Vd=e,this.Rd=e+"_Form",this.Od=Fi()}return Object.defineProperty(i.prototype,"element",{get:function(){return this.Ed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameId",{get:function(){return this.Vd},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"formId",{get:function(){return this.Rd},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isTopFrameTrusted",{get:function(){return this.Od},enumerable:!1,configurable:!0}),i.prototype.boot=function(i,e,t,r){var s=this;this.Zt=t,this.$s=new Le(i,t,this.Fd);var a=r.useAdditionalDiv,c=r.permissionsPolicy;this.xd&&!a?(this.xd.setAttribute("allow",c),this.Zt.ULS.te(588793045,n.B,o.Info,"Wac frame reused")):(this.xd=function(i,e,t,n,o,r,s,a){i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.height="100%",i.style.width="100%";var c=i.ownerDocument,u=c.createElement("iframe");if(u.id=e,u.name=e,u.src="",u.title="Office on the web Frame",u.marginWidth="0",u.marginHeight="0",u.style.top="0",u.style.bottom="0",u.style.left="0",u.style.right="0",u.style.height="100%",u.style.width="100%",u.style.display="block",u.style.position="absolute",u.style.backgroundColor="transparent",u.style.border="none",u.frameBorder="0",u.setAttribute("allowfullscreen","true"),u.setAttribute("allowTransparency","true"),u.setAttribute("allow",t),Ai(u,s),n&&(i.style.minHeight=n,u.style.minHeight=n),o&&(i.style.minWidth=o,u.style.minWidth=o),a&&u.setAttribute("role","none"),r){var d=c.createElement("div");d.style.top="0",d.style.bottom="0",d.style.left="0",d.style.right="0",d.style.height="100%",d.style.width="100%",d.style.backgroundColor="#393a3d",d.style.backfaceVisibility="hidden",n&&(d.style.minHeight=n),o&&(d.style.minWidth=o),d.appendChild(u),i.appendChild(d)}else i.appendChild(u);return u}(this.Ed,this.Vd,c,r.minHeight,r.minWidth,a,r.isInvisible,r.setNoneRole),this.Zt.ULS.te(588793046,n.B,o.Info,"Wac frame created")),this.$s.setTargetFrame(this.xd,r.enforceSameWindow),a&&(this.Pd=this.xd.parentElement),r.useFrameFixForTeams&&t.ULS.te(509143245,n.B,o.Info,"Frame fix enabled for teams uiHost"),_i(this.xd,e,r.useFrameFixForTeams),this.Ud=function(i,e,t,n,o){var r=i.ownerDocument,s=r.createElement("form");for(var a in s.id=t,s.name=t,s.action=n,s.target=e,s.method="POST",o){var c=r.createElement("input");c.type="hidden",c.name=a,c.value=o[a],s.appendChild(c)}return i.appendChild(s),s}(this.Ed,this.Vd,this.Rd,i,e);try{this.Ud.submit()}catch(i){this.Zt.ULS.te(507909977,n.B,o.Warning,"WAC frame failed to submit, will retry. Error: ".concat(A(i))),new Promise((function(i){window.setTimeout(i,10)})).then((function(){s.Ud.submit()})).catch((function(i){throw s.Zt.ULS.te(507909976,n.B,o.Error,"WAC frame failed to submit on retry. Error: ".concat(A(i))),i}))}},i.prototype.setVisibility=function(i){this.xd&&Ai(this.xd,i)},i.prototype.setMessageHandler=function(i){this.Fd=i,this.$s&&this.$s.setMessageHandler(i)},i.prototype.setWrapperPostMessage=function(i){this.Dd=i},i.prototype.removeMessageHandler=function(){this.Fd=void 0,this.$s&&this.$s.removeMessageHandler()},i.prototype.postMessage=function(i,e){this.Dd?this.Dd(i,e):this.$s&&this.$s.postMessage(i,e)},i.prototype.dispose=function(i,e){var t=this;return new Promise((function(n){if(t.Ud&&(t.Ed.removeChild(t.Ud),t.Ud=void 0),t.$s&&(t.$s.dispose(),t.$s=void 0,t.Fd=void 0),t.Dd&&(t.Dd=void 0),t.Zt=void 0,!t.xd||!t.Pd&&i)n();else{var o=function(){t.Pd?(t.Pd.removeChild(t.xd),t.Ed.removeChild(t.Pd)):t.Ed.removeChild(t.xd),t.xd=void 0,t.Pd=void 0,n()};e?o():(t.xd.src="about:blank",window.setTimeout(o,0))}}))},i}();var je=function(){function i(i,e,t){var n,o=this;this.sessions=[],this.containers=[],this.kd=function(i){o.Wd.dispatch(i)},function(i){if(!i)throw new TypeError("ApplicationInitParams");var e=i.host;if(!e||!e.storageHostName)throw new TypeError("HostInfo");var t=i.user;if(!t||null==t.id)throw new TypeError("UserInfo")}(i),this.Nd=i,this.Bd=e,this.Md=t,this.Wd=new pi,(n=i.host.owlVersion)&&(b.BUILD_NUMBER=n),"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}})}return Object.defineProperty(i.prototype,"name",{get:function(){return this.Bd.name},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return T()},enumerable:!1,configurable:!0}),i.prototype.addEventListener=function(i){this.Wd.add(i)},i.prototype.removeEventListener=function(i){this.Wd.remove(i)},i.prototype.createContainer=function(i){var e="WacFrame_".concat(this.Bd.name,"_").concat(this.containers.length),t=new Je(i,e);return this.containers.push(t),t},i.prototype.createSession=function(i){var e=new He(this.Nd,this.Bd,i,this,this.kd,this.Md);return this.sessions.push(e),e},i.prototype.dispose=function(i){var e=this,t=this.sessions.map((function(e){return e.dispose(i).catch((function(i){}))}));return Promise.all(t).then((function(i){return e.Wd.removeAll(),e.sessions=[],e.containers=[],{completion:"success"}}))},i}(),Ge=function(i,e,t,r,s){return i!==oi.Le?Promise.reject("Wrong flow"):new Promise((function(i){t.pendingReboot=!0;var r=void 0;if(e.queryOverrides)try{r=JSON.parse(e.queryOverrides)}catch(i){t.logger.ULS.te(592217694,n.B,o.Error,"Failed to parse queryOverrides: ".concat(r))}t.raiseEvent(De.Reboot,M(M({},e),{previousSessionId:t.sessionId,queryOverrides:r})),i({completion:"success"})}))};function ze(i){return!(!(i&&i.source&&i.accessToken)||!i.expiry&&0!==i.expiry)}function qe(i){return function(i,e){var t={};e&&Object.keys(e).forEach((function(i){t[i.toLowerCase()]=e[i]}));return i.split("&").forEach((function(i){if(/^wd\w+=\w+/i.test(i)){var e=i.split("=");t[e[0].toLowerCase()]=e[1]}})),t}(window.location.search.substring(1),i)}function Ke(i,e,t){var n=M(M(M({},v(i.appUrl)),function(i){var e={};l(e,"jsapi","1"),l(e,"jsapiver","v2"),l(e,"corrid",i.sessionId),l(e,"usid",i.sessionId),l(e,"newsession","1"),l(e,"sftc","1"),i.hostSessionId&&l(e,"hid",encodeURIComponent(i.hostSessionId));var t=i.host;t.uiHostName&&l(e,"uih",t.uiHostName),t.uiHostIntegrationType&&l(e,"uihit",encodeURIComponent(t.uiHostIntegrationType)),t.metaUiHostVersion&&l(e,"muv",encodeURIComponent(t.metaUiHostVersion));var n=t.capabilities;n&&(n.accessibilityLoop&&l(e,"accloop","1"),n.rebootDoc&&l(e,"sdr",n.rebootDoc.toString()),n.createNewDoc&&l(e,"scnd","1"),n.authToken&&l(e,"sat","1"),n.customAuthConfig&&l(e,"cac","1"),n.refreshAccessToken&&l(e,"rat","1"),n.atMentions&&l(e,"sams","1"),n.moveToFolder&&l(e,"mtf","1"),n.noBrowserModalDialogs&&l(e,"nbmd","1"),n.commonFilePicker&&l(e,"sfp","1"),n.directDownload&&l(e,"sdd","1"),n.directPrint&&l(e,"sdp","1"));var o=i.ui;o.language&&l(e,"ui",encodeURIComponent(o.language)),o.uiEmbed&&l(e,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&l(e,"hhdr","1"),o.highContrast&&l(e,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&l(e,"hodflp","1"),o.hideAppLauncherInHeader&&l(e,"halh","1"),o.hideChatInHeader&&l(e,"hch","1"),o.hideMeInHeader&&l(e,"hmh","1"),o.hideSearchInHeader&&l(e,"hsh","1"),o.hideWorkflowInHeader&&l(e,"hwfh","1"),o.hideSettingsInHeader&&l(e,"hsth","1"),o.showAppIconInHeader&&l(e,"sih","1"),o.useNeutralColorInHeader&&l(e,"unh","1"),o.openLinksInNewWindow&&l(e,"onw","1"),o.useDarkTheme&&l(e,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||l(e,"readOnly","1");var r=i.wopi;r&&r.source&&l(e,"wopisrc",encodeURIComponent(r.source));var s=i.bootParams;s&&(s.dataLanguage&&l(e,"rs",encodeURIComponent(s.dataLanguage)),s.readOnly&&l(e,"readonly","1"),s.disableChat&&l(e,"dchat","1"),s.cookieCompliant&&l(e,"mscc","1"),s.isNewFile&&(l(e,"new","1"),s.isFromHostTemplate&&l(e,"wdtpl","fromhost"))),i.user.isLicensed&&l(e,"islicenseduser","1"),i.user.isSynthetic&&l(e,"syn","1"),i.actNavId&&l(e,"actnavid",i.actNavId),i.sessionContext&&l(e,"sc",encodeURIComponent(i.sessionContext));var a=i.wdParams;if(a)for(var c in a)l(e,c,a[c]);var u=i.preseededSession;u&&(u.key&&l(e,"preseededsessionkey",encodeURIComponent(u.key)),u.id&&l(e,"preseededwacsessionid",encodeURIComponent(u.id)));var d=i.throttling;d&&(d.protection&&l(e,"ctp",d.protection),d.request&&l(e,"rct",d.request));var f=i.hostInitDiagnostics;f&&(f.entryPoint&&l(e,"wdorigin",encodeURI(f.entryPoint)),f.userClickTime&&l(e,"wdhostclicktime",f.userClickTime.toString()));var p=i.rebootOverride;return p&&p.previousSessionId&&l(e,"wdprevioussession",p.previousSessionId),h(e,"region"),e}(i)),t),o=i.rebootOverride;return o&&o.queryOverrides&&(n=M(M({},n),o.queryOverrides)),function(i,e,t){var n=[];for(var o in t)t[o]&&n.push(o+"="+t[o]);return i+e+(n.length>0?"?"+n.join("&"):"")}(i.appBasePath,e,n)}function Xe(i,e){var t=function(i){var e={};l(e,"highdpi",String(window.devicePixelRatio>1.24)),l(e,"softblockedbrowser",String(X())),l(e,"hostname",i.hostName),l(e,"feature_status",wi(i.featureManager,i.wdParams)),l(e,"jsapibuild",T());var t=i.wopi;t&&(l(e,"access_token",t.accessToken),l(e,"access_token_ttl",t.expiry.toString()),t.wacToken&&l(e,"wac_token",t.wacToken));var r=i.customFontCatalogUrl;r&&l(e,"customfontcatalogurl",r);var s=i.contentBundle;if(s&&s.url){l(e,"bundlesrc",s.url);var a=s.staleness,c=null!=a;c&&l(e,Ii.kn,a.toString()),i.logger.ULS.te(577783775,n.B,o.Info,"Content bundle staleness: "+(c?a:"N/A"))}var u=i.file,d=u.name;if(d){l(e,"filename",d);var h=C(d);h&&l(e,"fileextension",h)}u.getUrl&&l(e,"filegeturl",u.getUrl),u.size&&l(e,"filesize",u.size.toString()),u.eTag&&l(e,"etag",u.eTag),u.cTag&&l(e,"revid",u.cTag),u.uniqueId&&l(e,"docid",u.uniqueId);var f=i.newFileTemplate;f&&(f.getUrl&&l(e,"templateurl",f.getUrl),f.size&&l(e,"filesize",f.size.toString()),f.eTag&&l(e,"etag",f.eTag),f.uniqueId&&l(e,"docid",f.uniqueId)),i.user.id&&l(e,"user_id",i.user.id),i.ownerId&&l(e,"owner_id",i.ownerId),i.sessionContext&&l(e,"sc",i.sessionContext);var p=i.ui;p.controls&&l(e,"huictrls",JSON.stringify(p.controls)),"Templatization"!==p.contentAssemblyMode&&"DocGen"!==p.contentAssemblyMode&&"ContentAssemblyEdit"!==p.contentAssemblyMode&&"ContentAssemblyView"!==p.contentAssemblyMode||l(e,"caae","1"),p.contentAssemblyMode&&l(e,"caaemode",p.contentAssemblyMode);var v=i.meeting;v&&(v.id&&l(e,"meetingId",v.id),v.title&&l(e,"meetingTitle",v.title),v.type&&l(e,"meetingType",v.type),v.scheduledStartTime&&l(e,"scheduledStartTime",v.scheduledStartTime),v.scheduledEndTime&&l(e,"scheduledEndTime",v.scheduledEndTime),v.isPresenter&&l(e,"isPresenter",v.isPresenter.toString()),v.organizerId&&l(e,"meetingOrganizerId",v.organizerId),v.joinUrl&&l(e,"meetingJoinUrl",encodeURIComponent(v.joinUrl)),v.isMeetingTeamsRoom&&l(e,"isMeetingTeamsRoom",v.isMeetingTeamsRoom.toString()));var m=i.host;return m.owlVersion&&l(e,"owlver",m.owlVersion),m.owlRollout&&l(e,"owlro",m.owlRollout),e}(i);return Object.keys(e).forEach((function(i){e[i]?t[i]=e[i]:delete t[i]})),t}function $e(i){var e,t;if(function(i){return"wdjs"in i||"wd1js"in i}(i))return"true"===window.sessionStorage.getItem("sideLoadingIsEnabled")?(e=!1,void("true"===(t=qi("sideLoadingIsEnabled"))||"false"!==t&&e||Ki("sideLoadingIsEnabled","true",1))):void Ki("sideLoadingIsEnabled","false",0)}var Ze=function(i,e,t,a,c){return i!==ye.boot?Promise.reject("Wrong flow"):new Promise((function(i){var d,l=R();if(t.state=Pe.Booting,t.pendingReboot=!1,function(i,e){if(!i)throw new TypeError("SessionBootParams");var t=i.appUrl,n=i.appBaseUrl;if(!t&&!n)throw new TypeError("Either appUrl or appBaseUrl should exist");if(t&&"string"!=typeof t)throw new TypeError("AppUrl");if(n&&"string"!=typeof n)throw new TypeError("AppBaseUrl");var o=i.file;if(!o||!o.name)throw new TypeError("FileInfo");var r=i.container;if(!r||!(r instanceof Je)&&!r.appendChild)throw new TypeError("Container");if(!e&&!ze(i.wopi))throw new TypeError("WopiInfo")}(e,t.skipWopiValidation),t.intent=e.intent,t.file=e.file,t.customFontCatalogUrl=e.customFontCatalogUrl,t.wopi=e.wopi,t.contentBundle=e.contentBundle,t.newFileTemplate=e.newFileTemplate,t.ownerId=e.ownerId,t.sessionContext=e.sessionContext,t.actNavId=e.actNavId,t.preseededSession=e.preseededSession,t.throttling=e.throttling,t.meeting=e.meeting,t.tenantId=e.tenantId,t.wdParams=qe(e.wdParams),t.pinnedTarget=e.pinnedTarget,t.rebootOverride=e.rebootOverride,t.bootParams=e.bootParams||{},t.hostInitDiagnostics=M(M({},e.diagnostics),{hostInitializeCallTime:l}),t.ne.getValue(k.ie,!1)&&ri(t.hostInitDiagnostics),e.appUrl){var h=e.appUrl;t.appUrl=h;var p=t.bootParams;if(g(h,"new")&&(p.isNewFile=!0),!p.dataLanguage)(v=S(h,"rs"))&&(p.dataLanguage=v);var v,m=t.ui;if(g(h,"uiembed")&&(m.uiEmbed=!0),!m.language)(v=S(h,"ui"))&&(m.language=v);if(!t.hostInitDiagnostics.entryPoint){var I=S(h,"wdorigin");I&&(t.hostInitDiagnostics.entryPoint=I)}if(!t.host.uiHostName){var b=S(h,"uih");b&&(t.host.uiHostName=b)}}else t.appUrl="";t.appBaseUrl=e.appBaseUrl?e.appBaseUrl.toLowerCase():u(e.appUrl).toLowerCase(),t.appBaseUrl=function(i,e){if(!e||-1===r.indexOf(e.toLowerCase()))return i;var t=i.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return t?"".concat(t[1]).concat(e,"-").concat(t[3]):i}(t.appBaseUrl,f(t.appUrl,"region")),a.initializeAppContext(t,i,e),t.appBasePath=a.buildAppBasePath(t),t.remoteTelemetryUrl=a.buildRemoteTelemetryUrl(t),P(t.remoteTelemetryUrl,t.appInfo.name,"init");var y=!1,C=t.preseededSession;t.appInfo.usePreseededSessionId&&C&&C.id&&(t.sessionId=C.id,y=!0);var _,F=!1,E=e.hostGeneratedSessionId;!y&&E&&(t.sessionId=E,F=!0),e.rebootOverride&&(y||F||(d=O(),t.sessionId=d[0],_=d[1]),t.ne.addSettingsChangeListener(t.logger.settingsChangeHandler),t.pageStateObserver=new gi(t.logger,!0),t.authTokenTrustValidator=new li(t.logger)),t.logger.ULS.te(38580693,n.B,o.Info,"User session id: ".concat(t.sessionId,", is preseeded: ").concat(y,", is host generated: ").concat(F));var V=t.ne.getValue(k.Qi,"").toString();if(""===V&&(V=t.appBasePath+"RemoteUls.ashx"),t.logger.configure({remoteUlsEndpoint:V,sessionId:t.sessionId}),t.ne.initializePeriodicFetch(t.appBasePath,t.sessionId),_&&t.logger.ULS.te(590966790,n.B,o.Info,JSON.stringify(_)),function(i){try{var e=i.hostInitDiagnostics;i.logger.ULS.te(558155803,n.B,o.Info,"HostInitDiagnostics: "+(e?JSON.stringify(e):"N/A")),i.logger.ULS.te(596444237,n.B,o.Info,JSON.stringify({session:ei(i),client:i.clientDiagnostics}))}catch(e){i.logger.ULS.te(558155804,n.B,o.Error,"Failed to log init info: ".concat(A(e)))}}(t),t.appInitDiagnostics={officeSessionId:t.sessionId,officeBootstrapperVersion:T(),hostName:t.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(function(){t.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!t.container){var x=e.container;t.container=x instanceof Je?x:t.application.createContainer(x)}t.container.setMessageHandler(t.onMessage);var U=!!a.ignoreCompletionMessage&&a.ignoreCompletionMessage(t),D=function(i,e){t.successTime=R(),U||(t.container.postMessage(Ci.Oo,void 0),Q(t.appInitDiagnostics,e.Diagnostics)),a.onSuccess&&a.onSuccess(t,e),t.logger.ULS.te(596448985,n.B,o.Info,JSON.stringify(t.diagnostics)),P(t.remoteTelemetryUrl,t.application.name,"bootSuccess"),t.logger.ULS.flush(),t.container.postMessage(Ci.No,{HostInitializeDiagnostics:t.hostInitDiagnostics,ClientDiagnostics:t.clientDiagnostics}),t.state=Pe.Booted,N({completion:"success"}),ii(t.appInfo.name,t.logger)},W=function(i,e){t.failureTime=R(),a.onFailure&&a.onFailure(t,e.Error),t.logger.ULS.te(596448986,n.B,o.Error,JSON.stringify({error:e.Error,diagnostics:t.diagnostics})),P(t.remoteTelemetryUrl,t.application.name,"bootFailure"),t.logger.ULS.flush(),t.state=Pe.Failed;if(e.Error&&"object"!=typeof e.Error){var r={message:e.Error,errorSource:"App"};N({completion:"failure",error:r})}else N({completion:"failure",error:M(M({},e.Error),{errorSource:"App"})});ii(t.appInfo.name,t.logger)},N=function(e){U||(t.bootHeartBeat&&t.bootHeartBeat.stop(),t.removeActionHandler(oi.ue,D),t.removeActionHandler(oi.ae,W)),i(e)};c&&c.subscribe((function(){N({completion:c.reason||"cancelled"})})),U||(t.addActionHandler(oi.ue,D),t.addActionHandler(oi.ae,W)),$e(t.wdParams);var B=a.buildBootRequestParams(t),H=Ke(t,B.appPageName,B.queryParamsOverrides),L=Xe(t,B.postDataOverrides);if(t.bootstrapperUrl&&t.preconnector&&t.preconnector.shouldPreconnect(t.hostName)&&t.preconnector.preconnect(t.bootstrapperUrl),t.bootstrapperUrl&&t.preloader&&t.preloader.shouldPreload(H,t.host.origin))try{a.beforePreload&&a.beforePreload(t);var J=t.bootstrapperUrl;t.featureManager.isFeatureEnabled(fi.wn)&&(t.logger.ULS.te(590966791,n.B,o.Info,"HTTP2 preload enabled"),J=w(J)),t.preloader.preload(J,t.ui.language,t.logger,t.featureManager)}catch(i){t.logger.ULS.te(590966792,n.B,o.Error,A(i))}a.beforeContainerBoot&&a.beforeContainerBoot(t,H),t.appInitDiagnostics.officeFrameCreateTime=R(),t.container.boot(H,L,t.logger,a.buildContainerBootParams(t)),U?D(oi.ue,{Diagnostics:{}}):(t.bootHeartBeat=new ji(s(t.appBaseUrl),t.ne,t.logger,(function(){t.timeoutTime=R(),a.onTimeout&&a.onTimeout(t),P(t.remoteTelemetryUrl,t.application.name,"bootTimeout"),N({completion:"timeout"}),c&&c.cancel()}),c&&a.overrideBootTimeout?Math.min(c.timeoutInMs,a.overrideBootTimeout(t)):c?c.timeoutInMs:a.overrideBootTimeout?a.overrideBootTimeout(t):void 0),a.beforeBootCompletionMessage&&a.beforeBootCompletionMessage(t))})).catch((function(i){throw t.failureTime=R(),a.onException&&a.onException(t,i),t.remoteTelemetryUrl&&P(t.remoteTelemetryUrl,t.application.name,"bootException"),t.bootHeartBeat&&t.bootHeartBeat.stop(),Object.keys(M({},i)).length>=1?M(M({},i),{errorSource:"JsApi"}):{error:i.toString(),errorStack:i.stack,errorSource:"JsApi"}}))},Ye=function(i,e,t){return new Promise((function(e){t.logger.ULS.te(590111070,n.B,o.Error,"Unsupported flow: ".concat(i)),e({completion:"failure"})}))},Qe=function(i,e,t,r,s){return i!==ye.createNew?Promise.reject("Wrong flow"):new Promise((function(a){var c={wopiPendingInitializeTime:R()},u=!!(r&&r.parallelizeStartSessionRequest&&r.buildStartSessionRequestParams)&&r.parallelizeStartSessionRequest(t),d=!1,l=!1,h=!1,f=!1,p=void 0,v=void 0,m=!1,w=!1;if(z()===J.IE||r&&r.fallBackToSingleStepBootFlow&&r.fallBackToSingleStepBootFlow(t,e))!function(){t.logger.ULS.te(578074079,n.B,o.Info,"Waiting for WOPI info to start boot");var i=function(i,a){if(d)t.logger.ULS.te(578074080,n.B,o.Warning,"completeCreateNew already called");else{if(d=!0,c.wopiPendingCompleteTime=R(),"failure"===a.state)return V(a.reason),t.state=Pe.Failed,void r({completion:"failure"});it(a.newFile),t.run(ye.boot,M(M({},e),{wopi:a.wopi}),s).then((function(i){r(i)}))}};t.addActionHandler(ye.completeCreateNew,i);var r=function(e){t.removeActionHandler(ye.completeCreateNew,i),a(e)};s&&s.subscribe((function(){r({completion:"cancelled"})}))}();else{var g=function(i,e){d?t.logger.ULS.te(587236372,n.B,o.Warning,"completeCreateNew already called"):(d=!0,c.wopiPendingCompleteTime=R(),"failure"!==e.state?ze(p=e.wopi)?(t.wopi=p,t.logger.ULS.te(587286030,n.B,o.Info,"WOPI info received. Access token: "+JSON.stringify({length:p.accessToken.length,expiry:p.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:u,wacFrameLoaded:l,wacCanAcceptStartSessionResponse:h})),!u||l&&!h?l&&C():I(),l&&t.container&&t.container.postMessage(Ci.ur,void 0),it(e.newFile)):S("InvalidWopiInfo"):S(e.reason))},S=function(i){V(i),l&&t.container&&t.container.postMessage(Ci.ar,void 0)},I=function(){t.logger.ULS.te(587233056,n.B,o.Info,"Making parallelized StartSession request");var e=r.buildStartSessionRequestParams(t,i,p),s=Ke(t,e.appPageName,e.queryParamsOverrides),a={"Content-Type":"application/x-www-form-urlencoded"},u="access_token="+encodeURIComponent(p.accessToken)+"&access_token_ttl="+encodeURIComponent(p.expiry.toString());c.startSessionStartTime=R(),xi(s,u,a,b)},b=function(i){var e=R();c.startSessionCompleteTime=e,t.logger.ULS.te(587233057,n.B,o.Info,"StartSession request completed. Status code: ".concat(i.status,", time: ").concat(e)),v={RequestStatus:i.status,ResponseText:i.responseText},l&&h?y():t.logger.ULS.te(587233058,n.B,o.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:l,wacCanAcceptStartSessionResponse:h,wopiInfoSent:m,startSessionResponseSent:w}))},T=function(i,e){c.readyMessageReceiveTime=R(),t.container&&t.container.postMessage(Ci.Fo,void 0),l||(l=!0,h=e.CanAcceptStartSessionComplete,t.logger.ULS.te(587321567,n.B,o.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:u,wacCanAcceptStartSessionResponse:h,startSessionResponseAvailable:!!v,wopiInfoAvailable:!!p})),d&&t.container&&t.container.postMessage(p?Ci.ur:Ci.ar,void 0),u&&h?y():C(),Q(t.appInitDiagnostics,e.Diagnostics))},y=function(){w||m||!v||(200===v.RequestStatus?(w=!0,c.completeMessageCreateTime=R(),A(Ci.xo,{StartSessionResponse:v,Diagnostics:c},3)):C())},C=function(){w||m||!p||(m=!0,c.completeMessageCreateTime=R(),r&&r.sendCreateNewWopiInfo?r.sendCreateNewWopiInfo(t):A(Ci.Po,{WopiDetails:{WopiSrc:p.source,AccessToken:p.accessToken,AccessTokenTtl:p.expiry.toString()},Diagnostics:c},3))},A=function(i,e,r){var s=R();r<=0?t.logger.ULS.te(587233165,n.B,o.Error,"Attempted to complete but no ack. Time: ".concat(s)):(t.logger.ULS.te(587233166,n.B,o.Info,"Sending complete message. Retries left: ".concat(r-1,", Time: ").concat(s)),c.completeMessageSendTime=s,t.container&&t.container.postMessage(i,e),window.setTimeout(_,1e3,i,e,r-1))},_=function(i,e,r){f||(t.logger.ULS.te(587233167,n.B,o.Info,"Timeout session complete ack. Retries left: ".concat(r)),A(i,e,r))},F=function(i,e){f=!0},E=function(i){t.removeActionHandler(ye.completeCreateNew,g),t.removeActionHandler(oi.se,T),t.removeActionHandler(oi.Xe,F),a(i)};t.addActionHandler(ye.completeCreateNew,g),t.addActionHandler(oi.se,T),t.addActionHandler(oi.Xe,F),s&&s.subscribe((function(){E({completion:"cancelled"})})),t.skipWopiValidation=!0,t.wopi=void 0,t.run(ye.boot,e,s).then((function(i){t.skipWopiValidation=!1,t.wopi=p,E(i)}))}function V(i){t.logger.ULS.te(596444188,n.B,o.Warning,"Fail with reason: "+(i?JSON.stringify(i):"N/A"))}}))};function it(i){i&&(i.path&&history.replaceState({},"",i.path),i.title&&(document.title=i.title))}var et=function(){function i(i){var e=this;this.Hd=!1,this.Ld="",this.Jd=[],this.jd=function(i){e.Hd||(e.Hd=!0,e.Ld=i?"timeout":"cancelled",e.Jd.map((function(i){return i()})),e.Jd=[])},this.Gd=i,window.setTimeout((function(){return e.jd(!0)}),i)}return Object.defineProperty(i.prototype,"isCancelled",{get:function(){return this.Hd},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"timeoutInMs",{get:function(){return this.Gd},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reason",{get:function(){return this.Ld},enumerable:!1,configurable:!0}),i.prototype.cancel=function(){this.jd(!1)},i.prototype.subscribe=function(i){this.Hd?i():this.Jd.push(i)},i}();function tt(i){return new et(i)}var nt=function(i,e,t,r,s){return i!==ye.dispose?Promise.reject("Wrong flow"):new Promise((function(i){t.logger.ULS.te(595714433,n.B,o.Info,"start disposing the application");var a=t.host.requireExplicitUnload,c={disposeStartTime:R(),forceAppUnload:a};t.state=Pe.Disposing;var u=function(){t.state=Pe.Disposed,i({completion:"success"})},d=function(i){r&&r.disposeAppSpecificResources&&r.disposeAppSpecificResources(t,e),t.dispose(),c.disposeEndTime=R(),function(i,e,t){if(t){var r=Number(t.hostMessageReceived);e.appUnloadStartTime&&!isNaN(r)&&(e.hostToAppPostMessageLatency=r-e.appUnloadStartTime);var s=Number(t.appMessageSent);!isNaN(s)&&e.appUnloadEndTime&&(e.appToHostPostMessageLatency=e.appUnloadEndTime-s);var a=Number(t.appUnloadStart),c=Number(t.appUnloadEnd);if(isNaN(a)||isNaN(c)||(e.appUnloadLatency=c-a),t.serverTimings){var u=t.serverTimings;for(var d in u)e["st-"+d.toString()]=u[d]}}i.logger.ULS.te(592524822,n.B,o.Info,"App disposed: "+JSON.stringify(e)),i.logger.ULS.flushOnClose()}(t,c,i),t.container?t.container.dispose(t.pendingReboot,a).then(u):u()};if(a){c.appUnloadStartTime=R();t.addActionHandler(oi.et,(function(i,e){c.appUnloadEndTime=R(),d(e)})),(s||new et(5e3)).subscribe((function(){t.state===Pe.Disposing&&(c.appUnloadTimedOut=!0,d())})),t.container&&t.container.postMessage(Ci.lr,void 0)}else d()}))};var ot,rt=function(i,e,t,r,s){return i!==oi._e?Promise.reject("Wrong flow"):new Promise((function(i){if(t.host.capabilities&&t.host.capabilities.frameTrustCheck)t.raiseEvent(De.FrameTrust,e);else{var r=!!t.container&&t.container.isTopFrameTrusted;t.logger.ULS.te(592445957,n.B,o.Info,"Top frame is trusted: ".concat(r)),t.container&&t.container.postMessage(Ci._e,{isTopFrameTrusted:r})}i({completion:"success"})}))},st=function(i,e,t,n,o){return i!==oi.Ee?Promise.reject("Wrong flow"):new Promise((function(i){t.authTokenTrustValidator.isResourceTrustedForMessage(e).then((function(n){n?t.raiseEvent(De.GetAuthToken,e):(t.container.postMessage(Ci.Zo,{AuthToken:"",Error:"accessDenied",RequestId:e.RequestId,IdentityType:e.IdentityType}),i({completion:"success"}))}),(function(n){t.container.postMessage(Ci.Zo,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:e.RequestId,IdentityType:e.IdentityType}),i({completion:"failure",error:n})}))}))},at=function(i,e,t,r,s){return i!==oi.ce?Promise.reject("Wrong flow"):new Promise((function(i){var s=e&&e.state?e.state:"Unknown";t.logger.ULS.te(592839750,n.B,o.Info,"Boot state: [".concat(s,"]")),"SplashScreenShown"===s&&t.raiseEvent(De.DismissSplashScreen,void 0),r&&r.beforeComplete&&r.beforeComplete(s),i({completion:"success"})}))};function ct(i,e){i.ULS.te(42524822,n.B,o.Info,"LogFeatureUsage: ".concat(e.toString()))}var ut,dt=((ot={})[oe.BOOTSTART]=596464066,ot[oe.BACKGROUND_MODESWITCH_BOOTSTART]=596464066,ot[oe.BOOTSUCCESS]=596457106,ot[oe.BOOTFAILED]=596464088,ot[oe.BOOTEXCEPTION]=596464072,ot[oe.BOOTTIMEOUT]=587580759,ot);function lt(i,e){switch(e){case oe.BOOTSTART:case oe.BACKGROUND_MODESWITCH_BOOTSTART:case oe.BOOTSUCCESS:case oe.BOOTFAILED:case oe.BOOTEXCEPTION:case oe.BOOTTIMEOUT:i.ULS.te(dt[e],n.B,o.Warning,e.toString());break;default:i.ULS.te(523298252,n.B,o.Info,"UKNOWN RELIABILITY MILESTONE")}i.ULS.flush()}function ht(i,e,t){var n,o,r,s;Ie(),he(i.appUrl)||(ct(i.logger,re.JSAPIV2),lt(i.logger,oe.BOOTSTART));var a=i.appContext,c=te.getBRSValue(te.DTEEnabledBRSKey);a.wasDefaultedtoEdit=!1,c&&!he(i.appUrl)&&function(i){var e=i.appContext,t=f(window.location.href,"action"),n=!1,o=i.host.uiHostName;if(o&&"teams"===o.toLowerCase()){var r=le(i.appUrl)===ne.VIEW;i.rebootOverride||(n=r)}if("default"===t||n){"true"===localStorage.getItem("enableDTE")&&(i.appUrl=p(i.appUrl,"VisioView","EditView",!0),e.wasDefaultedtoEdit=!0)}}(i),a.appMode=le(i.appUrl),a.resource=new _e(i.appBaseUrl,i.bootstrapperUrl),a.appFramePageViewLoaded=!1,a.fastViewPostMessageToWacFrameState={appFrameReadyToReceiveFastViewData:!1,jsapiAlreadySentFastViewDataToWacFrame:!1,jsapiReadyToSendFastViewDataToWacFrame:!1},a.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},a.fastViewBrowserCache=Qi.Create(i.user.id,null===(n=i.wopi)||void 0===n?void 0:n.source,null===(o=i.file)||void 0===o?void 0:o.eTag,i.logger),a.sessionBootParams=t,a.commentContext=void 0,a.modeSwitchAckReceived=!1;var u=i.host.uiHostName,d=u&&"teams"===u.toLowerCase();((null===(r=i.wdParams)||void 0===r?void 0:r.wdnc)||te.getBRSValue(te.hostCacheForEmbedViewEnabledBRSKey)&&(a.appMode===ne.EMBED_VIEW||a.appMode===ne.INTERACTIVE_PREVIEW))&&(a.fastViewInfo.noChromeMode=!0),d&&(null===(s=i.ui)||void 0===s?void 0:s.hideHeader)&&(a.appMode===ne.VIEW||a.appMode===ne.EMBED_VIEW||a.appMode===ne.INTERACTIVE_PREVIEW||a.appMode===ne.EDIT&&-1===i.appUrl.indexOf("embed=1"))&&(a.fastViewInfo.noChromeMode=!0),d&&a.fastViewInfo.noChromeMode&&(a.fastViewInfo.noChromeWithToolbar=!0),f(window.location.href,"teamsvisiomode")&&i.hostInitDiagnostics&&(i.hostInitDiagnostics.userClickTime=(new Date).getTime())}function ft(i){return i.appBaseUrl+"/v/"}function pt(i){return e=i.appBasePath,t=i.sessionId,e+"RemoteTelemetry.ashx"+(t?"?usid="+t:"");var e,t}function vt(i,e){if(void 0===e&&(e=!1),yt(i,e)){he(i.appUrl)||be.RecordTelemetryData("bootPerf","constGuid","fastViewDuration",ce.TimerBegin,new Date,i.logger);try{!function(i){var e=function(i){var e=i.appContext;if(!i.container)return;var t=Tt(i),n=function(){var i=document.createElement("div");return i.id="VisioFastViewContainer",i.style.width="100%",i.style.height="100%",i.style.visibility="hidden",i.style.position="absolute",i.style.backgroundColor="#F3F2F1",i.style.display="block",i.style.touchAction="none",i.style.zIndex="1",i}(),o=function(i,e,t){var n=document.createElement("div");n.style.top=t?se.ToolbarHeightConsumption+"px":e?"0px":se.RibbonHeightConsumption+"px";return n.style.left="0px",n.style.right="0px",n.style.bottom=se.StatusbarHeight+"px",n.style.position="absolute",n.style.borderTopColor="#C6C6C6",n.style.borderTopWidth=se.FishbowlBorderTop+"px",n.style.borderTopStyle="solid",n.style.backgroundColor="#F9F9F9",i.appendChild(n),n}(n,t.noChromeMode,t.noChromeWithToolbar),r=function(i){var e=document.createElement("div");return e.id="backgroundPage",i.appendChild(e),e}(o),s=function(i){var e=document.createElement("img");return e.id="foregroundPage",e.style.visibility="hidden",e.setAttribute("crossorigin","anonymous"),i.appendChild(e),e}(r);!t.noChromeMode&&function(i,e){var t=document.createElement("div");t.style.top="0px",t.style.height=se.HeaderHeight+"px",t.style.left="0px",t.style.right="0px",t.style.position="absolute",te.getBRSValue(te.Fluent2StyleIsEnabled)?t.style.backgroundColor="#FFFFFF":t.style.backgroundColor=e.ui&&e.ui.useNeutralColorInHeader?"#F3F2F1":"#3955A3";i.appendChild(t)}(n,i),(!t.noChromeMode||t.noChromeWithToolbar)&&function(i,e){var t=document.createElement("div");t.style.top=(i?0:se.HeaderHeight)+"px",t.style.height="0px",t.style.left="0px",t.style.right="0px",t.style.position="absolute",t.style.backgroundColor="#E1E1E1",t.id="visio_fastview_toolbar_upper",e.appendChild(t);var n=document.createElement("div");n.style.top=(i?0:se.HeaderHeight)+"px",n.style.height=se.ToolbarHeightConsumption+"px",n.style.left="0px",n.style.right="0px",n.style.position="absolute",n.style.backgroundColor="#FFFFFF",n.id="visio_fastview_toolbar",e.appendChild(n)}(t.noChromeWithToolbar,n);var a=function(i,e){var t=e.appContext,n=document.createElement("div");t.fastViewInfo.noChromeWithToolbar?n.style.top=se.ToolbarHeightConsumption+"px":t.fastViewInfo.noChromeMode?n.style.top="0px":n.style.top=se.RibbonHeightConsumption+se.FishbowlBorderTop+"px";n.style.height=se.ProgressImageHeight+"px",n.style.left="0px",n.style.right="0px",n.style.position="absolute",e.appContext.resource&&(n.style.backgroundImage="url(".concat(e.appContext.resource.getDelayLoadingGif(),")"),n.style.backgroundRepeat="repeat-x");return i.appendChild(n),n}(n,i),c=function(i){var e=document.createElement("div");return e.style.height="0px",i.appendChild(e),e}(n),u=(d=n,l=document.createElement("div"),l.style.bottom="0px",l.style.height=se.StatusbarHeight+"px",l.style.left="0px",l.style.right="0px",l.style.position="absolute",l.style.borderTopColor="#C6C6C6",l.style.borderTopWidth=se.StatusbarBorderTop+"px",l.style.borderTopStyle="solid",l.style.backgroundColor="#FFFFFF",d.appendChild(l),l);var d,l;e.appMode===ne.EDIT&&function(i,e,t,n,o,r){(function(i,e,t,n){var o=n?se.RibbonHeightNoChrome:se.RibbonHeightEdit;i.style.top=o+"px",t.style.top=o+se.FishbowlBorderTop+"px",i.style.left=se.ShapePanelWidthWithBorder+"px",e.style.left=se.ShapePanelWidthWithBorder+"px"})(i,t,n,o),function(i,e,t){i.style.top=e.style.top,i.style.position="absolute",i.style.height="auto",i.style.borderWidth=se.ShapePanelBorderWidth+"px",i.style.borderRightStyle="solid",i.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",i.style.borderColor="#e1e1e1",i.style.backgroundColor="#f2f2f2",i.style.width=se.ShapePanelWidthWithoutBorder+"px",i.style.bottom="0px",i.style.overflow="0",function(i,e){var t=document.createElement("div");t.style.top="50%",t.style.left="50%",t.style.position="absolute",t.style.transform="translateX(-50%) translateY(-50%)",t.style.fontSize="9pt",t.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',i.appendChild(t);var n=document.createElement("img");n.style.cssFloat="left",n.style.height="16px",n.style.width="16px",n.setAttribute("crossorigin","anonymous"),e.appContext.resource?n.src=e.appContext.resource.getLoadingSpinnerGif():n.style.visibility="hidden";t.appendChild(n);var o=document.createElement("div");o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText="",t.appendChild(o)}(i,t)}(e,i,r)}(o,c,u,a,t.noChromeMode,i);return i.container.element.appendChild(n),{fastViewContainer:n,fishBowlElement:o,pageElement:r,imageElement:s,shapePanelElement:c}}(i),t=e.imageElement,r=e.fishBowlElement,s=e.pageElement,a=e.fastViewContainer,c=Tt(i);c.fishBowlElement=r,c.imageElement=t,c.pageElement=s,c.fastViewContainer=a;var u=i.appContext;if(u.fastViewBrowserCache&&u.fastViewBrowserCache.IsCacheAvailable())return void u.fastViewBrowserCache.DecryptAndValidate((function(e,t){try{c.imageElement.setAttribute("src","data:image/png;base64,{0}".replace("{0}",t)),c.imageLoaded=!0,c.docViewResponseText=e,c.docViewLoaded=!0,c.fastviewContentLoadedFromLocalcache=!0,c.fastViewImageDataFromCache=t,wt(i)}catch(e){i.logger.ULS.te(508045407,n.B,o.Error,"doc view parsing failed from cache with exception: "+A(e)),mt(i)}}),(function(){i.logger.ULS.te(508045406,n.B,o.Error,"fastview browser cache decryption and validation failed"),u.fastViewBrowserCache.DeleteDocument(),mt(i)}));(function(i){var e,t=Tt(i),r=t.imageElement;r.onload=function(){t.imageLoaded=!0,wt(i)},r.onerror=function(){i.logger.ULS.te(523531992,n.B,o.Error,"Fast View image request failed in JSAPI bootstrapper"),mt(i)},r.src=gt(null===(e=i.contentBundle)||void 0===e?void 0:e.url,ae.FastViewImage)})(i),function(i){var e,t=gt(null===(e=i.contentBundle)||void 0===e?void 0:e.url,ae.FastViewJson),r=Tt(i);de.sendXmlHttpRequest("GET",t,!0,(function(e){try{r.docViewResponseText=e,r.docViewLoaded=!0,wt(i)}catch(e){i.logger.ULS.te(508045405,n.B,o.Error,"doc view usage failed with exception: "+A(e)),mt(i)}}),(function(){i.logger.ULS.te(508045404,n.B,o.Error,"doc view request failed in JSAPI bootstrapper"),mt(i)}),ae.FastViewJson,i.logger)}(i)}(i)}catch(e){i.logger.ULS.te(523531990,n.B,o.Error,"Failed to boot from the host cache: ".concat(A(e))),mt(i)}}}function mt(i){var e=Tt(i);e.fastViewContainer&&e.fastViewContainer.parentElement&&e.fastViewContainer.parentElement.removeChild(e.fastViewContainer),e.fastViewcontainerVisible=!1,i.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,Ct(i)}function wt(i){try{var e=Tt(i),t=JSON.parse(e.docViewResponseText);if(e.fastViewCacheHit=!0,e.docViewLoaded&&e.imageLoaded&&i.state===Pe.Booting&&!i.appContext.appFramePageViewLoaded){var r=(s=t.PageWidth,a=t.PageHeight,c=e.fishBowlElement.offsetWidth,u=e.fishBowlElement.offsetHeight,d=96*se.FishbowlMarginInches,l=96*se.FishbowlMarginInches,h=(c-d)/(96*s),f=(u-l)/(96*a),Math.min(h,f));!function(i,e,t){var n=Tt(i),o=t.PageWidth,r=t.PageHeight,s=n.fishBowlElement,a=n.pageElement,c=s.offsetWidth-96*o*e,u=s.offsetHeight-96*r*e;a.style.width=96*o*e+"px",a.style.height=96*r*e+"px",a.style.backgroundColor="white",a.style.borderColor="#C6C6C6",a.style.borderWidth="1px",a.style.borderStyle="solid",a.style.boxShadow="0px 0px 20px #C6C6C6",a.style.position="absolute",a.style.top=u/2+"px",a.style.left=c/2+"px"}(i,r,t),e.imageElement.style.position="absolute",e.imageElement.style.left=96*t.OffsetX*r+"px",e.imageElement.style.top=e.pageElement.clientHeight-96*(t.Height+t.OffsetY)*r+"px",e.defaultImageHeight=e.imageElement.height,e.defaultImageWidth=e.imageElement.width,e.imageElement.width=96*t.Width*r,e.imageElement.height=96*t.Height*r,e.imageElement.style.visibility="visible",e.fastViewContainer.style.display="block",e.fastViewContainer.style.visibility="visible",e.fastviewShownFromHostCache=!0,e.fastViewPLTTime=R(),e.fastViewcontainerVisible=!0,i.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,function(i){var e=Tt(i);setTimeout((function(){e.fastViewcontainerVisible&&(i.logger.ULS.te(523089178,n.B,o.Warning,"[setTimeoutForRemovalOfFastView] Removing fastview screen as its > ".concat(15e3," millisec.")),St(i))}),15e3)}(i),Ct(i)}else e.docViewLoaded&&e.imageLoaded&&i.logger.ULS.te(523531993,n.B,o.Info,"FastView not shown. Conditions: "+JSON.stringify({SessionState:i.state,appFramePageViewLoaded:i.appContext.appFramePageViewLoaded}))}catch(e){i.logger.ULS.te(508045403,n.B,o.Error,"fastview creation failed with exception: "+A(e))}var s,a,c,u,d,l,h,f}function gt(i,e){if(!i||-1===i.indexOf("{0}"))throw new TypeError("invalid content URL");if(!e)throw new TypeError("invalid content id");return decodeURI(i).replace("{0}",e)}function St(i){window.setTimeout((function(){return mt(i)}),0)}function It(i){var e=Tt(i),t=i.appInitDiagnostics;t.documentLoadedFromWopiPrecheckInfo=e.fastviewShownFromHostCache,e.fastviewShownFromHostCache&&(t.documentLoadedTime=e.fastViewPLTTime),t.cacheAboutToExpire=!1,e.fastViewCacheHit&&!t.cacheHit&&(t.cacheAboutToExpire=!0),t.cacheHit=e.fastViewCacheHit,he(i.appUrl)&&(t.webAppFrameReinitialized=!0);var n=i.hostInitDiagnostics;n&&void 0===n.hostPageRedirectCount&&(n.hostPageRedirectCount=Se())}function bt(i){var e,t,r=i.appInitDiagnostics;if(r){var s=i.appContext,a=Tt(i);he(i.appUrl)||Te(i.hostInitDiagnostics,r,i.logger);var c=!1;try{c=null===(e=JSON.parse(a.docViewResponseText))||void 0===e?void 0:e.IsCompressed}catch(i){}i.logger.ULS.te(595981388,n.B,o.Info,JSON.stringify({BootDiagnostics:r,hostDiagnostics:i.hostInitDiagnostics,navigationStartTime:ge(),isJSAPIV2:"true",localCacheHit:a.fastviewContentLoadedFromLocalcache,compressedView:c?"true":"false",backgroundBoot:he(i.appUrl),appMode:s.appMode.toString()})),r.documentLoadedWithTabSwitch&&i.logger.ULS.te(596457107,n.B,o.Info,"DOCUMENTLOADEDWITHTABSWITCH"),i.logger.ULS.te(596457681,n.B,o.Info,JSON.stringify({hostInitDiagnostics:null!==(t=i.hostInitDiagnostics)&&void 0!==t?t:"N/A"}))}}function Tt(i){return i.appContext.fastViewInfo}function yt(i,e){var t,n=i.appContext;return!(!i.contentBundle||!i.contentBundle.url)&&(!!i.container&&(!((null===(t=i.wdParams)||void 0===t?void 0:t.wdPBIView)||i.appUrl.indexOf("wdPBIView")>=0)&&(!window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(n.appMode===ne.VIEW||(!(n.appMode!==ne.EMBED_VIEW&&n.appMode!==ne.INTERACTIVE_PREVIEW||!te.getBRSValue(te.hostCacheForEmbedViewEnabledBRSKey))||n.appMode===ne.EDIT&&!fe(i.appUrl)&&(!he(i.appUrl)||e))))))}function Ct(i,e){var t,r;void 0===e&&(e=!1);var s=i.appContext.fastViewPostMessageToWacFrameState,a=Tt(i);if(!s.jsapiAlreadySentFastViewDataToWacFrame&&s.appFrameReadyToReceiveFastViewData){if(s.appFrameReadyToReceiveFastViewData&&e){var c=((t={})[ae.FastViewImage]=void 0,t[ae.FastViewJson]=void 0,t);return i.container&&i.container.postMessage(Ci.br,c),s.jsapiAlreadySentFastViewDataToWacFrame=!0,void i.logger.ULS.te(523368192,n.B,o.Info,"[sendFastViewDataToVisioAppFrame] force sending empty postmessage for fastview data after 5 sec wait time.")}if(s.appFrameReadyToReceiveFastViewData&&!s.jsapiReadyToSendFastViewDataToWacFrame)return i.logger.ULS.te(523368193,n.B,o.Info,"[sendFastViewDataToVisioAppFrame] wac appframe is waiting for fastview data. jsapi is not yet ready to send it. Setting up 5 sec timer to revert if not done automatically. "),void setTimeout((function(){return Ct(i,!0)}),5e3);var u=a.fastviewContentLoadedFromLocalcache?a.fastViewImageDataFromCache:we(a.imageElement,a.defaultImageWidth,a.defaultImageHeight),d=a.docViewResponseText,l=((r={})[ae.FastViewImage]=u,r[ae.FastViewJson]=d,r);i.container&&i.container.postMessage(Ci.br,l),s.jsapiAlreadySentFastViewDataToWacFrame=!0,i.logger.ULS.te(523368194,n.B,o.Info,"[sendFastViewDataToVisioAppFrame] Sent fastview data to wac appframe. ")}}function At(i){var e,t,n=i.appContext,o={},r={},s=f(window.location.href,"teamsvisiomode");!n.wasDefaultedtoEdit&&i.host&&i.host.metaUiHostVersion&&!s&&(null===(e=i.rebootOverride)||void 0===e?void 0:e.mode)&&(s=i.rebootOverride.mode),s&&i.appUrl.indexOf("embed=1")<0&&("edit"===s.toLocaleLowerCase()&&n.appMode!==ne.EDIT&&(l(o,"VisioView","EditView"),l(o,"wdIsModeSwitch","1"),n.appMode=ne.EDIT),"view"===s.toLocaleLowerCase()&&n.appMode!==ne.VIEW&&(l(o,"VisioView","ConsumptionView"),n.appMode=ne.VIEW));var a=i.host.uiHostName;if(a&&"teams"===a.toLowerCase()&&l(o,"enableToolbarInTeams","true"),l(o,"pmOrigin",encodeURIComponent(u(window.location.href))),i.hostName&&l(o,"filesrc",encodeURIComponent(i.hostName)),n.appMode!==ne.EDIT_NEW||i.wopi||l(o,"instantedit","1"),h(o,"sams"),te.getBRSValue(te.IsAtMentionsEnabled)){var c=f(window.location.href,"nav");if(c&&n.appMode===ne.VIEW)l(r,"nav",decodeURIComponent(c));i.host.capabilities&&i.host.capabilities.atMentions&&l(r,"sams","1")}(null===(t=i.contentBundle)||void 0===t?void 0:t.url)&&(l(r,"bsdpm","true"),l(r,"dpmdv","true"));var d=void 0;return i.hostInitDiagnostics&&((d=i.hostInitDiagnostics.userClickTime)||(d=i.hostInitDiagnostics.hostInitializeCallTime)),d||(d=(new Date).getTime()),l(r,"dct",d.toString()),l(r,"wde",n.wasDefaultedtoEdit.toString()),l(r,"highdpi",String(window.devicePixelRatio>1.25)),yt(i,!1)?l(o,"fastPreview","true"):l(o,"fastPreview","false"),{appPageName:"visioframe.aspx",queryParamsOverrides:o,postDataOverrides:r}}function _t(i){i.logger.ULS.te(526455300,n.B,o.Info,"[handleViewModeCLT] View mode CLT complete message received"),i.container&&i.container.postMessage(Ci.wr,void 0),function(i){return!!te.getBRSValue(te.backgroundEditSessionEnabledKey)&&(!i.host.metaUiHostVersion||te.getBRSValue(te.IsTeamsBackgroundFrameFixEnabled))}(i)&&function(i){var e=i.appContext;if(e.appMode!==ne.VIEW)throw new TypeError("Booting up background editor in non viewer session");if(e.sessionBootParams){var t=M({},e.sessionBootParams),r=t.appUrl;if(void 0===r)throw new TypeError("applicationUrl is empty");if("consumptionview"!==f(r.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");r=p(r,"VisioView","EditView",!0),r=p(r,"backgroundsession","1",!0),t.appUrl=p(r,"wdIsModeSwitch","1",!0);var s=O()[0];t.hostGeneratedSessionId=s,t.preseededSession=void 0,i.logger.ULS.te(521176415,n.B,o.Info,"[createBackgroudEditorSession] edit session associated: ".concat(s)),t.rebootOverride=void 0,i.backgroundSession=i.application.createSession({hostSessionId:i.hostSessionId}),i.backgroundSession.boot(t),i.backgroundSession.run(ut.zd,i.session)}}(i)}function Ft(i,e){var t=Tt(i);if(e&&!t.fastviewSavedToBrowserCache){var n=parseInt(e[Qi.maxStorageQuotaSettingName].toString(),10),o=parseInt(e[Qi.minEvictTimePeriodSettingName].toString(),10);if(window.setTimeout((function(){return Qi.EvictStaleCache(1024*n*1024,24*o*60*60*1e3,i.logger)}),Qi.cacheEvictIdleTimeInMs),t.fastviewShownFromHostCache){var r=t.fastviewContentLoadedFromLocalcache?t.fastViewImageDataFromCache:we(t.imageElement,t.defaultImageWidth,t.defaultImageHeight);r&&(window.setTimeout((function(){var e;return null===(e=i.appContext.fastViewBrowserCache)||void 0===e?void 0:e.SaveDocument(t.docViewResponseText,r)}),Qi.documentSaveIdleTimeInMs),t.fastviewSavedToBrowserCache=!0)}}}function Et(i,e){var t,r;null===(t=i.bootHeartBeat)||void 0===t||t.restart();var s=0;null===(r=i.container)||void 0===r||r.setVisibility(!1),function i(e,t,n,o,r,s,a){void 0===a&&(a=0),a>=10&&r("[workWithRetry] max recursion depth of ".concat(10," reached. Stopping retry and failing")),t()||(n()?(o(),e(),setTimeout((function(){return i(e,t,n,o,r,s,a+1)}),s())):r("[workWithRetry] max retries configured reached. Stopping retry and failing"))}((function(){i.container&&i.container.postMessage(Ci.Sr,e)}),(function(){return i.appContext.modeSwitchAckReceived}),(function(){return s<3}),(function(){s++}),(function(e){i.logger.ULS.te(522840264,n.B,o.Info,"[handleBootBackgroundClient] ".concat(e,". Falling back to legacy switch"));var t=i.appContext.activeSession;t&&t.run(ut.qd,void 0)}),(function(){return 1e3}))}function Vt(i){!function(i){i.addActionHandler(oi.Ut,(function(e,t){te.handleVisioBRS(t,i.logger)})),i.addActionHandler(oi.Dt,(function(i,e){!function(i){i&&i.License&&("plan1"===i.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false"))}(e)})),i.addActionHandler(oi.Mt,(function(e,t){i.appContext.appFramePageViewLoaded=!0;var n=i.appInitDiagnostics;t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((function(i){return n[i]=t.Diagnostics[i]}))})),i.addActionHandler(oi.Ht,(function(e){!function(i){var e,t=window.location.href;t=p(t,"wdreloadsessionid",i.sessionId,!0);var r=i.sessionId,s=1;(null===(e=i.wdParams)||void 0===e?void 0:e.wdreloadcount)&&(s=parseInt(i.wdParams.wdreloadcount,10)+1),s>te.getIntegerBRSValue(te.ReloadOnScriptFailMaxLimitBRSKey,3)?i.logger.ULS.te(523531988,n.K,o.Error,"Visio Boot failed for WACSessionID: "+r+" after"+s+"retries"):(t=p(t,"wdreloadcount",String(s),!0),i.logger.ULS.te(523531989,n.K,o.Warning,"Refreshing VisioFrame for WACSessionID: "+r+", currentReloadCount: "+s+", UriLen: "+t.length),i.logger.ULS.flush(),window.location.href=t)}(i)})),te.getBRSValue(te.CoCommentingAcrossViewAndEditEnabled)&&i.addActionHandler(oi.Me,(function(e,t){!function(i,e){i.appContext.commentContext=e}(i,t)}));i.addActionHandler(oi.jt,(function(e,t){!function(i,e){var t=window.location.href;"VIEW"===e.toMode||"EDIT"===e.toMode?(t=p(t,"teamsvisiomode",e.toMode,!0),te.getBRSValue(te.IsFormulaeSerializationRollbackEnabled)&&i.appContext.appMode===ne.EDIT&&"1"===e.wdDisableFormulae&&(t=p(t,"wdDisableFormulae","1",!0)),window.location.href=t):i.logger.ULS.te(593622414,n.K,o.Warning,"Invalid options received in Visio_DocReboot_HostNav message")}(i,t)})),i.addActionHandler(oi.Gt,(function(e,t){!function(i,e){St(i),Ft(i,e.Settings)}(i,t)})),i.addActionHandler(oi.Jt,(function(e){i.appContext.fastViewPostMessageToWacFrameState.appFrameReadyToReceiveFastViewData=!0,Ct(i)}))}(i),i.appContext.appMode===ne.VIEW?function(i){i.addActionHandler(oi.Wt,(function(e,t){!function(i,e){var t;i.logger.ULS.te(526455301,n.B,o.Info,"[handleModeSwitchFromViewerFrame] Received switch mode post message from frame with App mode : "+(null===(t=i.appContext)||void 0===t?void 0:t.appMode.toString())),i.container&&i.container.postMessage(Ci.gr,void 0),i.backgroundSession?(i.backgroundSession.run(ut.Kd,void 0),i.backgroundSession.run(ut.Xd,e)):i.container&&i.container.postMessage(Ci.Ir,void 0)}(i,t)})),i.addActionHandler(oi.kt,(function(e){_t(i)})),i.addActionHandler(ut.qd,(function(e){i.container&&i.container.postMessage(Ci.Ir,void 0)})),i.addActionHandler(oi.Lt,(function(e){!function(i){i.backgroundSession?i.backgroundSession.dispose():i.logger.ULS.te(523531987,n.K,o.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")}(i)}))}(i):function(i){i.addActionHandler(ut.Xd,(function(e,t){Et(i,t)})),i.addActionHandler(ut.zd,(function(e,t){i.appContext.activeSession=t})),i.addActionHandler(oi.Nt,(function(e,t){!function(i,e){var t,r;if(i.logger.ULS.te(526455302,n.B,o.Info,"[handleModeSwitchAckFromEditor] Received mode switch ack from Editor"+e),i.appContext.modeSwitchAckReceived=!0,null==e?void 0:e.IsSuccess){var s=i.appContext;null===(t=null==s?void 0:s.activeSession)||void 0===t||t.run(ye.dispose,{notDisposeBackgroundSession:!0},void 0),ct(i.logger,re.JSAPIV2),lt(i.logger,oe.BOOTSTART),i.raiseEvent(De.FrameChanged,null===(r=i.container)||void 0===r?void 0:r.frameId)}else{var a=i.appContext.activeSession;a&&a.run(ut.qd,void 0)}}(i,t)})),i.addActionHandler(ut.Kd,(function(e){i.diagnostics.appInitDiagnostics&&(i.diagnostics.appInitDiagnostics.modeSwitchClickTime=R()),vt(i,!0)})),i.addActionHandler(oi.Bt,(function(e,t){!function(i,e){var t=i.appContext;if(!fe(i.appUrl)){var n="";e&&e.RefreshOrigin&&(n=e.RefreshOrigin);var o=window.location.href;te.getBRSValue(te.IsToastUserFixEnabledBRSKey)&&o&&(o=m(o,"wdToastUser")),te.getBRSValue(te.IsContextAppRefreshFixEnabledBRSKey)&&o&&(o=m(o,"wdActivePageId"),o=m(o,"wdPageScale"),o=m(o,"wdPageCenterX"),o=m(o,"wdPageCenterY")),t.appMode!==ne.EDIT&&t.appMode!==ne.EDIT_NEW||(o&&(o=p(o,"action","edit",!0),n&&(o=p(o,"OR",n,!0)),t.appMode===ne.EDIT_NEW&&(o=p(o,"wdNewAndOpenCt","0",!0))),pe(o))}}(i,t)}))}(i)}function Rt(i){vt(i),Vt(i)}function Ot(i){return{permissionsPolicy:(e=i.appBaseUrl,"microphone ".concat(e,"; autoplay ").concat(e,"; camera ").concat(e,"; clipboard-read ").concat(e,"; clipboard-write ").concat(e,"; keyboard-map ").concat(e,"; display-capture ").concat(e)),isInvisible:i.appUrl.indexOf("backgroundsession")>-1,enforceSameWindow:!0};var e}function xt(i,e){i.appContext.appMode===ne.VIEW&&te.getBRSValue(te.CoCommentingAcrossViewAndEditEnabled)&&function(i){i.logger.ULS.te(523352026,n.B,o.Info,"Sending comment context message to frame"),void 0!==i.appContext.commentContext&&(i.container&&i.container.postMessage(Ci.Qo,i.appContext.commentContext),i.appContext.commentContext=void 0)}(i),St(i),Ft(i,e.Settings),It(i),bt(i),lt(i.logger,oe.BOOTSUCCESS)}function Pt(i){St(i),It(i),bt(i),lt(i.logger,oe.BOOTFAILED)}function Ut(i,e){lt(i.logger,oe.BOOTEXCEPTION)}function Dt(i){lt(i.logger,oe.BOOTTIMEOUT)}function kt(i){var e;he(i.appUrl)&&(null===(e=i.bootHeartBeat)||void 0===e||e.stop())}function Wt(){return 12e4}function Nt(i,e){var t,n,o;if(te.getBRSValue(te.instantCreateNewLocalStorageKey)){if(null===(t=e.bootParams)||void 0===t?void 0:t.isNewFile)return!!(null===(n=e.wdParams)||void 0===n?void 0:n.wdTpl)&&!te.getBRSValue(te.InstantForAllTemplatesEnabledBRSKey);if(-1!==(null===(o=e.appUrl)||void 0===o?void 0:o.indexOf("wdasp")))return!te.getBRSValue(te.InstantForAllTemplatesEnabledBRSKey)}return!0}function Bt(i,e){var t;mt(i);var n=i.appContext;n.sessionBootParams=void 0,n.appFramePageViewLoaded=!1,n.modeSwitchAckReceived=!1,Qi.dispose(),n.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},te.dispose(),(null==e?void 0:e.notDisposeBackgroundSession)||null===(t=i.backgroundSession)||void 0===t||t.dispose()}!function(i){i.Xd="Visio_BootBackgroundClientApp",i.zd="Visio_SaveActiveSessionReference",i.Kd="Visio_ShowFastViewInBackgroundSession",i.qd="Visio_RelayFallBackToLegacySwitchToActiveSession"}(ut||(ut={}));var Mt,Ht=function(){var i,e;return[(i={},i[Ue.appReboot]=Ge,i[Ue.boot]=Ze,i[Ue.closeTab]=Ye,i[Ue.createNew]=Qe,i[Ue.dispose]=nt,i[Ue.frameTrust]=rt,i[Ue.getAuthToken]=st,i[Ue.getHostKeyValue]=Ye,i[Ue.handleBootState]=at,i[Ue.rename]=Ye,i[Ue.setOverlayContent]=Vi,i[Ue.storeHostKeyValue]=Ye,i[Ue.switchMode]=Ye,i[Ue.updateBootComplete]=Ye,i),(e={},e[Ue.boot]={initializeAppContext:ht,buildAppBasePath:ft,buildRemoteTelemetryUrl:pt,buildBootRequestParams:At,beforeContainerBoot:Rt,buildContainerBootParams:Ot,onSuccess:xt,onFailure:Pt,onException:Ut,onTimeout:Dt,beforeBootCompletionMessage:kt,overrideBootTimeout:Wt},e[Ue.dispose]={disposeAppSpecificResources:Bt},e[Ue.createNew]={fallBackToSingleStepBootFlow:Nt},e)]};!function(i){i[i.NotSupported=0]="NotSupported",i[i.SameDocOnly=1]="SameDocOnly",i[i.AnyDoc=2]="AnyDoc",i[i.OtherMode=4]="OtherMode"}(Mt||(Mt={})),t.d(e,"Application",(function(){return Lt})),t.d(e,"createApplication",(function(){return Jt})),t.d(e,"ApplicationEvents",(function(){return ie})),t.d(e,"DocRebootSupportMode",(function(){return Mt})),t.d(e,"CommandIds",(function(){return ye})),t.d(e,"EventIds",(function(){return De})),t.d(e,"createCancellationToken",(function(){return tt}));var Lt=new Ne,Jt=function(i){return new je(i,{name:"Visio"},Ht)}}});

